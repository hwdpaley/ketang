{
    "version": 3,
    "sources": [
        "../../../src/uc/controller/address.js"
    ],
    "names": [
        "indexAction",
        "weblogin",
        "model",
        "where",
        "user_id",
        "user",
        "uid",
        "page",
        "get",
        "order",
        "countSelect",
        "data",
        "html",
        "http",
        "desc",
        "pageNum",
        "url",
        "class",
        "text",
        "next",
        "prev",
        "total",
        "assign",
        "think",
        "isEmpty",
        "val",
        "province_num",
        "province",
        "city_num",
        "city",
        "county_num",
        "county",
        "id",
        "getField",
        "meta_title",
        "checkMobile",
        "userAgent",
        "active",
        "display",
        "controller",
        "action",
        "getareaAction",
        "pid",
        "parent_id",
        "select",
        "area",
        "json",
        "selectaddrAction",
        "goodslist",
        "addaddrAction",
        "post",
        "is_default",
        "find",
        "update",
        "city_picke",
        "split",
        "name",
        "res",
        "add",
        "success",
        "resurl",
        "addrlist",
        "type",
        "fail",
        "addrisdefaultAction",
        "getaddrAction",
        "addr",
        "deladdrAction",
        "param",
        "delete",
        "editaddrmodalAction",
        "address"
    ],
    "mappings": "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",
    "file": "../../../src/uc/controller/address.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\nimport pagination from 'think-pagination';\nexport default class extends Base {\n\n  /**\n   * 收货地址管理\n   * @returns {PreventPromise}\n   */\n  async indexAction() {\n    //判断是否登陆\n    await this.weblogin();\n    let data = await this.model(\"address\").where({user_id: this.user.uid}).page(this.get('page')).order(\"is_default DESC,id DESC\").countSelect();\n    let html = pagination(data, this.http, {\n      desc: false, //show description\n      pageNum: 2,\n      url: '', //page url, when not set, it will auto generated\n      class: 'nomargin', //pagenation extra class\n      text: {\n        next: '下一页',\n        prev: '上一页',\n        total: 'count: ${count} , pages: ${pages}'\n      }\n    });\n    //think.log(data);\n    this.assign('pagination', html);\n    if (!think.isEmpty(data.data)) {\n      for (let val of data.data) {\n        val.province_num = val.province;\n        val.city_num = val.city;\n        val.county_num = val.county;\n        val.province = await this.model(\"area\").where({id: val.province}).getField(\"name\", true);\n        val.city = await this.model(\"area\").where({id: val.city}).getField(\"name\", true);\n        val.county = await this.model(\"area\").where({id: val.county}).getField(\"name\", true);\n      }\n    }\n    this.assign(\"list\", data.data);\n    this.meta_title = \"收货地址\";\n    //判断浏览客户端\n    if (checkMobile(this.userAgent())) {\n      this.active = \"user/index\";\n      return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n    } else {\n      return this.display();\n    }\n  }\n\n  //获取省市三级联动\n  async getareaAction(){\n\n    let pid = this.get(\"pid\");\n    let area = await this.model('area').where({parent_id:pid}).select()\n    return this.json(area);\n  }\n  //选择收货地址（仅手机端用）\n  async selectaddrAction(){\n    await this.weblogin();\n    let get = this.get();\n    let data = await this.model(\"address\").where({user_id: this.user.uid}).order(\"is_default DESC,id DESC\").select();\n    if (!think.isEmpty(data)) {\n      for (let val of data) {\n        val.province_num = val.province;\n        val.city_num = val.city;\n        val.county_num = val.county;\n        val.province = await this.model(\"area\").where({id: val.province}).getField(\"name\", true);\n        val.city = await this.model(\"area\").where({id: val.city}).getField(\"name\", true);\n        val.county = await this.model(\"area\").where({id: val.county}).getField(\"name\", true);\n      }\n    }\n    this.assign(\"list\", data);\n    this.assign(\"goodsget\",get.goodslist);\n    this.assign(\"id\",get.id);\n    this.meta_title = \"选择收货地址\";\n    if (checkMobile(this.userAgent())) {\n      return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n    } else {\n      return this.display();\n    }\n  }\n  //添加或者更新联系人地址\n  async addaddrAction(){\n    await this.weblogin();\n\n    let data = this.post();\n    data.user_id = this.user.uid;\n    if(data.is_default == 1){\n      let find = await this.model(\"address\").where({user_id:this.user.uid,is_default:1}).select();\n      for(let val of find){\n        val.is_default = 0;\n        await this.model(\"address\").update(val);\n      }\n    }\n    //判断浏览客户端\n    if (checkMobile(this.userAgent())) {\n      if (!think.isEmpty(data.city_picke)) {\n        let city_picke = data.city_picke.split(\" \");\n        data.province = await this.model(\"area\").where({\n          name: [\"like\", `%${city_picke[0]}%`],\n          parent_id: 0\n        }).getField(\"id\", true);\n        data.city = await this.model(\"area\").where({\n          name: [\"like\", `%${city_picke[1]}%`],\n          parent_id: data.province\n        }).getField(\"id\", true);\n        data.county = await this.model(\"area\").where({\n          name: [\"like\", `%${city_picke[2]}%`],\n          parent_id: data.city\n        }).getField(\"id\", true);\n      }\n    }\n    let res\n    if(think.isEmpty(data.id)){\n      res =await this.model(\"address\").add(data);\n    }else{\n      res = await this.model(\"address\").update(data);\n    }\n\n    if(res){\n\n      //判断浏览客户端\n      if (checkMobile(this.userAgent())) {\n\n        return this.success({name:'操作成功',url:data.resurl});\n      } else {\n        let addrlist = await this.model(\"address\").where({user_id:this.user.uid}).order(\"is_default DESC,id DESC\").select();\n        for(let val of addrlist){\n          val.province = await this.model(\"area\").where({id:val.province}).getField(\"name\",true);\n          val.city = await this.model(\"area\").where({id:val.city}).getField(\"name\",true);\n          val.county = await this.model(\"area\").where({id:val.county}).getField(\"name\",true);\n        }\n        return this.success({name:'操作成功',data:addrlist,type:data.type});\n      }\n\n    }else{\n      return this.fail( '操作失败！');\n\n    }\n\n  }\n\n  //联系人设置为默认\n  async addrisdefaultAction(){\n    await this.weblogin();\n    let id = this.get(\"id\");\n    let find = await this.model(\"address\").where({user_id:this.user.uid}).order(\"is_default ASC\").select();\n    for(let val of find){\n      if(val.id == id){\n        val.is_default = 1;\n      }else{\n        val.is_default = 0;\n      }\n      await this.model(\"address\").update(val);\n      val.province = await this.model(\"area\").where({id:val.province}).getField(\"name\",true);\n      val.city = await this.model(\"area\").where({id:val.city}).getField(\"name\",true);\n      val.county = await this.model(\"area\").where({id:val.county}).getField(\"name\",true);\n    }\n    return this.success({name:'设置成功！',data:find});\n\n  }\n  //获取当前选择的地址\n  async getaddrAction(){\n    await this.weblogin();\n    let id = this.get(\"id\");\n    let addr = await this.model(\"address\").where({user_id:this.user.uid}).find(id);\n    addr.province = await this.model(\"area\").where({id:addr.province}).getField(\"name\",true);\n    addr.city = await this.model(\"area\").where({id:addr.city}).getField(\"name\",true);\n    addr.county = await this.model(\"area\").where({id:addr.county}).getField(\"name\",true);\n    return this.success({name:\"选择地址！\",data:addr});\n  }\n  //删除地址\n  async deladdrAction(){\n    await this.weblogin();\n    let id = this.param(\"id\");\n    let res = await this.model(\"address\").where({user_id:this.user.uid,id:id}).delete();\n    if(res){\n      let addrlist = await this.model(\"address\").where({user_id:this.user.uid}).order(\"is_default DESC\").select();\n      for(let val of addrlist){\n        val.province = await this.model(\"area\").where({id:val.province}).getField(\"name\",true);\n        val.city = await this.model(\"area\").where({id:val.city}).getField(\"name\",true);\n        val.county = await this.model(\"area\").where({id:val.county}).getField(\"name\",true);\n      }\n      //判断浏览客户端\n      if (checkMobile(this.userAgent())) {\n        return this.success({name:'删除成功',url:this.post(\"resurl\")});\n      } else {\n        return this.success({name:'删除成功！',data:addrlist});\n      }\n\n    }else{\n      return this.fail( '删除失败！');\n\n    }\n  }\n//编辑地址\n  async editaddrmodalAction(){\n    await this.weblogin();\n    let id = this.get(\"id\");\n    if(!think.isEmpty(id)){\n\n      //获取地址信息\n      let address = await this.model(\"address\").where({user_id:this.user.uid}).find(id);\n\n      let province, city, county;\n      //获取省份\n      if (checkMobile(this.userAgent())) {\n        province = await this.model('area').where({id: address.province}).getField(\"name\", true);\n        city = await this.model('area').where({id: address.city}).getField(\"name\", true);\n        county = await this.model('area').where({id: address.county}).getField(\"name\", true);\n      } else {\n        province = await this.model('area').where({parent_id: 0}).select();\n        city = await this.model('area').where({parent_id: address.province}).select();\n        county = await this.model('area').where({parent_id: address.city}).select();\n      }\n      this.assign(\"province\",province);\n      this.assign(\"city\",city);\n      this.assign(\"county\",county);\n      this.assign(\"info\",address);\n      this.assign(\"type\",this.get(\"type\"));\n      this.meta_title=\"编辑地址\"\n    }else {\n      this.meta_title=\"添加地址\"\n    }\n\n    if (checkMobile(this.userAgent())) {\n      this.active = \"user/index\";\n      return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n    } else {\n      return this.display();\n    }\n  }\n}"
    ]
}