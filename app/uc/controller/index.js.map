{
    "version": 3,
    "sources": [
        "../../../src/uc/controller/index.js"
    ],
    "names": [
        "indexAction",
        "weblogin",
        "model",
        "join",
        "table",
        "as",
        "on",
        "find",
        "user",
        "uid",
        "userInfo",
        "assign",
        "where",
        "user_id",
        "pay_status",
        "getField",
        "order",
        "orderTotal",
        "eval",
        "status",
        "count",
        "onOrder",
        "meta_title",
        "checkMobile",
        "userAgent",
        "mtype",
        "get",
        "vuedata",
        "json",
        "active",
        "http",
        "controller",
        "action",
        "display",
        "avatarAction",
        "uploadPath",
        "think",
        "RESOURCE_PATH",
        "path",
        "isFile",
        "type",
        "pic",
        "readFileSync",
        "end"
    ],
    "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;AACA;;;;;;;;;;;;;;AAEE;;;;;mBAKMA,W;;;;;;;;qBAME,KAAKC,QAAL,E;;;;qBAMe,KAAKC,KAAL,CAAW,QAAX,EAAqBC,IAArB,CAA0B;AAC3CC,uBAAO,cADoC;AAE3CD,sBAAM,MAFqC;AAG3CE,oBAAI,GAHuC;AAI3CC,oBAAI,CAAC,SAAD,EAAY,SAAZ;AAJuC,eAA1B,EAKlBC,IALkB,CAKb,KAAKC,IAAL,CAAUC,GALG,C;;;AAAjBC,sB;;;AAOJ,mBAAKC,MAAL,CAAY,UAAZ,EAAwBD,QAAxB;AACA;AACA;;qBACkB,KAAKR,KAAL,CAAW,OAAX,EAAoBU,KAApB,CAA0B,EAACC,SAAS,KAAKL,IAAL,CAAUC,GAApB,EAAyBK,YAAY,CAArC,EAA1B,EAAmEC,QAAnE,CAA4E,cAA5E,C;;;AAAdC,mB;AACAC,wB,GAAaC,KAAKF,MAAMb,IAAN,CAAW,GAAX,CAAL,C;;AACjB,mBAAKQ,MAAL,CAAY,YAAZ,EAA0BM,UAA1B;AACA;;qBACoB,KAAKf,KAAL,CAAW,OAAX,EAAoBU,KAApB,CAA0B,EAACO,QAAQ,CAAT,EAAWN,SAAS,KAAKL,IAAL,CAAUC,GAA9B,EAA1B,EAA8DW,KAA9D,CAAoE,IAApE,C;;;AAAhBC,qB;;AACJ,mBAAKV,MAAL,CAAY,SAAZ,EAAuBU,OAAvB;AACA;AACA,mBAAKC,UAAL,GAAkB,MAAlB;;AAEA;;mBACIC,YAAY,KAAKC,SAAL,EAAZ,C;;;;;AACEC,mB,GAAQ,KAAKC,GAAL,CAAS,OAAT,C;;oBACTD,SAAS,K;;;;;AACV;AACIE,qB,GAAU,EAACV,YAAWA,UAAZ,EAAuBI,SAAQA,OAA/B,E;+CACP,KAAKO,IAAL,CAAUD,OAAV,C;;;AACF;AACL,mBAAKE,MAAL,GAAc,KAAKC,IAAL,CAAUC,UAAV,GAAqB,GAArB,GAAyB,KAAKD,IAAL,CAAUE,MAAjD;+CACO,KAAKC,OAAL,aAAuB,KAAKH,IAAL,CAAUC,UAAjC,SAA+C,KAAKD,IAAL,CAAUE,MAAzD,C;;;;;;;+CAKF,KAAKC,OAAL,E;;;;;;;;;;;;;;;;;AAIX;;;mBACMC,Y;;;;;;;AACAzB,iB,GAAM,KAAKiB,GAAL,CAAS,KAAT,KAAiB,KAAKlB,IAAL,CAAUC,G;AACjC0B,wB,GAAaC,MAAMC,aAAN,GAAsB,iBAAtB,GAA0C5B,G;AACvD6B,kB,GAAOF,MAAMG,MAAN,CAAaJ,aAAa,GAAb,GAAmB,aAAhC,C;;AACX,mBAAKK,IAAL,CAAU,WAAV;AACIC,iB;;AACJ,kBAAIH,IAAJ,EAAU;AACR;AACAG,sBAAM,aAAGC,YAAH,CAAgBP,aAAa,GAAb,GAAmB,aAAnC,CAAN;AACD,eAHD,MAGO;AACL;AACAM,sBAAM,aAAGC,YAAH,CAAgBN,MAAMC,aAAN,GAAsB,2BAAtC,CAAN;AACD;;AAED,mBAAKM,GAAL,CAASF,GAAT",
    "file": "../../../src/uc/controller/index.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\nimport Base from './base.js';\nimport fs from 'fs';\nexport default class extends Base {\n  /**\n   * index action\n   * 用户中心主页\n   * @return {Promise} []\n   */\n  async indexAction() {\n    //auto render template file index_index.html\n    // if (!this.is_login) {\n    //     return think.statusAction(700, this.http);\n    // }\n    //判断是否登陆\n    await this.weblogin();\n    // this.http.error = new Error('成功信息！');\n    // return think.statusAction(701, this.http);\n    // this.http.error = new Error('错误信息！');\n    // return think.statusAction(702, this.http);\n    //获取用户信息\n    let userInfo = await this.model(\"member\").join({\n        table: \"member_group\",\n        join: \"left\",\n        as: \"c\",\n        on: [\"groupid\", \"groupid\"]\n    }).find(this.user.uid);\n\n    this.assign(\"userInfo\", userInfo);\n    // console.log(\"用户中心\"+JSON.stringify(userInfo) );\n    //订单交易总金额\n    let order = await this.model(\"order\").where({user_id: this.user.uid, pay_status: 1}).getField('order_amount');\n    let orderTotal = eval(order.join(\"+\"));\n    this.assign(\"orderTotal\", orderTotal);\n    //进行中的订单\n    let onOrder = await this.model(\"order\").where({status: 4,user_id: this.user.uid}).count(\"id\");\n    this.assign(\"onOrder\", onOrder);\n    //带评价的商品 TODO\n    this.meta_title = \"用户中心\";\n\n    //判断浏览客户端\n    if (checkMobile(this.userAgent())) {\n      let mtype = this.get('mtype')\n      if(mtype == 'vue'){\n        //vue\n        let vuedata = {orderTotal:orderTotal,onOrder:onOrder}\n        return this.json(vuedata)\n      }else {//普通模板\n        this.active = this.http.controller+\"/\"+this.http.action;\n        return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n      }\n\n    } else {\n      \n      return this.display();\n    }\n  }\n\n  //获取头像\n  async avatarAction() {\n    let uid = this.get(\"uid\")||this.user.uid\n    var uploadPath = think.RESOURCE_PATH + '/upload/avatar/' + uid;\n    let path = think.isFile(uploadPath + \"/\" + \"/avatar.png\");\n    this.type(\"image/png\");\n    let pic;\n    if (path) {\n      // this.download(uploadPath + \"/\" + \"/avatar.png\");\n      pic = fs.readFileSync(uploadPath + \"/\" + \"/avatar.png\")\n    } else {\n      //this.download(think.RESOURCE_PATH + '/upload/avatar/avatar.jpg')\n      pic = fs.readFileSync(think.RESOURCE_PATH + '/upload/avatar/avatar.jpg')\n    }\n\n    this.end(pic)\n  }\n\n}"
    ]
}