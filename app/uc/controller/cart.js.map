{
    "version": 3,
    "sources": [
        "../../../src/uc/controller/cart.js"
    ],
    "names": [
        "init",
        "http",
        "indexAction",
        "meta_title",
        "keywords",
        "setup",
        "WEB_SITE_KEYWORD",
        "description",
        "WEB_SITE_DESCRIPTION",
        "active",
        "controller",
        "action",
        "checkMobile",
        "userAgent",
        "display",
        "stepperAction",
        "is_login",
        "fail",
        "data",
        "post",
        "console",
        "log",
        "ids",
        "split",
        "model",
        "getstock",
        "stock",
        "qty",
        "where",
        "product_id",
        "type",
        "uid",
        "user",
        "find",
        "goods",
        "datas",
        "id",
        "price",
        "Number",
        "unit_price",
        "update",
        "res",
        "success",
        "name",
        "delcartAction",
        "isAjax",
        "val",
        "delete",
        "url",
        "get",
        "think",
        "isEmpty",
        "assign",
        "addcartAction",
        "extend",
        "json",
        "arr",
        "cart",
        "push",
        "typearr",
        "idarr",
        "item",
        "in_array",
        "splice",
        "dataarr",
        "total",
        "num",
        "dataobj",
        "get_table_name",
        "model_id",
        "table",
        "info",
        "title",
        "suk",
        "get_price",
        "weight",
        "get_pic",
        "pics",
        "pic",
        "JSON",
        "parse",
        "arr_",
        "getpr",
        "getsuk",
        "is_pic",
        "sku_price",
        "sku_weight",
        "get_url",
        "add",
        "session",
        "cartinfo",
        "eval",
        "join",
        "getorderinfoAction",
        "weblogin",
        "param",
        "addrid",
        "error",
        "Error",
        "statusAction",
        "isArray",
        "v",
        "order_amount",
        "payable_amount",
        "real_amount",
        "payable_freight",
        "real_freight",
        "cart_goods",
        "check_goods",
        "parr",
        "nums",
        "map",
        "user_id",
        "is_default",
        "order",
        "select",
        "addrlist",
        "province_num",
        "province",
        "city_num",
        "city",
        "county_num",
        "county",
        "getField",
        "status",
        "paylist",
        "getfare",
        "getfareAction",
        "createorderAction",
        "goodsids",
        "goodslist",
        "goodsarr",
        "isgoods",
        "orderid",
        "order_no",
        "fieldReverse",
        "address",
        "pay_status",
        "delivery_status",
        "create_time",
        "Date",
        "valueOf",
        "order_id",
        "ngoods",
        "newgoods",
        "goods_id",
        "goods_price",
        "goods_real_price",
        "goods_nums",
        "prom_goods",
        "addMany",
        "getstockAction"
    ],
    "mappings": "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",
    "file": "../../../src/uc/controller/cart.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\nimport Base from './base.js';\nexport default class extends Base {\n  init(http){\n    super.init(http);\n  }\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  //购物车展示\n  indexAction(){\n    //auto render template file index_index.html\n    this.meta_title = \"购物车\";//标题1\n    this.keywords = this.setup.WEB_SITE_KEYWORD ? this.setup.WEB_SITE_KEYWORD : '';//seo关键词\n    this.description = this.setup.WEB_SITE_DESCRIPTION ? this.setup.WEB_SITE_DESCRIPTION : \"\";//seo描述\n    this.active = this.http.controller+\"/\"+this.http.action;\n    //console.log(checkMobile(this.userAgent()));\n    //编辑购物车// todou\n    //判断浏览客户端\n    if (checkMobile(this.userAgent())) {\n      return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n    } else {\n      return this.display();\n    }\n  }\n  //编辑购物车数量\n  async stepperAction(){\n    if(!this.is_login){\n      return this.fail(\"请先登录\");\n    }\n    let data = this.post();\n    console.log(data);\n    let ids = data.ids.split(\"||\");\n    //检查库存\n    let stock = await this.model(\"order\").getstock(ids[0],ids[1]);\n    //think.log(stock);\n    if(data.qty > stock){\n      return this.fail(\"无货\");\n    }else {\n      let goods = await this.model(\"cart\").where({product_id:ids[0],type:ids[1]||\"\",uid:this.user.uid}).find();\n      let datas = {\n        id:goods.id,\n        qty:data.qty,\n        price:Number(data.qty) * goods.unit_price\n      }\n      await this.model(\"cart\").update(datas);\n      let res = await this.model(\"cart\").find(goods.id);\n      return this.success({name:\"有货\",data:res});\n    }\n  }\n  //删除购物车\n  async delcartAction(){\n    if(!this.is_login){\n      return this.fail(\"请先登录\");\n    }\n    if(this.isAjax(\"post\")){\n      let ids = this.post(\"ids\");\n      for(let val of ids.split(\"<>\")){\n\n        let id = await this.model(\"cart\").where({product_id:val.split(\"||\")[0],type:val.split(\"||\")[1]||\"\",uid:this.user.uid}).delete();\n      }\n      if (checkMobile(this.userAgent())) {\n        return this.success({name:\"删除成功！\",url:\"/uc/cart/index\"})\n      } else {\n        return this.success({name:\"删除成功！\"})\n      }\n\n    }else {\n      let ids = this.get(\"ids\");\n      if(think.isEmpty(ids)){\n        return this.fail(\"选择要删除的商品\")\n      }\n\n      this.assign(\"ids\",ids);\n      this.meta_title=\"删除\";\n      this.active = \"/uc/cart/index\";\n      //判断浏览客户端\n      if (checkMobile(this.userAgent())) {\n        return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n      } else {\n        return this.display();\n      }\n    }\n\n  }\n  //添加购物车\n  async addcartAction(){\n    let data = this.post();\n    data = think.extend({},data);\n    // 添加购物车前判断是否有库存\n    let stock = await this.model(\"order\").getstock(data.product_id,data.type);\n    //think.log(stock);\n    if(data.qty > stock){\n      return this.json(false);\n    }\n    console.log(data);\n    //return false;\n    let arr=[];\n    let cart = this.cart.data;\n\n    if(think.isEmpty(cart)){\n      arr.push(data);\n    }else{\n      //cart = JSON.parse(cart);\n      console.log(cart);\n      let typearr = []\n      let idarr = []\n      //已有购物车数量相加\n      for(let item of cart){\n        if((item.type == data.type)&&(item.product_id == data.product_id) ){\n          item.qty = Number(item.qty) + Number(data.qty);\n        }\n        arr.push(item);\n        idarr.push(item.product_id)\n        typearr.push(item.type);\n      }\n      //没有直接添加商品\n      if(!think.isEmpty(data.type)){\n        if(!in_array(data.type,typearr)){\n          arr.splice(0, 0,data);\n        };\n      }else {\n        if(!in_array(data.product_id,idarr)){\n          arr.splice(0, 0,data);\n        };\n      }\n\n    }\n    //console.log(arr);\n\n    //获取商品详细信息\n    //{total:222,data:[{title:\"dfd\",price:34,pic:2,}]}\n    //arr.push(data);\n    let dataarr = [];\n    let total = [];\n    let num = [];\n    for(let val of arr){\n      let dataobj = {}\n      let goods = await this.model('document').find(val.product_id);\n      let table = await this.model('model').get_table_name(goods.model_id);\n      let info = await this.model(table).find(val.product_id);\n      goods = think.extend(goods,info);\n      dataobj.title=goods.title;\n      //console.log(goods);\n      if(think.isEmpty(goods.suk)){\n        dataobj.price=get_price(goods.price,1) * Number(val.qty);\n        dataobj.unit_price =get_price(goods.price,1);\n        dataobj.weight = goods.weight;\n        dataobj.pic = await get_pic(goods.pics.split(\",\")[0],1,100,100);\n      }else{\n        let suk = JSON.parse(goods.suk);\n        let arr_ = val.type.split(\",\");\n        let getpr = getsuk(suk.data,arr_);\n        //console.log(getpr);\n        if(suk.is_pic==1){\n          dataobj.pic = await get_pic(getpr.pic,1,100,100);\n        }else {\n          dataobj.pic = await get_pic(goods.pics.split(\",\")[0],1,100,100);\n        }\n        dataobj.price = Number(getpr.sku_price) * Number(val.qty);\n        dataobj.unit_price =Number(getpr.sku_price);\n        dataobj.weight = getpr.sku_weight;\n        //console.log(dataobj.price);\n      }\n\n      dataobj.url = get_url(goods.name,goods.id);\n      dataobj.product_id = val.product_id;\n      dataobj.type = val.type;\n      dataobj.qty = Number(val.qty);\n      dataarr.push(dataobj);\n      total.push(dataobj.price);\n      num.push(dataobj.qty);\n    }\n    //缓存购物车\n    if(this.is_login){\n      await this.model('cart').where({uid:this.user.uid}).delete()\n      for(let val of dataarr){\n        val.uid = this.user.uid;\n        this.model('cart').add(val);\n      }\n    }else{\n      await this.session(\"cart_goods_item\",dataarr); //将 cookie theme 值设置为 default\n    }\n\n    let cartinfo = {\n      total:eval(total.join('+')),\n      num:eval(num.join('+')),\n      data:dataarr\n    }\n\n    return this.json(cartinfo);\n  }\n\n  //获取订单信息\n  async getorderinfoAction(){\n    //判断是否登陆\n    //!this.is_login || this.fail('您木有登陆');\n    await this.weblogin();\n    let post = this.param(\"ids\");\n    let addrid = this.get(\"addrid\");\n    if(think.isEmpty(post)){\n      this.http.error = new Error('木有选项要结算的宝贝');\n      return think.statusAction(702, this.http);\n    }\n    if(think.isEmpty(this.cart.data)){\n      this.http.error = new Error('木有宝贝提交啥订单呢？');\n      return think.statusAction(702, this.http);\n    }\n\n    //手机端接收\n    if (!think.isEmpty(addrid) && checkMobile(this.userAgent())) {\n      post = JSON.parse(post);\n    }\n    this.assign(\"goodsget\",post);\n    this.assign(\"goodsget\",post);\n    //构造购物车要结算的宝贝\n    let ids=[];\n    if(think.isArray(post)){\n      for(let v of post){\n        ids.push( v.split(\"||\"));\n      }\n    }else {\n      ids.push(post.split(\"||\"));\n    }\n    let order_amount;//订单金额\n    let payable_amount;//应付金额，商品的原价\n    let real_amount;//商品参与获得的价格\n    let payable_freight;//应付运费\n    let real_freight//实际运费\n\n    //TODO购物清单 todo\n    //购物车Post过来的商品id;暂时去购物车内所有的商品\n    //购物车内的宝贝\n    //let cart_goods = await this.model(\"cart\").where({uid:this.user.uid}).select();\n    let cart_goods = this.cart.data;\n    //筛选要结算的商品\n    let check_goods =[];\n    for(let val of cart_goods){\n      for (let v of ids){\n        if(think.isEmpty(v[1]) && think.isEmpty(val.type)){\n          if(v[0]==val.product_id){\n            check_goods.push(val);\n          }\n        }else {\n          if(v[0]==val.product_id && v[1]==val.type){\n            check_goods.push(val);\n          }\n        }\n      }\n    }\n    this.assign(\"check_goods\",check_goods);\n    //   console.log(cart_goods);\n    console.log(check_goods);\n    //应付金额\n    let parr = [];\n    let nums = [];\n    for(let val of check_goods){\n      parr.push(val.price);\n      nums.push(val.qty)\n    }\n    //console.log(parr);\n    real_amount = eval(parr.join('+'));\n    this.assign(\"real_amount\",real_amount);\n    //商品总数量\n    this.assign(\"nums\",eval(nums.join('+')));\n    //手机端接收\n    let map;\n    if ( checkMobile(this.userAgent())) {\n      if(think.isEmpty(addrid)){\n        map={user_id:this.user.uid,is_default:1}\n      }else {\n        map={user_id:this.user.uid,id:addrid}\n      }\n    }else {\n      map={user_id:this.user.uid};\n    }\n    //联系人\n    let addrlist = await this.model(\"address\").where(map).order(\"is_default DESC,id DESC\").select();\n    if(!think.isEmpty(addrlist)){\n      for(let val of addrlist){\n        val.province_num = val.province;\n        val.city_num = val.city;\n        val.county_num = val.county;\n        val.province = await this.model(\"area\").where({id:val.province}).getField(\"name\",true);\n        val.city = await this.model(\"area\").where({id:val.city}).getField(\"name\",true);\n        val.county = await this.model(\"area\").where({id:val.county}).getField(\"name\",true);\n      }\n    }\n    this.assign(\"addrlist\",addrlist);\n\n    /** 现在用ping++集成直接，但接入暂时屏蔽\n     //支付方式\n     let paylist = await this.model(\"payment\").where({status:1}).order(\"sort ASC\").select();\n     for(let val of paylist){\n           val.logo =  await this.model(\"pay_plugin\").where({id:val.plugin_id}).getField(\"logo\",true);\n        }\n     this.assign(\"paylist\",paylist);\n     **/\n        //ping++ 支付渠道 pc网页\n        //根据不同的客户端调用不同的支付方式\n    let type;\n    if (checkMobile(this.userAgent())) {\n      type = 2;\n    }else {\n      type = 1;\n    }\n    let paylist = await this.model(\"pingxx\").where({type:type,status:1}).order(\"sort ASC\").select();\n    this.assign(\"paylist\",paylist);\n\n    //运费计算\n    //    1、如果店铺只使用统一运费，那么顾客下单计算时按最低运费收取。\n    //    2、如果店铺只使用一种运费模板规则，那么顾客下单计算时均按此规则收取运费。\n    //    3、如果店铺使用了不同的运费模板规则，那么顾客下单时各运费模板规则先单独计算运费再叠加。\n    //    4、如果店铺同时使用统一运费和不同的运费模板规则，那么顾客下单时统一运费单独计算运费，不同的运费模板\n    //TODO\n    //计算商品的总重量\n    real_freight = await this.model(\"fare\").getfare(check_goods,null,this.user.uid);\n    this.assign(\"real_freight\",real_freight);\n    //订单促销优惠信息\n    //TODO\n\n\n    //订单金融 实付金额+邮费-订单优惠金额\n    //TODO\n    // console.log(real_amount);\n    order_amount =Number(real_amount) + Number(real_freight)\n    this.assign(\"order_amount\",order_amount);\n\n    //this.end(cart_goods);\n    this.meta_title = \"确认订单信息\";//标题1\n    this.keywords = this.setup.WEB_SITE_KEYWORD ? this.setup.WEB_SITE_KEYWORD : '';//seo关键词\n    this.description = this.setup.WEB_SITE_DESCRIPTION ? this.setup.WEB_SITE_DESCRIPTION : \"\";//seo描述\n    if (checkMobile(this.userAgent())) {\n      return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n    } else {\n      return this.display();\n    }\n  }\n\n  //计算运费\n  async getfareAction(){\n    if(!this.is_login){\n      return this.fail(\"你木有登录！\")\n    }\n    let cart_goods = this.cart.data;\n    //应付金额\n    let parr = [];\n    for(let val of cart_goods){\n      parr.push(val.price);\n    }\n    //console.log(parr);\n    let real_amount = eval(parr.join('+'));\n    let real_freight =  await this.model(\"fare\").getfare(cart_goods,this.get(\"id\"),this.user.uid);\n    let order_amount =Number(real_amount) + Number(real_freight);\n    let res = {\n      real_freight:real_freight,\n      order_amount:order_amount\n    }\n    return this.json(res);\n  }\n  //订单总额\n\n\n//创建订单\n  async createorderAction(){\n    await this.weblogin();\n    let data = this.post();\n    // console.log(data);\n    // return false;\n    let order_amount;//订单金额\n    let payable_amount;//应付金额，商品的原价\n    let real_amount;//商品参与获得的价格\n    let payable_freight;//应付运费\n    let real_freight//实际运费\n    //判断购物车内是否有商品如果没有停止执行，如果有则删除\n    let goodsids;\n    let goodslist =JSON.parse(data.goodslist);\n    let goodsarr=[];\n    for (let goods of goodslist){\n      //检查购物车内的宝贝是否有库存\n      let stock = await this.model(\"order\").getstock(goods.product_id,goods.type);\n      //think.log(stock);\n      if(goods.qty > stock){\n        return this.fail(\"购物车内有已经售罄的商品，请返回购物车重新编辑！\");\n      }\n      goodsarr.push(goods.id);\n    }\n    let isgoods = await this.model(\"cart\").where({id:['IN',goodsarr]}).select();\n    delete data.goodslist;\n    //isgoods = [];\n    if(think.isEmpty(isgoods)){\n      return this.fail('请不要重复创建表单！');\n    }else{\n      //清空购物车内已经提交的商品\n      await this.model(\"cart\").where({id:['IN',goodsarr]}).delete()\n    }\n\n    //用户\n    data.user_id=this.user.uid;\n    //生成订单编号//todo\n    // let nowtime = new Date().valueOf();\n    // let oid =[\"d\",this.user.uid,nowtime]\n    // data.order_no = oid.join(\"\");\n    data.order_no = await this.model(\"order\").orderid();\n    //添加送货地址\n    let address = await this.model(\"address\").fieldReverse(\"id,user_id,is_default\").find(data.address);\n    console.log(address);\n    data = think.extend(data,address);\n\n    //应付金额\n    let parr = [];\n    for(let val of isgoods){\n      parr.push(val.price);\n    }\n    console.log(parr);\n    real_amount = eval(parr.join('+'));\n    data.real_amount = real_amount;\n\n    //运费计算\n    //    1、如果店铺只使用统一运费，那么顾客下单计算时按最低运费收取。\n    //    2、如果店铺只使用一种运费模板规则，那么顾客下单计算时均按此规则收取运费。\n    //    3、如果店铺使用了不同的运费模板规则，那么顾客下单时各运费模板规则先单独计算运费再叠加。\n    //    4、如果店铺同时使用统一运费和不同的运费模板规则，那么顾客下单时统一运费单独计算运费，不同的运费模板\n    //TODO\n    //计算商品的总重量\n\n    data.real_freight = await this.model(\"fare\").getfare(isgoods,data.address,this.user.uid);;\n\n\n\n    //支付状态 pay_stayus 0:未付款 ,1:已付款\n    data.pay_status = 0;\n    //订单状态 status 2:等待审核，3:已审核\n    data.status = 2;\n    //发货状态 delivery_status 0:未发货，1:已发货\n    data.delivery_status = 0;\n    //订单创建时间 create_time\n    data.create_time = new Date().valueOf();\n    //客户订单备注\n    //TODO\n    //console.log(real_amount);\n    order_amount =Number(data.real_amount) + Number(data.real_freight)\n    data.order_amount = order_amount;\n    //生成订单\n    let order_id = await this.model(\"order\").add(data);\n\n    //储存宝贝\n    //let order_id = 22;\n    console.log(isgoods);\n    let ngoods = [];\n    for(let goods of isgoods){\n      let newgoods = {};\n      newgoods.order_id = order_id;\n      newgoods.goods_id = goods.product_id;\n      newgoods.goods_price = goods.unit_price;\n      newgoods.goods_real_price = goods.unit_price;\n      newgoods.goods_nums = goods.qty;\n      newgoods.prom_goods = JSON.stringify(goods);\n      ngoods.push(newgoods);\n    }\n    console.log(ngoods);\n    await this.model(\"order_goods\").addMany(ngoods);\n    console.log(data);\n    //减少订单中商品的库存\n    await this.model(\"order\").stock(order_id,true);\n\n    return this.success({name:'订单创建成功，正在跳转支付页面！',url:`/uc/pay/pay?order=${order_id}&setp=3`});\n\n  }\n  //实时查询商品库存\n  async getstockAction(){\n    let data = this.get();\n    let stock = await this.model(\"order\").getstock(data.id,data.type);\n    return this.json(stock);\n  }\n}"
    ]
}