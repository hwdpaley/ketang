{
    "version": 3,
    "sources": [
        "../../../src/uc/controller/wechat_safe_save_150326.js"
    ],
    "names": [
        "init",
        "http",
        "__before",
        "model",
        "getset",
        "setup",
        "api",
        "wx_AppID",
        "wx_AppSecret",
        "islogin",
        "session",
        "user",
        "res",
        "think",
        "isEmpty",
        "uid",
        "indexAction",
        "echostr",
        "get",
        "end",
        "reply",
        "message",
        "category",
        "id",
        "field",
        "error",
        "Error",
        "statusAction",
        "info",
        "cate",
        "status",
        "display",
        "textAction",
        "console",
        "log",
        "post",
        "key",
        "Content",
        "trim",
        "kmodel",
        "where",
        "keyword_name",
        "find",
        "isKey",
        "rulemodel",
        "rule_id",
        "getField",
        "replyliststr",
        "replylisttmp",
        "split",
        "replylist",
        "i",
        "push",
        "randomi",
        "parseInt",
        "Math",
        "random",
        "length",
        "replymodel",
        "data",
        "reply_type",
        "order",
        "select",
        "datas",
        "content",
        "type",
        "JSON",
        "parse",
        "eventAction",
        "Event",
        "FromUserName",
        "getUser",
        "userinfo",
        "username",
        "nickname",
        "member",
        "resuser",
        "openid",
        "add",
        "cookie",
        "delete",
        "wx_user",
        "EventKey",
        "news_item",
        "material_wx_content",
        "list",
        "v",
        "picurl",
        "thumb_url",
        "__call",
        "DEFULT_AUTO_REPLY",
        "groupsAction",
        "self",
        "getGroups",
        "err",
        "result",
        "val",
        "getwithgroupAction",
        "getWhichGroup",
        "creategroupAction",
        "createGroup",
        "masssendtextAction",
        "massSendText",
        "masssendnewsAction",
        "massSendNews",
        "getmaterialsAction",
        "getMaterials",
        "uploadmaterialAction",
        "uploadMaterial",
        "getmaterialAction",
        "getMaterial",
        "getmediaAction",
        "getMedia",
        "uploadNewsMaterialAction",
        "uploadNewsMaterial",
        "uploadnewsAction",
        "uploadNews",
        "uploadimageAction",
        "uploadImage",
        "uploadmediaAction",
        "uploadMedia",
        "testAction",
        "picpath",
        "ROOT_PATH",
        "path",
        "getusersAction",
        "getFollowers",
        "Console",
        "getuserinfoAction",
        "getuserinfo",
        "deferred",
        "defer",
        "lang",
        "resolve",
        "promise",
        "cache",
        "getusersinfoAction",
        "batchGetUsers",
        "controller",
        "base"
    ],
    "mappings": "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",
    "file": "../../../src/uc/controller/wechat_safe_save_150326.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\nimport API from 'wechat-api';\nexport default class extends think.controller.base {\n    init(http) {\n        super.init(http);\n\n    }\n    async __before() {\n            //网站配置\n            this.setup = await this.model(\"setup\").getset();\n            this.api = new API(this.setup.wx_AppID, this.setup.wx_AppSecret);\n        }\n        /**\n         * 判断是否登录\n         * @returns {boolean}\n         */\n    async islogin() {\n            //前台判断是否登录\n            let user = await this.session('webuser');\n            let res = think.isEmpty(user) ? false : user.uid;\n            return res;\n\n        }\n        /**\n         * 微信服务器验证\n         * index action\n         * @return {Promise} []\n         */\n    indexAction() {\n        let echostr = this.get('echostr');\n        return this.end(echostr);\n    }\n    reply(message) {\n        this.http.res.reply(message);\n    }\n\n    //获取分类信息\n    async category(id, field) {\n            id = id || 0;\n            field = field || \"\";\n            if (think.isEmpty(id)) {\n                //this.fail('没有指定数据分类！');\n                this.http.error = new Error('没有指定数据分类！');\n                return think.statusAction(702, this.http);\n            }\n            let cate = await this.model(\"category\").info(id, field);\n            //console.log(cate);\n            if (cate && 1 == cate.status) {\n\n                switch (cate.display) {\n                    case 0:\n                        //this.fail('该分类禁止显示')\n                        this.http.error = new Error('该分类禁止显示！');\n                        return think.statusAction(702, this.http);\n                        break;\n                        //TODO:更多分类显示状态判断\n                    default:\n\n                        return cate;\n                }\n\n            } else {\n\n                //this.fail(\"分类不存在或者被禁用！\");\n                this.http.error = new Error('分类不存在或者被禁用！');\n                return think.statusAction(702, this.http);\n            }\n        }\n        //关键词消息回复\n    async textAction() {\n        console.log(this.http);\n        let message = this.post();\n        console.log(\"message-------------------\" + message);\n\n        let key = message.Content.trim();\n        let kmodel = this.model('wx_keywords');\n        let isKey = await kmodel.field('rule_id').where({ keyword_name: key }).find();\n        if (!think.isEmpty(isKey)) {\n            //是关键字\n            let rulemodel = this.model('wx_keywords_rule');\n            let replyliststr = await rulemodel.where({ id: isKey.rule_id }).getField('reply_id', true);\n            let replylisttmp = replyliststr.split(',');\n            let replylist = [];\n            for (let i in replylisttmp) {\n                if (replylisttmp[i] != '') {\n                    replylist.push(replylisttmp[i]);\n                }\n            }\n            if (!think.isEmpty(replylist)) {\n                let randomi = parseInt(Math.random() * replylist.length);\n                let replymodel = this.model('wx_replylist');\n                let data = await replymodel.where({ id: replylist[randomi] }).getField('content', true);\n                return this.reply(data);\n            }\n        }\n        //普通消息回复\n        let replymodel = this.model('wx_replylist');\n        let datas = await replymodel.where({ reply_type: 2 }).order(\"create_time DESC\").select();\n        let data = datas[0];\n        let content;\n        switch (data.type) {\n            case \"text\":\n                content = data.content;\n                break;\n            case \"news\":\n                content = JSON.parse(data.content);\n                break;\n        }\n        this.reply(content);\n\n    }\n\n    //事件关注\n    async eventAction() {\n        let message = this.post();\n        switch (message.Event) {\n\n            case \"subscribe\": //首次关注\n                console.log(\"首次关注------\" + message.FromUserName);\n                let userinfo = await getUser(this.api, message.FromUserName);\n                console.log(\"userinfo-----------\" + JSON.stringify(userinfo));\n                let member=await this.model(\"member\").where({ username: userinfo.nickname }).find();\n                if (!think.isEmpty(member)) {\n                    userinfo.uid=member.uid;\n                }\n                let resuser = this.model(\"wx_user\").where({ openid: userinfo.openid }).find();\n                if (think.isEmpty(resuser.openid)) {\n                    await this.model(\"wx_user\").add(userinfo);\n                }\n\n                let datas = await this.model(\"wx_replylist\").where({ reply_type: 1 }).order(\"create_time DESC\").select();\n                let data = datas[0];\n                let content;\n                switch (data.type) {\n                    case \"text\":\n                        content = data.content;\n                        break;\n                    case \"news\":\n                        content = JSON.parse(data.content);\n                        break;\n                }\n                console.log(\"bieber_wx_url-------------\"+this.cookie(\"bieber_wx_url\"));\n                this.reply(content);\n                // await action(\"topic/index\",\"index\");\n                // this.redirect(this.setup.wx_url);\n                break;\n            case \"unsubscribe\": //取消关注\n                console.log(\"取消关注-------------\");\n                let wx_user = await this.model(\"wx_user\").where({ openid: message.FromUserName }).delete();\n\n                console.log(\"message------\" + message.FromUserName);\n                await this.session('wx_openid', null);\n                break;\n            case \"CLICK\": //click事件坚挺\n                let res = await this.model(\"wx_material\").find(message.EventKey);\n                let news_item = JSON.parse(res.material_wx_content);\n                let list = news_item.news_item;\n                for (let v of list) {\n                    v.picurl = v.thumb_url;\n                }\n                this.reply(list);\n                //todo\n                break;\n            case \"SCAN\": //扫码事件监听\n                //todo\n                console.log(message);\n                break;\n            default:\n                console.log(message);\n                break;\n        }\n        // this.reply(JSON.stringify(message));\n    }\n    __call() {\n        this.reply(DEFULT_AUTO_REPLY);\n    }\n\n\n    /**\n     * 获取用户分组\n     */\n    groupsAction() {\n            //let api = new API('wxec8fffd0880eefbe', 'a084f19ebb6cc5dddd2988106e739a07');\n            // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n            let self = this;\n            this.api.getGroups((err, result) => {\n                if (!think.isEmpty(result)) {\n                    //think.log(result['groups'],\"test\");\n                    for (let val of result['groups']) {\n                        think.log(val['name'], \"test\");\n                    };\n                    self.end(result);\n                } else {\n                    console.error('err' + err);\n                }\n\n            });\n        }\n        /**\n         * 查询用户在哪个分组\n         */\n    getwithgroupAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.getWhichGroup('oVe9Ew0zHFp0up1CeNcK2J5RL4xs', (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"test\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 创建用户分组\n     */\n    creategroupAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.createGroup('旅游', (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"test\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 群发文本消息\n     */\n    masssendtextAction() {\n            // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n            //let api = new API('wxe8c1b5ac7db990b6', 'ebcd685e93715b3470444cf6b7e763e6');\n            let self = this;\n            this.api.massSendText('你好，恭喜你中奖了,这是测试信息', ['oXJPVwCuRDHRshz1yz5t-1Fdh9Ig', 'oXJPVwA0peWnTbnx3aDytJtCwdeo'], (err, result) => {\n                if (!think.isEmpty(result)) {\n                    think.log(result, \"masssendtext\");\n                    self.end(result);\n                } else {\n                    console.error('err' + err);\n                }\n\n            });\n        }\n        /**\n         * 群发图文消息\n         */\n    masssendnewsAction() {\n        //let api = new API('wxec8fffd0880eefbe', 'a084f19ebb6cc5dddd2988106e739a07');\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.massSendNews('kiW60VzuoCNnoIgdpmrQ8mUaCeDHGOTg4z_ug1DtPkI', ['oXJPVwCuRDHRshz1yz5t-1Fdh9Ig', 'oXJPVwN4JY0Y3fAVDuvl3EWh2_uQ'], (err, result) => {\n            //api.massSendNews('ys1SXTdWnZhTZQB77MODarSaJ36xfoTG15deo5aGM3eRvEiuT034AMaUocc66uq9','0',(err,result)=>{\n            if (!think.isEmpty(result)) {\n                think.log(result, \"masssendnews\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 获取永久素材列表\n     */\n    getmaterialsAction() {\n        //let api = new API('wxec8fffd0880eefbe', 'a084f19ebb6cc5dddd2988106e739a07');\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.getMaterials('image', 0, 10, (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"test\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 上传永久素材（缩略图）\n     */\n    uploadmaterialAction() {\n\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        //{\"media_id\":\"Snt_yv6I9f5KMAJKz4GNZAjZSXJeIgZVbUgRey2STH8\",\"url\":\"https://mmbiz.qlogo.cn/mmbiz/yNHpDQhqmZmaEjdMt6hokMa5ic2a8tjEmDp2tHVAxe3orww1bN4YIiayUBThKC9k3PKyr7OxeZ0vIklb2tMaKDXw/0?wx_fmt=jpeg\"}\n        this.api.uploadMaterial('D:\\\\webStorm\\\\CmsWing\\\\www\\\\static\\\\admin\\\\img\\\\m0.jpg', 'thumb', (err, result) => {\n            //api.uploadThumbMaterial('D:\\\\webStorm\\\\CmsWing\\\\www\\\\static\\\\admin\\\\img\\\\m21.jpg',(err,result)=>{\n            if (!think.isEmpty(result)) {\n                think.log(result, \"uploadmaterial\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 获取永久素材\n     */\n    getmaterialAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.getMaterial('PW4hZzpj-j3qdr_hpRFsePOXn8w4YkAPcKfrOfnvVDCHcYZsp81YZcjLiUMiKg3s', (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"getmaterial\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 获取临时素材\n     */\n    getmediaAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.getMedia('PW4hZzpj-j3qdr_hpRFsePOXn8w4YkAPcKfrOfnvVDCHcYZsp81YZcjLiUMiKg3s', (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"getmedia\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n        });\n    }\n\n    /**\n     * 新增永久图文素材\n     */\n    uploadNewsMaterialAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.uploadNewsMaterial({\n            \"articles\": [{\n                \"thumb_media_id\": \"_P6PWPwDdEROB-VD0RWrThuI-CfLgi3vm88mOWHvqtyAmU8Jp3UU1sNs2wfAaYf7\",\n                \"author\": \"HH\",\n                \"title\": \"Happy Day\",\n                \"content_source_url\": \"www.qq.com\",\n                \"content\": \"hello word\",\n                \"digest\": \"test\",\n                \"show_cover_pic\": \"1\"\n            }]\n        }, (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"uploadNewsMaterial\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n        });\n    }\n\n\n    /**\n     * 上传多媒体文件（图文）\n     */\n    uploadnewsAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.uploadNews({\n            \"articles\": [{\n                \"thumb_media_id\": \"_P6PWPwDdEROB-VD0RWrThuI-CfLgi3vm88mOWHvqtyAmU8Jp3UU1sNs2wfAaYf7\",\n                \"author\": \"HH\",\n                \"title\": \"Happy Day\",\n                \"content_source_url\": \"www.qq.com\",\n                \"content\": \"hello word\",\n                \"digest\": \"test\",\n                \"show_cover_pic\": \"1\"\n            }]\n        }, (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"uploadnews\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 上传图文消息内的图片获取URL\n     */\n    uploadimageAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.uploadImage('D:\\\\webStorm\\\\CmsWing\\\\www\\\\static\\\\admin\\\\img\\\\a3.png', (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"uploadimag\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 临时(获取thumb_media_id)\n     */\n    uploadmediaAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        this.api.uploadMedia('D:\\\\webStorm\\\\CmsWing\\\\www\\\\static\\\\admin\\\\img\\\\m0.jpg', 'thumb', (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"uploadmedia\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n\n        });\n    }\n\n    /**\n     * 测试\n     */\n    async testAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        let self = this;\n        let picpath = await this.model('picture').find(34);\n        this.api.uploadMedia(think.ROOT_PATH + '/www/' + picpath.path, 'thumb', (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"getmaterial\");\n                self.end(result);\n            } else {\n                console.error('err' + err);\n            }\n        });\n    }\n\n    /**\n     * 获取关注者列表\n     */\n    async getusersAction() {\n            //let api = new API('wxec8fffd0880eefbe', 'a084f19ebb6cc5dddd2988106e739a07');\n            // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n            let self = this;\n            this.api.getFollowers((err, result) => {\n                if (!think.isEmpty(result)) {\n\n                    think.log(result, \"getuser\");\n                    self.end(result['data']);\n                } else {\n                    Console.error('err' + err)\n                }\n            });\n        }\n        /**\n         * 获取用户基本信息\n         */\n\n    async getuserinfoAction() {\n\n        let getuserinfo = function(api, openid) {\n            let deferred = think.defer();\n            api.getUser({ openid: openid, lang: 'zh_CN' }, (err, result) => {\n                if (!think.isEmpty(result)) {\n                    think.log(result, \"getuserinfo\");\n                    deferred.resolve(result);\n                } else {\n                    Console.error('err' + err)\n                }\n            });\n            return deferred.promise;\n        }\n        let openid = await this.cache('getuserinfo');\n        let result = await getuserinfo(this.api, openid);\n        return result;\n        // think.log(openid, \"openid\");\n        // // let deferred = think.defer();\n        // // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        // let self = this;\n        // this.api.getUser({ openid: openid, lang: 'zh_CN' }, (err, result) => {\n        //     if (!think.isEmpty(result)) {\n        //         think.log(result, \"getuserinfo\");\n        //         // this.session('getuserinfo',result);\n        //         return self.end(result);\n        //         // return result;\n        //         // deferred.resolve(result);\n        //         // return deferred.promise;\n        //     } else {\n        //         Console.error('err' + err)\n        //     }\n        //     // return deferred.promise;\n        // });\n    }\n\n    /**\n     * 批量获取用户基本信息\n     */\n    async getusersinfoAction() {\n        // let api = new API('wx31783e0b591a7f4b', 'c4cca2d1622fd3e6f70aa78d2621db3b');\n        // let self = this;//tina,tony\n        this.api.batchGetUsers(['oXJPVwCuRDHRshz1yz5t-1Fdh9Ig', 'oXJPVwN4JY0Y3fAVDuvl3EWh2_uQ'], (err, result) => {\n            if (!think.isEmpty(result)) {\n                think.log(result, \"getusersinfo\");\n                self.end(result);\n            } else {\n                Console.error('err' + err)\n            }\n        });\n    }\n\n\n}\n"
    ]
}