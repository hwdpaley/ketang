{
    "version": 3,
    "sources": [
        "../../../src/common/service/payment.js"
    ],
    "names": [
        "init",
        "http",
        "pingxx",
        "channel",
        "order_no",
        "order_amount",
        "ip",
        "open_id",
        "create",
        "pingpp",
        "config",
        "deferred",
        "think",
        "defer",
        "charges",
        "err",
        "charge",
        "console",
        "log",
        "resolve",
        "promise",
        "http_",
        "extra",
        "amount",
        "Number",
        "cache",
        "setup",
        "require",
        "PINGXX_LIVE_SECRET_KEY",
        "setPrivateKeyPath",
        "RESOURCE_PATH",
        "success_url",
        "host",
        "limit_pay",
        "product_id",
        "result_url",
        "bfb_login",
        "subject",
        "body",
        "currency",
        "client_ip",
        "app",
        "id",
        "PINGXX_APP_ID",
        "retrieve",
        "res",
        "service",
        "base"
    ],
    "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGI;;;;qBAIAA,I,iBAAKC,I,EAAM;AACP,sCAAMD,IAAN,YAAWC,IAAX;AACA,aAAKA,IAAL,GAAYA,IAAZ;AACH,K;;AAEL;;;qBACUC,M;+FAAOC,O,EAASC,Q,EAAUC,Y,EAAcC,E,EAAGC,O;6DAwEpCC,M;;;;;AAAAA,kC,YAAAA,M,CAAOC,M,EAAQC,M,EAAQ;AAC5B,oCAAIC,WAAWC,MAAMC,KAAN,EAAf;AACAJ,uCAAOK,OAAP,CAAeN,MAAf,CAAsBE,MAAtB,EAA8B,UAAUK,GAAV,EAAeC,MAAf,EAAuB;AACjDC,4CAAQC,GAAR,CAAYH,GAAZ;AACAJ,6CAASQ,OAAT,CAAiBH,MAAjB;AACH,iCAHD;AAIA,uCAAOL,SAASS,OAAhB;AACH,6B;;AA9EGC,iC,GAAMT,MAAMF,MAAN,CAAa,OAAb,KAAuB,CAAvB,GAAyB,MAAzB,GAAgC,O;AACtCA,kC;AACAY,iC,GAAQ,E;AACRC,kC,GAASC,OAAOnB,YAAP,IAAuB,G;;mCAClBO,MAAMa,KAAN,CAAY,OAAZ,C;;;AAAdC,iC;AACAjB,kC,GAASkB,QAAQ,QAAR,EAAkBD,MAAME,sBAAxB,C;;AACbnB,mCAAOoB,iBAAP,CAAyBjB,MAAMkB,aAAN,GAAsB,2CAA/C;0CACQ3B,O;4DACC,kB,wBAOA,W,wBAOA,W,wBAGA,U,wBAMA,W,wBAMA,Y,wBAOA,S,wBAQI,Q;;;;AA3CL;AACAmB,oCAAQ;AACJS,6CAAgBV,KAAhB,WAA2B,KAAKpB,IAAL,CAAU+B,IAArC;AADI,6BAAR;;;;;AAMA;AACAV,oCAAQ;AACJW,2CAAW,IADP,EACaC,YAAY9B;AADzB,6BAAR;;;;;;;;AASA;AACAkB,oCAAQ;AACJa,4CAAed,KAAf,WAA0B,KAAKpB,IAAL,CAAU+B,IAApC;AADI,6BAAR;;;;AAKA;AACAV,oCAAQ;AACJa,4CAAed,KAAf,WAA0B,KAAKpB,IAAL,CAAU+B,IAApC;AADI,6BAAR;;;;AAKA;AACAV,oCAAQ;AACJS,6CAAgBV,KAAhB,WAA2B,KAAKpB,IAAL,CAAU+B,IAArC;AADI,6BAAR;;;;;AAMA;AACAV,oCAAQ;AACJa,4CAAed,KAAf,WAA0B,KAAKpB,IAAL,CAAU+B,IAApC,mBADI;AAEJI,2CAAU;AAFN,6BAAR;;;;;AAOA;AACAd,oCAAO;AACHf,yCAAQA;AADL,6BAAP;;;;AAKRG,qCAAS;AACL2B,yCAAS,QADJ;AAELC,sCAAM,QAFD;AAGLf,wCAAQA,MAHH;AAILnB,0CAAUA,QAJL;AAKLD,yCAASA,OALJ;AAMLoC,0CAAU,KANL;AAOLC,2CAAWlC,EAPN;AAQLmC,qCAAK,EAACC,IAAIhB,MAAMiB,aAAX,EARA;AASLrB,uCAAOA;AATF,6BAAT;AAWAL,oCAAQC,GAAR,CAAYR,MAAZ;;mCAUaF,OAAOC,MAAP,EAAeC,MAAf,C;;;;;;;;;;;;;;;;;;;;qBAIXM,M;iGAAO0B,E;+BAIAE,Q;;;;;AAAAA,oC,YAAAA,Q,CAASnC,M,EAAQiC,E,EAAI;AAC1B,oCAAI/B,WAAWC,MAAMC,KAAN,EAAf;AACAJ,uCAAOK,OAAP,CAAe8B,QAAf,CAAwBF,EAAxB,EAA4B,UAAU3B,GAAV,EAAeC,MAAf,EAAuB;AAC3CC,4CAAQC,GAAR,CAAYH,GAAZ;AACAJ,6CAASQ,OAAT,CAAiBH,MAAjB;AACH,iCAHL;AAKA,uCAAOL,SAASS,OAAhB;AACH,6B;;;mCAXiBR,MAAMa,KAAN,CAAY,OAAZ,C;;;AAAdC,iC;AACAjB,kC,GAASkB,QAAQ,QAAR,EAAkBD,MAAME,sBAAxB,C;;AACbnB,mCAAOoB,iBAAP,CAAyBjB,MAAMkB,aAAN,GAAsB,2CAA/C;;mCAWgBc,SAASnC,MAAT,EAAiBiC,EAAjB,C;;;AAAZG,+B;8DAEGA,G;;;;;;;;;;;;;;;;;;EAhHcjC,MAAMkC,OAAN,CAAcC,I",
    "file": "../../../src/common/service/payment.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n\n'use strict';\n\nexport default class extends think.service.base {\n    /**\n     * init\n     * @return {}         []\n     */\n    init(http) {\n        super.init(http);\n        this.http = http;\n    }\n\n//发起付款\n    async pingxx(channel, order_no, order_amount, ip,open_id) {\n        let http_=think.config(\"http_\")==1?\"http\":\"https\";\n        let config;\n        let extra = {};\n        let amount = Number(order_amount) * 100;\n        let setup = await think.cache(\"setup\")\n        let pingpp = require('pingpp')(setup.PINGXX_LIVE_SECRET_KEY);\n        pingpp.setPrivateKeyPath(think.RESOURCE_PATH + \"/upload/pingpp/bieber_rsa_private_key.pem\");\n        switch (channel) {\n            case 'alipay_pc_direct':\n                //支付宝网页支付\n                extra = {\n                    success_url: `${http_}://${this.http.host}/uc/pay/payres`\n                }\n\n                break;\n            case 'wx_pub_qr':\n                //微信网pc页扫码支付\n                extra = {\n                    limit_pay: null, product_id: order_no\n                }\n\n                break;\n            case 'alipay_qr':\n                //支付宝PC网页扫码支付\n                break;\n            case 'upacp_pc':\n                //网银pc网页支付\n                extra = {\n                    result_url: `${http_}://${this.http.host}/uc/pay/payres`\n                }\n                break;\n            case 'upacp_wap':\n                //网银pc网页支付\n                extra = {\n                    result_url: `${http_}://${this.http.host}/uc/pay/payres`\n                }\n                break;\n            case 'alipay_wap':\n                //支付宝网页支付\n                extra = {\n                    success_url: `${http_}://${this.http.host}/uc/pay/payres`\n                }\n\n                break;\n            case 'bfb_wap':\n                //支付宝网页支付\n                extra = {\n                    result_url: `${http_}://${this.http.host}/uc/pay/payres`,\n                    bfb_login:false\n                }\n\n                break;\n                case 'wx_pub':\n                // 微信公共账号支付\n                extra ={\n                    open_id:open_id\n                }\n                break;\n        }\n        config = {\n            subject: \"网站订单支付\",\n            body: \"网站订单支付\",\n            amount: amount,\n            order_no: order_no,\n            channel: channel,\n            currency: \"cny\",\n            client_ip: ip,\n            app: {id: setup.PINGXX_APP_ID},\n            extra: extra\n        }\n        console.log(config);\n        function create(pingpp, config) {\n            let deferred = think.defer();\n            pingpp.charges.create(config, function (err, charge) {\n                console.log(err);\n                deferred.resolve(charge);\n            });\n            return deferred.promise;\n        }\n\n        return await create(pingpp, config);\n    }\n\n\n    async charge(id) {\n        let setup = await think.cache(\"setup\")\n        let pingpp = require('pingpp')(setup.PINGXX_LIVE_SECRET_KEY);\n        pingpp.setPrivateKeyPath(think.RESOURCE_PATH + \"/upload/pingpp/bieber_rsa_private_key.pem\");\n        function retrieve(pingpp, id) {\n            let deferred = think.defer();\n            pingpp.charges.retrieve(id, function (err, charge) {\n                    console.log(err);\n                    deferred.resolve(charge);\n                }\n            );\n            return deferred.promise;\n        }\n\n        let res = await retrieve(pingpp, id);\n        //console.log(res);\n        return res;\n    }\n}"
    ]
}