{
    "version": 3,
    "sources": [
        "../../../../src/common/adapter/alidayu/topclient.js"
    ],
    "names": [
        "urllib",
        "require",
        "util",
        "TopClient",
        "options",
        "appkey",
        "appsecret",
        "Error",
        "REST_URL",
        "prototype",
        "invoke",
        "method",
        "params",
        "reponseNames",
        "defaultResponse",
        "type",
        "callback",
        "request",
        "err",
        "result",
        "response",
        "length",
        "i",
        "name",
        "undefined",
        "_wrapJSON",
        "s",
        "matchs",
        "match",
        "m",
        "replace",
        "split",
        "trim",
        "IGNORE_ERROR_CODES",
        "checkRequired",
        "args",
        "timestamp",
        "format",
        "app_key",
        "v",
        "sign_method",
        "k",
        "sign",
        "data",
        "agent",
        "that",
        "buffer",
        "toString",
        "JSON",
        "parse",
        "e",
        "errRes",
        "error_response",
        "sub_msg",
        "sub_code",
        "msg",
        "code",
        "YYYYMMDDHHmmss",
        "sorted",
        "sort",
        "basestring",
        "l",
        "md5",
        "toUpperCase",
        "execute",
        "apiname",
        "getApiResponseName",
        "exports"
    ],
    "mappings": "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",
    "file": "../../../../src/common/adapter/alidayu/topclient.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nvar urllib = require('urllib');\nvar util = require('./toputil');\n\n/**\n * TOP API Client.\n *\n * @param {Object} options, must set `appkey` and `appsecret`.\n * @constructor\n */\nfunction TopClient(options) {\n    if (!(this instanceof TopClient)) {\n        return new TopClient(options);\n    }\n    options = options || {};\n    if (!options.appkey || !options.appsecret) {\n        throw new Error('appkey or appsecret need!');\n    }\n    this.REST_URL = options.REST_URL || 'http://gw.api.taobao.com/router/rest';\n    this.appkey = options.appkey;\n    this.appsecret = options.appsecret;\n}\n\n/**\n * Invoke an api by method name.\n *\n * @param {String} method, method name\n * @param {Object} params\n * @param {Array} reponseNames, e.g. ['tmall_selected_items_search_response', 'tem_list', 'selected_item']\n * @param {Object} defaultResponse\n * @param {String} type\n * @param {Function(err, response)} callback\n */\nTopClient.prototype.invoke = function (method, params, reponseNames, defaultResponse, type, callback) {\n    params.method = method;\n    this.request(params, type, function (err, result) {\n        if (err) {\n            return callback(err);\n        }\n        var response = result;\n        if (reponseNames && reponseNames.length > 0) {\n            for (var i = 0; i < reponseNames.length; i++) {\n                var name = reponseNames[i];\n                response = response[name];\n                if (response === undefined) {\n                    break;\n                }\n            }\n        }\n        if (response === undefined) {\n            response = defaultResponse;\n        }\n        callback(null, response);\n    });\n};\n\nTopClient.prototype._wrapJSON = function (s) {\n    var matchs = s.match(/\\\"id\\\"\\:\\s?\\d{16,}/g);\n    if (matchs) {\n        for (var i = 0; i < matchs.length; i++) {\n            var m = matchs[i];\n            s = s.replace(m, '\"id\":\"' + m.split(':')[1].trim() + '\"');\n        }\n    }\n    return s;\n};\n\nvar IGNORE_ERROR_CODES = {\n    'isv.user-not-exist:invalid-nick': 1\n};\n\n/**\n * Request API.\n *\n * @param {Object} params\n * @param {String} [type='GET']\n * @param {Function(err, result)} callback\n * @public\n */\nTopClient.prototype.request = function (params, type, callback) {\n    if (typeof type === 'function') {\n        callback = type;\n        type = null;\n    }\n    var err = util.checkRequired(params, 'method');\n    if (err) {\n        return callback(err);\n    }\n    var args = {\n        timestamp: this.timestamp(),\n        format: 'json',\n        app_key: this.appkey,\n        v: '2.0',\n        sign_method: 'md5'\n    };\n    for (var k in params) {\n        if(typeof params[k] == \"object\"){\n            args[k] = JSON.stringify(params[k]);\n        }else{\n            args[k] = params[k];\n        }\n    }\n    args.sign = this.sign(args);\n    type = type || 'GET';\n    var options = {type: type, data: args, agent: this.agent};\n    var that = this;\n    urllib.request(that.REST_URL, options, function (err, buffer) {\n        var data;\n        if (buffer) {\n            buffer = that._wrapJSON(buffer.toString());\n            try {\n                data = JSON.parse(buffer);\n            } catch (e) {\n                err = e;\n                e.data = buffer.toString();\n                data = null;\n            }\n        }\n        var errRes = data && data.error_response;\n        if (errRes) {\n            if (!errRes.sub_msg || !IGNORE_ERROR_CODES[errRes.sub_code]) {\n                // no sub_msg error, let caller handle it.\n                var msg = errRes.msg + ', code ' + errRes.code;\n                if (errRes.sub_msg) {\n                    msg += '; ' + errRes.sub_code + ': ' + errRes.sub_msg;\n                }\n                err = new Error(msg);\n                err.name = 'TOPClientError';\n                err.code = errRes.code;\n                err.sub_code = errRes.sub_code;\n                err.data = buffer.toString();\n                data = null;\n            }\n        }\n\n        callback(err, data);\n    });\n};\n\n/**\n * Get now timestamp with 'yyyy-MM-dd HH:mm:ss' format.\n * @return {String}\n */\nTopClient.prototype.timestamp = function () {\n    return util.YYYYMMDDHHmmss();\n};\n\n/**\n * Sign API request.\n * see http://open.taobao.com/doc/detail.htm?id=111#s6\n *\n * @param  {Object} params\n * @return {String} sign string\n */\nTopClient.prototype.sign = function (params) {\n    var sorted = Object.keys(params).sort();\n    var basestring = this.appsecret;\n    for (var i = 0, l = sorted.length; i < l; i++) {\n        var k = sorted[i];\n        basestring += k + params[k];\n    }\n    basestring += this.appsecret;\n    return util.md5(basestring).toUpperCase();\n};\n\n/**\n * execute top api\n */\nTopClient.prototype.execute = function (apiname,params, callback) {\n    this.invoke(apiname, params, [util.getApiResponseName(apiname)], null, 'POST', callback);\n};\n\nexports.TopClient = TopClient;\n"
    ]
}