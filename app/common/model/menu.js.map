{
    "version": 3,
    "sources": [
        "../../../src/common/model/menu.js"
    ],
    "names": [
        "adminmenu",
        "think",
        "cache",
        "getallmenu",
        "timeout",
        "menu",
        "uid",
        "is_admin",
        "where",
        "hide",
        "model",
        "getset",
        "setup",
        "DEVELOP_MODE",
        "is_dev",
        "groups",
        "MENU_GROUP",
        "arr",
        "v",
        "group",
        "order",
        "select",
        "isEmpty",
        "nmenu",
        "m",
        "Auth",
        "adapter",
        "auth",
        "check",
        "url",
        "res",
        "push",
        "arr_to_tree",
        "topmenu",
        "pid",
        "id",
        "field",
        "base"
    ],
    "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;qBAKUA,S;;;;;;;;;;mCACeC,MAAMC,KAAN,CAAY,UAAZ,EAAwB,YAAM;AAC3C,uCAAO,OAAKC,UAAL,EAAP;AACH,6BAFgB,EAEd,EAACC,SAAS,MAAM,EAAN,GAAW,IAArB,EAFc,C;;;AAAbC,gC;6DAIGA,I;;;;;;;;;;;;;;;;AAEX;;;qBACMF,U;iGAAWG,G,EAAIC,Q;;;;;;;AACbC,iC,GAAQ,E;;AACZA,kCAAMC,IAAN,GAAa,CAAb;;mCACkB,KAAKC,KAAL,CAAW,OAAX,EAAoBC,MAApB,E;;;AAAdC,iC;;AACJ,gCAAG,CAACA,MAAMC,YAAV,EAAuB;AAAC;AACpBL,sCAAMM,MAAN,GAAoB,CAApB;AACH;AACGC,kC,GAASH,MAAMI,U;AACnB;AACA;;AACIC,+B,GAAM,E;wCACO,oBAAYF,MAAZ,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAALG,6B;;AACJ;;AAEAV,kCAAMW,KAAN,GAAYD,CAAZ;AACIb,gC,GAAK,E;;kCACLG,MAAMW,KAAN,IAAe,C;;;;;;mCACP,KAAKX,KAAL,CAAWA,KAAX,EAAkBY,KAAlB,CAAwB,UAAxB,EAAoCC,MAApC,E;;;AAAZhB,gC;;;gCAEIJ,MAAMqB,OAAN,CAAcjB,IAAd,C;;;;;AACA;AACIkB,iC,GAAM,E;AACV;;gCACKhB,Q;;;;;yCACQF,I;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAALmB,6B;AACAC,gC,GAAOxB,MAAMyB,OAAN,CAAc,MAAd,EAAsB,MAAtB,C;AACPC,gC,GAAO,IAAIF,IAAJ,CAASnB,GAAT,C;;mCACKqB,KAAKC,KAAL,CAAWJ,EAAEK,GAAb,C;;;AAAZC,+B;;AACJ;AACA,gCAAGA,GAAH,EAAO;AACHP,sCAAMQ,IAAN,CAAWP,CAAX;AACH;;;;;;;;;;;AAEDD,oCAAMlB,IAAN;;;AAEJY,gCAAIC,CAAJ,IAAOc,YAAYT,KAAZ,EAAkB,CAAlB,CAAP;;;;;;;8DAQLN,G;;;;;;;;;;;;;;;;AAEX;;;qBACKgB,O;;;;;;;AACEzB,iC,GAAQ,E;;AACZA,kCAAMC,IAAN,GAAa,CAAb;AACAD,kCAAM0B,GAAN,GAAY,CAAZ;;mCACkB,KAAKxB,KAAL,CAAW,OAAX,EAAoBC,MAApB,E;;;AAAdC,iC;;AACJ,gCAAG,CAACA,MAAMC,YAAV,EAAuB;AAAC;AACpBL,sCAAMM,MAAN,GAAoB,CAApB;AACH;;mCACe,KAAKN,KAAL,CAAWA,KAAX,EAAkBY,KAAlB,CAAwB,UAAxB,EAAoCC,MAApC,E;;;AAAZhB,gC;8DAEGA,I;;;;;;;;;;;;;;;;;AAGV;;;qBACMc,K;iGAAMgB,E;;;;;;AACJ3B,iC,GAAQ,E;;AACZA,kCAAMC,IAAN,GAAa,CAAb;AACAD,kCAAM0B,GAAN,GAAYC,EAAZ;;mCACkB,KAAKzB,KAAL,CAAW,OAAX,EAAoBC,MAApB,E;;;AAAdC,iC;;AACJ,gCAAG,CAACA,MAAMC,YAAV,EAAuB;AAAC;AACpBL,sCAAMM,MAAN,GAAoB,CAApB;AACH;;mCACiB,KAAKN,KAAL,CAAWA,KAAX,EAAkB4B,KAAlB,CAAwB,OAAxB,EAAiChB,KAAjC,CAAuC,UAAvC,EAAmDC,MAAnD,E;;;AAAdN,kC;8DAEGA,M;;;;;;;;;;;;;;;;;;EAhFcd,MAAMS,KAAN,CAAY2B,I",
    "file": "../../../src/common/model/menu.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n\n/**\n * model\n */\nexport default class extends think.model.base {\n\n    async adminmenu(){\n        let menu = await think.cache(\"adminenu\", () => {\n            return this.getallmenu();\n        }, {timeout: 365 * 24 * 3600});\n\n        return menu;\n    }\n    //获取后台全部菜单\n    async getallmenu(uid,is_admin){\n        let where = {}\n        where.hide = 0;\n        let setup = await this.model(\"setup\").getset();\n        if(!setup.DEVELOP_MODE){// 是否开发者模式\n            where.is_dev    =   0;\n        }\n        let groups = setup.MENU_GROUP;\n        //think.log(group)\n        //let pid = await this.topmenu();\n        var arr = {};\n            for(var v of Object.keys(groups)){\n                //let obj = {}\n\n                where.group=v;\n                let menu=[];\n                if( where.group != 0){\n                menu =await this.where(where).order('sort asc').select();\n                }\n                if(!think.isEmpty(menu)){\n                    //arr.push(obj[v.id]=menu)\n                    let nmenu=[];\n                    //验证权限，根据权限进行显示控制\n                    if (!is_admin) {\n                    for(let m of menu){\n                        let Auth = think.adapter(\"auth\", \"rbac\");\n                        let auth = new Auth(uid);\n                        let res = await auth.check(m.url);\n                        //console.log(res);\n                        if(res){\n                            nmenu.push(m);\n                        }\n                    }}else {\n                        nmenu=menu;\n                    }\n                    arr[v]=arr_to_tree(nmenu,0);\n                }\n\n\n            }\n\n       //let menu = get_children(menu,0)\n        //console.log(menu);\n        return arr;\n    }\n    //获取顶级菜单\n   async topmenu(){\n       let where = {}\n       where.hide = 0;\n       where.pid = 0;\n       let setup = await this.model(\"setup\").getset();\n       if(!setup.DEVELOP_MODE){// 是否开发者模式\n           where.is_dev    =   0;\n       }\n       let menu =await this.where(where).order('sort asc').select();\n       //console.log(menu);\n       return menu;\n   }\n\n    //获取顶级菜单分组\n    async group(id){\n        let where = {}\n        where.hide = 0;\n        where.pid = id;\n        let setup = await this.model(\"setup\").getset();\n        if(!setup.DEVELOP_MODE){// 是否开发者模式\n            where.is_dev    =   0;\n        }\n        let groups =await this.where(where).field(\"group\").order('sort asc').select();\n        //console.log(menu);\n        return groups;\n    }\n}"
    ]
}