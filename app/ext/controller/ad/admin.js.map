{
    "version": 3,
    "sources": [
        "../../../../src/ext/controller/ad/admin.js"
    ],
    "names": [
        "indexAction",
        "model",
        "page",
        "get",
        "order",
        "countSelect",
        "data",
        "Pages",
        "think",
        "adapter",
        "pages",
        "http",
        "assign",
        "display",
        "addspaceAction",
        "isPost",
        "post",
        "add",
        "res",
        "success",
        "name",
        "fail",
        "field",
        "select",
        "temp",
        "meta_title",
        "editspaceAction",
        "where",
        "spaceid",
        "update",
        "find",
        "space",
        "codeAction",
        "showadAction",
        "ad",
        "delspaceAction",
        "ids",
        "param",
        "isEmpty",
        "delete",
        "adcacheAction",
        "v",
        "upad",
        "gettempAction",
        "fieldReverse",
        "json",
        "adlistAction",
        "map",
        "addadAction",
        "addtime",
        "Date",
        "getTime",
        "startdate",
        "valueOf",
        "enddate",
        "code",
        "arr",
        "obj",
        "push",
        "setting",
        "url",
        "type",
        "editadAction",
        "id",
        "deladAction",
        "tempAction",
        "addtempAction",
        "type_images",
        "type_flash",
        "type_text",
        "type_code",
        "split",
        "edittempAction",
        "tempid"
    ],
    "mappings": "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",
    "file": "../../../../src/ext/controller/ad/admin.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n\n'use strict';\n/**\n * 插件后台控制器\n * 如果插件有后台管理业务写在这个控制器里面\n */\nimport Base from '../admin.js';\nexport default class extends Base {\n  /**\n   * index action\n   * 插件管理入口\n   * 广告管理列表\n   * @return {Promise} []\n   */\n  async indexAction(){\n    //获取广告位置列表\n      let data = await this.model(\"ext_ad_space\").page(this.get('page')).order(\"spaceid DESC\").countSelect();\n    //console.log(data);\n    let Pages = think.adapter(\"pages\", \"page\"); //加载名为 dot 的 Template Adapter\n    let pages = new Pages(this.http); //实例化 Adapter\n    let page = pages.pages(data);\n    this.assign('pagerData', page); //分页展示使用\n    this.assign('list', data.data);\n    return this.display();\n  }\n\n    /**\n     * 添加广告位\n     */\n    async addspaceAction(){\n        if(this.isPost()){\n            let data = this.post();\n            let res = await this.model('ext_ad_space').add(data);\n            if(res){\n                return this.success({name:\"添加成功!\"})\n            }else {\n                return this.fail(\"添加失败!\")\n            }\n        }else {\n            let temp = await this.model('ext_ad_temp').field(\"tempid,title,name\").select();\n            //console.log(temp);\n            this.assign(\"temp\",temp);\n            this.meta_title=\"添加广告位\"\n            return this.display();\n        }\n\n    }\n\n    /**\n     * 编辑广告位\n     * @returns {Promise.<void>}\n     */\n    async editspaceAction(){\n        if(this.isPost()){\n            let data = this.post();\n            let res = await this.model('ext_ad_space').where({spaceid:data.spaceid}).update(data);\n            if(res){\n                return this.success({name:\"更新成功!\"})\n            }else {\n                return this.fail(\"更新失败!\")\n            }\n        }else {\n            let spaceid = this.get(\"spaceid\");\n            let temp = await this.model('ext_ad_temp').select();\n            //console.log(temp);\n            this.assign(\"temp\",temp);\n            let space = await this.model('ext_ad_space').find({where:{spaceid:spaceid}});\n            this.assign(\"space\",space);\n            this.meta_title=\"添加广告位\"\n            return this.display();\n        }\n    }\n    /**\n     * 调用代码\n     * @returns {Promise.<void>}\n     */\n    async codeAction(){\n        let spaceid = this.get(\"spaceid\");\n        let space = await this.model(\"ext_ad_space\").find({where:{spaceid:spaceid}});\n        this.assign(\"space\",space);\n        return this.display();\n    }\n\n    /**\n     * 预览广告\n     * @returns {Promise.<void>}\n     */\n    async showadAction(){\n        let spaceid = this.get(\"spaceid\");\n        let ad = await this.model(\"ext_ad_space\").find({where:{spaceid:spaceid}});\n        this.assign(\"ad\",ad);\n        return this.display();\n    }\n    /**\n     * 删除广告\n     * @returns {Promise.<void>}\n     */\n    async delspaceAction(){\n        let ids = this.param('ids');\n        //return this.fail(ids);\n        if(think.isEmpty(ids)){\n            return this.fail(\"缺少参数!\")\n        }\n        //删除广告位\n        let res = await this.model('ext_ad_space').where({spaceid:['IN',ids]}).delete();\n        await this.model(\"ext_ad\").where({spaceid:['IN',ids]}).delete();\n        if(res){\n            //todo 广告缓存后续\n            return this.success({name:\"删除成功!\"});\n        }else {\n            return this.fail(\"删除成功!\");\n        }\n\n    }\n    /**\n     * 更新广告缓存\n     * @returns {Promise.<void>}\n     */\n   async adcacheAction(){\n        //获取所有广告位\n       let space = await this.model(\"ext_ad_space\").order(\"spaceid DESC\").select();\n       for(let v of space){\n           await this.model(\"ext_ad_space\").upad(v.spaceid);\n       }\n        return this.success({name:\"更新广告缓存成功!\"})\n    }\n    /**\n     * 获取广告模板\n     * @returns {Promise.<void>}\n     */\n   async gettempAction(){\n        let name = this.get('name');\n        let res = await this.model('ext_ad_temp').fieldReverse(\"temp\").where({name:name}).find();\n        return this.json(res);\n   }\n\n    /**\n     * 广告列表\n     * @returns {Promise.<void>}\n     */\n   async adlistAction(){\n       let spaceid = this.get('spaceid');\n       let space = await this.model('ext_ad_space').find({where:{spaceid:spaceid}});\n       this.assign('space',space);\n       let map = {};\n       map.spaceid = spaceid;\n       //map.status = 1;\n       //获取广告位置列表\n       let data = await this.model(\"ext_ad\").page(this.get('page')).where(map).order(\"sort ASC,addtime DESC\").countSelect();\n       //console.log(data);\n       let Pages = think.adapter(\"pages\", \"page\"); //加载名为 dot 的 Template Adapter\n       let pages = new Pages(this.http); //实例化 Adapter\n       let page = pages.pages(data);\n       this.assign('pagerData', page); //分页展示使用\n       this.assign('list', data.data);\n       return this.display();\n   }\n\n    /**\n     * 添加广告\n     * @returns {Promise.<void>}\n     */\n   async addadAction(){\n        if(this.isPost()){\n           let data = this.post();\n           data.addtime = new Date().getTime();\n           data.startdate= think.isEmpty(data.startdate)?new Date().getTime():new Date(data.startdate).valueOf();\n           data.enddate = think.isEmpty(data.enddate)?new Date(data.startdate).getTime()+(86400000*30):new Date(data.enddate).valueOf();\n           if(!think.isEmpty(data.code)){\n               let arr = [];\n               let obj = {};\n               obj.code = data.code;\n               arr.push(obj)\n               data.setting=JSON.stringify(arr);\n           }\n            // console.log(data);\n           // return this.fail(1);\n            let res = await this.model(\"ext_ad\").add(data);\n            // let res =1;\n            if(res){\n                //更新广告位\n                await this.model('ext_ad_space').upad(data.spaceid);\n                // return this.fail(1)\n                return this.success({name:\"添加成功!\",url:\"/ext/ad/admin/adlist/spaceid/\"+data.spaceid})\n            }else {\n                return this.success(\"添加失败!\")\n            }\n\n       }else {\n            //获取广告位\n            let spaceid = this.get('spaceid');\n            let space = await this.model('ext_ad_space').find({where:{spaceid:spaceid}});\n            //获取广告模板\n            let temp = await this.model('ext_ad_temp').find({where:{name:space.type}});\n           this.assign('space',space);\n           this.assign('temp',temp);\n           this.meta_title=\"添加广告\"\n           return this.display();\n       }\n\n   }\n    /**\n     * 编辑广告\n     * @returns {Promise.<void>}\n     */\n    async editadAction(){\n        if(this.isPost()){\n            let data = this.post();\n            data.startdate= think.isEmpty(data.startdate)?new Date().getTime():new Date(data.startdate).valueOf();\n            data.enddate = think.isEmpty(data.enddate)?new Date(data.startdate).getTime()+(86400000*30):new Date(data.enddate).valueOf();\n\n            // console.log(data);\n            // return this.fail(1);\n            let res = await this.model(\"ext_ad\").where({id:data.id}).update(data);\n            // let res =1;\n            if(res){\n                //更新广告位\n                await this.model('ext_ad_space').upad(data.spaceid);\n                // return this.fail(1)\n                return this.success({name:\"编辑成功!\",url:\"/ext/ad/admin/adlist/spaceid/\"+data.spaceid})\n            }else {\n                return this.success(\"编辑失败!\")\n            }\n\n        }else {\n            let id = this.get(\"id\");\n            let ad = await this.model(\"ext_ad\").find(id);\n            this.assign(\"ad\",ad);\n            //获取广告位\n            let spaceid = ad.spaceid;\n            let space = await this.model('ext_ad_space').find({where:{spaceid:spaceid}});\n            //获取广告模板\n            let temp = await this.model('ext_ad_temp').find({where:{name:space.type}});\n            this.assign('space',space);\n            this.assign('temp',temp);\n            this.meta_title=\"编辑广告\"\n            return this.display();\n        }\n\n    }\n    /**\n     * 删除广告\n     * @returns {Promise.<void>}\n     */\n   async deladAction(){\n       let ids = this.param('ids');\n       if(think.isEmpty(ids)){\n           return this.fail(\"缺少参数!\")\n       }\n       let res = await this.model('ext_ad').where({id:['IN',ids]}).delete();\n       if(res){\n           //todo 广告缓存后续\n           return this.success({name:\"删除成功!\"});\n       }else {\n           return this.fail(\"删除成功!\");\n       }\n\n   }\n    /**\n     * 广告模板\n     * @returns {Promise.<void>}\n     */\n    async tempAction(){\n        //获取广告位置列表\n        let data = await this.model(\"ext_ad_temp\").page(this.get('page')).countSelect();\n        //console.log(data);\n        let Pages = think.adapter(\"pages\", \"page\"); //加载名为 dot 的 Template Adapter\n        let pages = new Pages(this.http); //实例化 Adapter\n        let page = pages.pages(data);\n        this.assign('pagerData', page); //分页展示使用\n        this.assign('list', data.data);\n        return this.display();\n    }\n\n    /**\n     * 添加广告模板\n     *\n     */\n    async addtempAction(){\n        if(this.isPost()){\n            let data = this.post();\n            data.type_images= data.type_images||0;\n            data.type_flash= data.type_flash||0;\n            data.type_text= data.type_text||0;\n            data.type_code= data.type_code||0;\n            //console.log(data);\n            let type = {}\n            for(let v in data){\n                if(v.split(\"_\")[0]==\"type\"){\n                    type[v.split(\"_\")[1]]=data[v]\n                }\n            }\n            data.type = JSON.stringify(type);\n            let res = await this.model('ext_ad_temp').add(data);\n            if(res){\n\n                return this.success({name:\"添加成功！\",url:\"/ext/ad/admin/temp\"})\n            }else {\n                return this.fail(\"添加失败!\");\n            }\n\n        }else {\n            this.meta_title=\"添加广告模板\";\n            return this.display();\n        }\n\n    }\n\n    /**\n     * 编辑模板\n     * @returns {Promise.<void>}\n     */\n    async edittempAction(){\n        if(this.isPost()){\n            let data = this.post();\n            data.type_images= data.type_images||0;\n            data.type_flash= data.type_flash||0;\n            data.type_text= data.type_text||0;\n            data.type_code= data.type_code||0;\n            //console.log(data);\n            let type = {}\n            for(let v in data){\n                if(v.split(\"_\")[0]==\"type\"){\n                    type[v.split(\"_\")[1]]=data[v]\n                }\n            }\n            data.type = JSON.stringify(type);\n            let res = await this.model('ext_ad_temp').where({tempid:data.tempid}).update(data);\n            if(res){\n                return this.success({name:\"编辑成功！\",url:\"/ext/ad/admin/temp\"})\n            }else {\n                return this.fail(\"编辑失败!\");\n            }\n\n        }else {\n            let tempid = this.get(\"tempid\");\n            let temp = await this.model(\"ext_ad_temp\").find({where:{tempid:tempid}});\n            this.assign(\"temp\",temp);\n            this.meta_title=\"添加广告模板\";\n            return this.display();\n        }\n    }\n\n\n}"
    ]
}