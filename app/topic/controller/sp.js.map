{
    "version": 3,
    "sources": [
        "../../../src/topic/controller/sp.js"
    ],
    "names": [
        "indexAction",
        "get",
        "category",
        "cate",
        "model",
        "find",
        "where",
        "cid",
        "id",
        "sp",
        "think",
        "extend",
        "roleid",
        "is_login",
        "getField",
        "priv",
        "http",
        "error",
        "Error",
        "statusAction",
        "meta_title",
        "title",
        "keywords",
        "description",
        "get_parent_category",
        "breadcrumb",
        "assign",
        "temp",
        "console",
        "log",
        "checkMobile",
        "userAgent",
        "ismt",
        "template_m_index",
        "action",
        "controller",
        "ROOT_PATH",
        "sp_temp_m",
        "m_url",
        "redirect",
        "display",
        "ispct",
        "template_index",
        "sp_temp_pc",
        "pc_url"
    ],
    "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;;;;;AAGE;;;;mBAIMA,W;;;;;;;AACJ;AACIC,iB,GAAM,KAAKA,GAAL,CAAS,UAAT,KAAwB,C;;qBAEjB,KAAKC,QAAL,CAAcD,GAAd,C;;;AAAbE,kB;;qBACW,KAAKC,KAAL,CAAW,aAAX,EAA0BC,IAA1B,CAA+B,EAACC,OAAM,EAACC,KAAIJ,KAAKK,EAAV,EAAP,EAA/B,C;;;AAAXC,gB;;AACJN,qBAAOO,MAAMC,MAAN,CAAa,EAAb,EAAiBR,IAAjB,EAAsBM,EAAtB,CAAP;AACA;AACA;AACIG,oB,GAAO,C,EAAE;;mBACV,KAAKC,Q;;;;;;qBACS,KAAKT,KAAL,CAAW,QAAX,EAAqBE,KAArB,CAA2B,EAACE,IAAG,KAAKK,QAAT,EAA3B,EAA+CC,QAA/C,CAAwD,SAAxD,EAAmE,IAAnE,C;;;AAAfF,oB;;;;qBAEe,KAAKR,KAAL,CAAW,eAAX,EAA4BW,IAA5B,CAAiCZ,KAAKK,EAAtC,EAAyCI,MAAzC,EAAgD,OAAhD,C;;;AAAbG,kB;;kBACAA,I;;;;;AACF,mBAAKC,IAAL,CAAUC,KAAV,GAAkB,IAAIC,KAAJ,CAAU,kBAAV,CAAlB;+CACOR,MAAMS,YAAN,CAAmB,GAAnB,EAAwB,KAAKH,IAA7B,C;;;;AAGT,mBAAKI,UAAL,GAAkBjB,KAAKiB,UAAL,GAAkBjB,KAAKiB,UAAvB,GAAoCjB,KAAKkB,KAA3D,C,CAAkE;AAClE,mBAAKC,QAAL,GAAgBnB,KAAKmB,QAAL,GAAgBnB,KAAKmB,QAArB,GAAgC,EAAhD,C,CAAoD;AACpD,mBAAKC,WAAL,GAAmBpB,KAAKoB,WAAL,GAAmBpB,KAAKoB,WAAxB,GAAsC,EAAzD,C,CAA6D;AAC7D;AACA;AACA;;qBACuB,KAAKnB,KAAL,CAAW,UAAX,EAAuBoB,mBAAvB,CAA2CrB,KAAKK,EAAhD,EAAmD,IAAnD,C;;;AAAnBiB,wB;;AACJ;AACA,mBAAKC,MAAL,CAAY,YAAZ,EAA0BD,UAA1B;AACA;AACA,mBAAKC,MAAL,CAAY,UAAZ,EAAwBvB,IAAxB;AACIwB,kB;;AACJC,sBAAQC,GAAR,CAAYpB,EAAZ;AACA;;mBACGqB,YAAY,KAAKC,SAAL,EAAZ,C;;;;;4BACO5B,KAAK6B,I;8CACN,C,wBAKA,C,wBAIA,C;;;;AARH;AACAL,qBAAOxB,KAAK8B,gBAAL,GAAwB9B,KAAK8B,gBAA7B,GAAgD,KAAKjB,IAAL,CAAUkB,MAAjE;AACAP,iCAAgB,KAAKX,IAAL,CAAUmB,UAA1B,SAAwCR,IAAxC;;;;AAGA;AACAA,qBAAOjB,MAAM0B,SAAN,GAAgB,WAAhB,GAA4BjC,KAAKkC,SAAxC;;;;AAGA;AACAV,qBAAOxB,KAAKmC,KAAZ;+CACO,KAAKC,QAAL,CAAcZ,IAAd,C;;;+CAIJ,KAAKa,OAAL,CAAab,IAAb,C;;;4BAECxB,KAAKsC,K;8CACN,C,wBAKA,C,wBAIA,C;;;;AARH;AACAd,qBAAOxB,KAAKuC,cAAL,GAAsBvC,KAAKuC,cAA3B,GAA4C,KAAK1B,IAAL,CAAUkB,MAA7D;AACAP,qBAAS,KAAKX,IAAL,CAAUmB,UAAnB,SAAiCR,IAAjC;;;;AAGA;AACAA,qBAAOjB,MAAM0B,SAAN,GAAgB,WAAhB,GAA4BjC,KAAKwC,UAAxC;;;;AAGA;AACAhB,qBAAOxB,KAAKyC,MAAZ;+CACO,KAAKL,QAAL,CAAcZ,IAAd,C;;;+CAKJ,KAAKa,OAAL,CAAab,IAAb,C",
    "file": "../../../src/topic/controller/sp.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction(){\n    //auto render template file index_index.html\n    let get = this.get('category') || 0;\n\n    let cate = await this.category(get);\n    let sp = await this.model('category_sp').find({where:{cid:cate.id}});\n    cate = think.extend({}, cate,sp);\n    //console.log(cate);\n    //访问控制\n    let roleid=8;//游客\n    if(this.is_login){\n      roleid = await this.model(\"member\").where({id:this.is_login}).getField('groupid', true);\n    }\n    let priv = await this.model(\"category_priv\").priv(cate.id,roleid,'visit');\n    if(!priv){\n      this.http.error = new Error('您所在的用户组,禁止访问本栏目！');\n      return think.statusAction(702, this.http);\n    }\n\n    this.meta_title = cate.meta_title ? cate.meta_title : cate.title; //标题\n    this.keywords = cate.keywords ? cate.keywords : ''; //seo关键词\n    this.description = cate.description ? cate.description : \"\"; //seo描述\n    //频道页只显示模板，默认不读取任何内容\n    //内容可以通过模板标签自行定制\n    //获取面包屑信息\n    let breadcrumb = await this.model('category').get_parent_category(cate.id,true);\n    //console.log(breadcrumb);\n    this.assign('breadcrumb', breadcrumb);\n    /* 模板赋值并渲染模板 */\n    this.assign('category', cate);\n    let temp;\n    console.log(sp);\n    //判断浏览客户端\n    if(checkMobile(this.userAgent())){\n      switch (cate.ismt){\n        case 0:\n          //系统模版\n          temp = cate.template_m_index ? cate.template_m_index : this.http.action;\n          temp =`mobile/${this.http.controller}/${temp}`;\n          break;\n        case 1:\n          //用户的自定义模版统一放在view/sp/目录下，可以但文件或者文件夹\n          temp = think.ROOT_PATH+'/view/sp/'+cate.sp_temp_m;\n          break;\n        case 2:\n          //转跳 http://www.xxxx.com\n          temp = cate.m_url;\n          return this.redirect(temp);\n          break;\n\n      }\n      return this.display(temp)\n    }else{\n      switch (cate.ispct){\n        case 0:\n          //系统模版\n          temp = cate.template_index ? cate.template_index : this.http.action;\n          temp =`${this.http.controller}/${temp}`\n          break;\n        case 1:\n          //用户的自定义模版统一放在view/sp/目录下，可以但文件或者文件夹\n          temp = think.ROOT_PATH+'/view/sp/'+cate.sp_temp_pc;\n          break;\n        case 2:\n          //转跳 http://www.xxxx.com\n          temp = cate.pc_url;\n          return this.redirect(temp);\n          break;\n\n      }\n\n      return this.display(temp);\n    }\n  }\n}"
    ]
}