{
    "version": 3,
    "sources": [
        "../../../src/topic/controller/index.js"
    ],
    "names": [
        "locale",
        "init",
        "http",
        "indexAction",
        "meta_title",
        "keywords",
        "setup",
        "WEB_SITE_KEYWORD",
        "description",
        "WEB_SITE_DESCRIPTION",
        "active",
        "is_login",
        "assign",
        "QINIU_DOMAIN_NAME",
        "checkMobile",
        "userAgent",
        "method",
        "toLowerCase",
        "setCorsHeader",
        "end",
        "map",
        "o",
        "order",
        "get",
        "Number",
        "update_time",
        "view",
        "console",
        "log",
        "model",
        "where",
        "page",
        "param",
        "countSelect",
        "data",
        "isAjax",
        "v",
        "think",
        "isEmpty",
        "pics",
        "arr",
        "split",
        "i",
        "get_pic",
        "push",
        "cover_id",
        "get_realname",
        "uid",
        "url",
        "get_url",
        "name",
        "id",
        "fromNow",
        "json",
        "controller",
        "action",
        "display",
        "routeAction",
        "category",
        "cate",
        "mold",
        "type",
        "allow_publish"
    ],
    "mappings": "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",
    "file": "../../../src/topic/controller/index.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\nimport moment from \"moment\"\nmoment.locale('zh-cn');\nimport Base from './base.js';\nexport default class extends Base {\n    init(http) {\n            super.init(http);\n        }\n        /**\n         * index action\n         * @return {Promise} []\n         */\n    async indexAction() {\n            //auto render template file index_index.html\n            \n\n\n            this.meta_title = \"首页\"; //标题1\n            this.keywords = this.setup.WEB_SITE_KEYWORD ? this.setup.WEB_SITE_KEYWORD : ''; //seo关键词\n            this.description = this.setup.WEB_SITE_DESCRIPTION ? this.setup.WEB_SITE_DESCRIPTION : \"\"; //seo描述\n\n            this.active = ['/', '/index', '/index.html'];\n            if (this.is_login) {\n                this.assign('userid', this.is_login);\n            } else {\n                this.assign('userid', 1);\n            }\n            //debugger;\n            //判断浏览客户端\n            this.assign(\"qiniu_dm\", `https://${this.setup.QINIU_DOMAIN_NAME}`);\n            if (checkMobile(this.userAgent())) {\n                //跨域\n                let method = this.http.method.toLowerCase();\n                if (method === \"options\") {\n                    this.setCorsHeader();\n                    this.end();\n                    return;\n                }\n                this.setCorsHeader();\n                let map = {\n                    'pid': 0,\n                    'status': 1,\n                };\n                //排序\n                let o = {};\n                let order = this.get('order') || 100;\n                //console.log(order);\n                order = Number(order);\n                switch (order) {\n                    case 1:\n                        o.update_time = 'ASC';\n                        break;\n                    case 2:\n                        o.view = 'DESC';\n                        break;\n                    case 3:\n                        o.view = 'ASC';\n                        break;\n                    default:\n                        o.update_time = 'DESC';\n                }\n\n\n                this.assign('order', order);\nconsole.log(\"map-------\" + JSON.stringify(map));\n                let data = await this.model('document').where(map).page(this.param('page'), 10).order(o).countSelect();\n                this.assign(\"list\", data);\n                //console.log(\"sy list\" + JSON.stringify(data) );\n                if (this.isAjax(\"get\")) {\n                    for (let v of data.data) {\n                        if (!think.isEmpty(v.pics)) {\n                            let arr = []\n                            for (let i of v.pics.split(\",\")) {\n                                arr.push(await get_pic(i, 1, 300, 169))\n                            }\n                            v.pics = arr;\n                        }\n                        if (!think.isEmpty(v.cover_id)) {\n                            v.cover_id = await get_pic(v.cover_id, 1, 300, 169);\n                        }\n                        // if (!think.isEmpty(v.price)) {\n                        //     if (!think.isEmpty(get_price_format(v.price, 2))) {\n                        //         v.price2 = get_price_format(v.price, 2);\n                        //     }\n                        //     v.price = get_price_format(v.price, 1);\n\n                        // }\n                        v.uid = await get_realname(v.uid);\n                        v.url = get_url(v.name, v.id);\n                        v.update_time = moment(v.update_time).fromNow();\n                        //console.log(\"v list\" + JSON.stringify(v) );\n                    }\n                    return this.json(data);\n                }\n                console.log(\"index-index------\"+`mobile/${this.http.controller}/${this.http.action}`);\n                return this.display(`mobile/${this.http.controller}/${this.http.action}`)\n            } else {\n                //debugger;\n                //console.log(think.datetime(new Date(), \"YYYY-MM-DD\"));\n                \n                return this.display();\n            }\n\n        }\n        /**\n         * 解析路由，判断是频道页面还是列表页面\n         */\n    async routeAction() {\n        console.log('routeAction--------222');\n        if('/.well-known/pki-validation/fileauth.txt'==this.http.url){\n            console.log('routeAction--------well-known---'+this.http.url);\n            await this.action(\"topic/weike\", \"pkivalidation\");\n        }\n        console.log(\"rout url----------,\" + this.http.url + \",\" + this.get('category').split(\"-\")[0]);\n        let cate = await this.category(this.get('category').split(\"-\")[0]);\n        console.log(\"route cate_model-------\" + cate.mold);\n        let type = cate.allow_publish;\n        if (cate.mold == 2) {\n            type = 'sp';\n        }\n        console.log(\"type-------,cate.mold-----\" + type + \",\" + cate.mold);\n        switch (type) {\n            case 0:\n                if (cate.mold == 1) {\n                    await this.action(\"mod/index\", \"index\");\n                } else {\n                    await this.action(\"cover\", \"index\");\n                }\n                break;\n            case 1:\n            case 2:\n                if (cate.mold == 1) {\n                    // await this.action('question/list', 'index', 'mod')\n                    await this.action(\"mod/index\", \"list\");\n                } else {\n                    await this.action(\"list\", \"index\");\n                }\n                break;\n            case 'sp':\n                await this.action(\"sp\", \"index\");\n                break;\n            default:\n                this.end(111)\n        }\n        //this.end(cate.allow_publish)\n        // 获取当前栏目的模型\n        //let models = await this.model(\"category\",{},'admin').get_category(cate.id, 'model');\n    }\n}\n"
    ]
}