{
    "version": 3,
    "sources": [
        "../../../src/topic/controller/list.js"
    ],
    "names": [
        "locale",
        "indexAction",
        "console",
        "log",
        "GetDateStr",
        "Date",
        "getTime",
        "http",
        "url",
        "method",
        "toLowerCase",
        "setCorsHeader",
        "end",
        "get",
        "id",
        "query",
        "split",
        "category",
        "cate",
        "think",
        "extend",
        "roleid",
        "is_login",
        "assign",
        "model",
        "where",
        "getField",
        "priv",
        "error",
        "Error",
        "statusAction",
        "get_category",
        "models",
        "modellist",
        "isEmpty",
        "val",
        "modelobj",
        "get_model",
        "title",
        "push",
        "get_sub_category",
        "subcate",
        "num",
        "list_row",
        "length",
        "pagenum",
        "config",
        "checkMobile",
        "userAgent",
        "map",
        "uid",
        "o",
        "level",
        "order",
        "Number",
        "update_time",
        "view",
        "create_time",
        "deadline",
        "sortid",
        "sort_id",
        "sortarr",
        "nsobj",
        "sort",
        "JSON",
        "parse",
        "defaultshow",
        "select",
        "typevar",
        "optionid",
        "find",
        "option",
        "type",
        "rules",
        "parse_type_attr",
        "choices",
        "parse_config_attr",
        "v",
        "searchtxt",
        "searcharr",
        "arr",
        "len",
        "i",
        "obj",
        "name",
        "pid",
        "optionidarr",
        "valuearr",
        "qarr",
        "vv",
        "fid",
        "group_id",
        "data",
        "join",
        "table",
        "as",
        "on",
        "page",
        "param",
        "countSelect",
        "html",
        "desc",
        "pageNum",
        "class",
        "text",
        "next",
        "prev",
        "total",
        "meta_title",
        "keywords",
        "description",
        "get_parent_category",
        "breadcrumb",
        "count",
        "temp",
        "template_lists",
        "isAjax",
        "pics",
        "get_pic",
        "cover_id",
        "get_realname",
        "get_url",
        "fromNow",
        "json",
        "template_m_lists",
        "action",
        "display",
        "controller",
        "keywordsAction",
        "keyname",
        "questionAction",
        "popular_value",
        "is_recommend",
        "answer_count"
    ],
    "mappings": "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",
    "file": "../../../src/topic/controller/list.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\nimport moment from \"moment\"\nmoment.locale('zh-cn');\nimport Base from './base.js';\nimport pagination from 'think-pagination';\nexport default class extends Base {\n  //列表页[核心]\n  async indexAction() {\n      console.log(GetDateStr(5)+\" \"+\"00:00:00\");\n      console.log(new Date(GetDateStr(0)+\" \"+\"23:59:59\").getTime());\n      console.log(\"this.http.url------------\"+this.http.url);\n      //跨域\n    let method = this.http.method.toLowerCase();\n    if(method === \"options\"){\n      this.setCorsHeader();\n      this.end();\n      return;\n    }\n    this.setCorsHeader();\n    let get = this.get('category') || 0;\n    let id=0;\n    let query = get.split(\"-\");\n    if(get != 0){\n      id = query[0];\n    }\n\n    let cate = await this.category(id);\n    cate = think.extend({}, cate);\n    let roleid=8;//游客\n    //访问控制\n    if(this.is_login){\n      this.assign('userid', this.is_login);\n      roleid = await this.model(\"member\").where({id:this.is_login}).getField('groupid', true);\n    }else{\n      this.assign('userid', 0);\n    }\n    let priv = await this.model(\"category_priv\").priv(cate.id,roleid,'visit');\n    if(!priv){\n      this.http.error = new Error('您所在的用户组,禁止访问本栏目！');\n      return think.statusAction(702, this.http);\n    }\n    // 获取当前栏目的模型\n    let models = await this.model(\"category\").get_category(cate.id, 'model');\n    //获取模型信息\n    let modellist = [];\n    //console.log(111111111)\n    if (think.isEmpty(models)) {\n      modellist = null;\n    } else {\n      for (let val of models.split(\",\")) {\n        let modelobj = {}\n        modelobj.id = val;\n        modelobj.title = await this.model(\"model\").get_model(val, \"title\");\n        modellist.push(modelobj);\n      }\n    }\n    this.assign('modellist', modellist);\n    this.assign('model', models.split(\",\"));\n    //console.log(cate);\n    //获取当前分类的所有子栏目\n    let subcate = await this.model('category').get_sub_category(cate.id);\n    // console.log(subcate);\n    subcate.push(cate.id);\n    //获取模型列表数据个数\n    // console.log(\"cate-------\"+JSON.stringify(cate));\n    let num;\n    if(cate.list_row>0){\n\n      num = cate.list_row;\n    } else if(cate.model.split(\",\").length == 1){\n      let pagenum=await this.model('model').get_model(cate.model,\"list_row\");\n      if(pagenum !=0){\n        num = pagenum;\n      }\n    }else {\n      num =this.config(\"db.nums_per_page\");\n    }\n    if(checkMobile(this.userAgent())){\n      num=10;\n    }\n    // console.log(\"num-------\"+JSON.stringify(num));\n    //console.log(subcate);\n    let map = {\n      'pid':0,\n      'status': 1,\n      'category_id': ['IN', subcate]\n    };\n    if(this.is_login){\n      map.uid=['IN',[1,this.is_login]];\n    }else{\n      map.uid=['IN',1];\n    }\n    //排序\n    let o = {};\n    o.level = 'DESC';\n    let order = query[1]||0;\n    order = Number(order);\n    switch (order){\n      case 1:\n        o.update_time = 'ASC';\n        break;\n      case 2:\n        o.view = 'DESC';\n        break;\n      case 3:\n        o.view = 'ASC';\n        break;\n        case 4:\n          map.create_time = {\">\": new Date(GetDateStr(0)+\" \"+\"00:00:00\").getTime(), \"<\": new Date(GetDateStr(0)+\" \"+\"23:59:59\").getTime()}\n            o.update_time = 'DESC';\n          break;\n        case 5:\n            map.create_time = {\">\": new Date(GetDateStr(1)+\" \"+\"00:00:00\").getTime(), \"<\": new Date(GetDateStr(5)+\" \"+\"23:59:59\").getTime()}\n            o.update_time = 'DESC';\n            break;\n        case 6:\n            map.create_time = {\"<\": new Date().getTime()}\n            map.deadline = {\">\": new Date().getTime()}\n            o.update_time = 'DESC';\n            break;\n        case 7:\n            map.deadline = {\"<\": new Date().getTime()}\n            o.update_time = 'DESC';\n            break;\n      default:\n        o.update_time = 'DESC';\n    }\n    this.assign('order',order);\n    // 获取分类信息\n    let sortid = query[3]||0;\n    if(!think.isEmpty(sortid)){\n      map.sort_id = sortid;\n    }\n    let sortarr = query[4]||null;\n    let nsobj = {};\n    let sort = await this.model(\"category\").get_category(cate.id, 'documentsorts');\n    if (sort) {\n      this.assign(\"sorturl\",get.split(\"-\")[4])\n      sort = JSON.parse(sort);\n      if(sortid==0){\n        sortid=sort.defaultshow;\n      }\n      let typevar = await this.model(\"typevar\").where({sortid:sortid}).order('displayorder ASC').select();\n      for (let val of typevar){\n\n        val.option= await this.model(\"typeoption\").where({optionid:val.optionid}).find();\n        if(val.option.type == 'select' ||val.option.type == 'radio'){\n          if(!think.isEmpty(val.option.rules)){\n            val.option.rules = JSON.parse(val.option.rules);\n            val.rules=parse_type_attr(val.option.rules.choices);\n            val.option.rules.choices = parse_config_attr(val.option.rules.choices);\n            //console.log(val.rules);\n          }\n\n        }else if(val.option.type == 'checkbox'){\n          if(!think.isEmpty(val.option.rules)){\n            val.option.rules = JSON.parse(val.option.rules);\n            val.rules=parse_type_attr(val.option.rules.choices);\n            console.log(val.rules);\n            for(let v of val.rules){\n              v.id = \"l>\"+v.id\n            }\n            val.option.rules.choices = parse_config_attr(val.option.rules.choices);\n            //console.log(val.rules);\n          }\n        }else if(val.option.type == 'range'){\n          if(!think.isEmpty(val.option.rules)){\n            let searchtxt = JSON.parse(val.option.rules).searchtxt;\n            let searcharr = []\n            if(!think.isEmpty(searchtxt)){\n              let arr = searchtxt.split(\",\");\n              let len = arr.length;\n              for (var i=0;i<len;i++)\n              {\n                let obj = {}\n                if (!think.isEmpty(arr[i-1])){\n                  if(i==1){\n                    obj.id = 'd>'+arr[i];\n                    obj.name = '低于'+arr[i];\n                    obj.pid=0\n                    searcharr.push(obj);\n                  }else {\n                    obj.id = arr[i-1]+'>'+arr[i];\n                    obj.name = arr[i-1]+\"-\"+arr[i];\n                    obj.pid=0\n                    searcharr.push(obj)\n                  }\n\n                }\n\n              }\n              searcharr.push({id:'u>'+arr[len-1],name:'高于'+arr[len-1],pid:0})\n            }\n            //console.log(searcharr);\n            val.option.rules = JSON.parse(val.option.rules);\n            val.rules=searcharr;\n            // val.option.rules.choices = parse_config_attr(val.option.rules.choices);\n\n          }\n        }\n      }\n      // console.log(typevar);\n      this.assign(\"typevar\",typevar);\n    }\n    if(!think.isEmpty(sortarr)) {\n      sortarr = sortarr.split(\"|\");\n      nsobj = {}\n      let optionidarr = [];\n      let valuearr = [];\n      for (let v of sortarr) {\n        let qarr = v.split(\"_\");\n        nsobj[qarr[0]] = qarr[1];\n        if(qarr[1] !=0){\n          let vv = qarr[1].split(\">\");\n          //console.log(vv);\n          if(vv[0]==\"d\" && !think.isEmpty(vv[1])){\n            map[\"t.\"+qarr[0]] = [\"<\",vv[1]];\n          }else if(vv[0]==\"u\" && !think.isEmpty(vv[1])){\n            map[\"t.\"+qarr[0]] = [\">\",vv[1]];\n          }else if(vv[0]==\"l\" && !think.isEmpty(vv[1])){\n            map[\"t.\"+qarr[0]] = [\"like\",`%\"${vv[1]}\"%`];\n          }else if(!think.isEmpty(vv[0])&&!think.isEmpty(vv[1])){\n            map[\"t.\"+qarr[0]] = [\"BETWEEN\", Number(vv[0]), Number(vv[1])];\n          }else {\n            map[\"t.\"+qarr[0]] = qarr[1];\n          }\n\n        }\n      }\n      map.fid = cate.id;\n      // where.optionid = [\"IN\",optionidarr];\n      // where['value'] = [\"IN\",valuearr];\n      // let type= await this.model(\"typeoptionvar\").where(where).select();\n      //  console.log(type);\n      // console.log(map);\n\n    }\n    console.log(\"controller--------\"+this.http.url);\n    console.log(\"map--------\"+JSON.stringify(map));\n    //return false;\n    //console.log(sort);\n    this.assign(\"sort\",sort);\n    this.assign(\"nsobj\",nsobj);\n\n    this.assign(\"sortid\",sortid);\n    let group_id = 0;\n    if(!think.isEmpty(query[2]) && query[2] !=0){\n      map.group_id=query[2];\n      group_id = map.group_id;\n    }\n    this.assign(\"group_id\",group_id)\n    //console.log(map);\n    let data;\n    if(!think.isEmpty(sortarr)){\n      data = await this.model('document').join({\n        table: \"type_optionvalue\"+sortid,\n        join: \"left\", // 有 left,right,inner 3 个值\n        as: \"t\",\n        on: [\"id\", \"tid\"]\n\n      }).where(map).page(this.param('page'),num).order(o).countSelect();\n    }else {\n      data = await this.model('document').where(map).page(this.param('page'),num).order(o).countSelect();\n    }\n    // console.log(\"list-data------\"+JSON.stringify(data));\n    // let data = await this.model('document').join({\n    //     typeoptionvar: {\n    //         join: \"left\", // 有 left,right,inner 3 个值\n    //         as: \"c\",\n    //         on: [\"sort_id\", \"sortid\"]\n    //     }\n    // }).where(map).page(this.param('page'),num).order('update_time DESC').countSelect();\n    let html = pagination(data, this.http, {\n      desc: false, //show description\n      pageNum: 2,\n      url: '', //page url, when not set, it will auto generated\n      class: 'nomargin', //pagenation extra class\n      text: {\n        next: '下一页',\n        prev: '上一页',\n        total: 'count: ${count} , pages: ${pages}'\n      }\n    });\n    this.assign('pagination', html);\n\n    //seo\n    this.meta_title = cate.meta_title ? cate.meta_title : cate.title; //标题\n    this.keywords = cate.keywords ? cate.keywords : ''; //seo关键词\n    this.description = cate.description ? cate.description : \"\"; //seo描述\n\n    //获取面包屑信息\n    let breadcrumb = await this.model('category').get_parent_category(cate.id,true);\n    this.assign('breadcrumb', breadcrumb);\n    console.log(\"breadcrumb-------\"+JSON.stringify(breadcrumb) )\n\n\n    /* 模板赋值并渲染模板 */\n    this.assign('category', cate);\n    this.assign('list', data.data);\n    this.assign('count',data.count);\n    console.log(\"category------------\"+JSON.stringify(cate));\n    let temp = cate.template_lists ? `${cate.template_lists}` : \"\";\n    // console.log(cate);\n    //console.log(111)\n    if(checkMobile(this.userAgent())){\n      if(this.isAjax(\"get\")){\n        for(let v of data.data){\n          if(!think.isEmpty(v.pics)){\n            let arr = []\n            for (let i of v.pics.split(\",\")){\n              arr.push(await get_pic(i,1,300,169))\n            }\n            v.pics = arr;\n          }\n          if(!think.isEmpty(v.cover_id)){\n            v.cover_id = await get_pic(v.cover_id,1,300,169);\n          }\n          // if(!think.isEmpty(v.price)){\n          //   if(!think.isEmpty(get_price_format(v.price,2))){\n          //     v.price2 = get_price_format(v.price,2);\n          //   }\n          //   v.price = get_price_format(v.price,1);\n\n          // }\n          v.uid = await get_realname(v.uid);\n          v.url = get_url(v.name,v.id);\n          v.update_time = moment(v.update_time).fromNow()\n        }\n        return this.json(data);\n      }\n      //手机端模版\n      temp = cate.template_m_lists ? `${cate.template_m_lists}` : `${this.http.action}`;\n      console.log(\"mobile list------333323w3-------\"+temp);\n      \n      return this.display(`mobile/${this.http.controller}/${temp}`)\n    }else{\n      //console.log(temp);\n      console.log(\"list------333323w3-------\"+temp);\n      return this.display(temp);\n    }\n\n\n\n  }\n  //keywrods列表\n  async keywordsAction(){\n    let keywords = this.get(\"key\");\n    let map = {keyname:[\"like\",`%${keywords}%`]}\n    let data = await this.model('document').where(map).page(this.get('page')).countSelect();\n    let html = pagination(data, this.http, {\n      desc: false, //show description\n      pageNum: 2,\n      url: '', //page url, when not set, it will auto generated\n      class: 'nomargin', //pagenation extra class\n      text: {\n        next: '下一页',\n        prev: '上一页',\n        total: 'count: ${count} , pages: ${pages}'\n      }\n    });\n    this.assign('pagination', html);\n    this.assign(\"list\",data);\n    //seo\n    this.meta_title = keywords; //标题\n    this.keywords = keywords; //seo关键词\n    this.description = keywords; //seo描述\n    return this.display();\n  }\n\n  /**\n   * 独立模型 questionAction\n   */\n  async questionAction(){\n    //跨域\n    let method = this.http.method.toLowerCase();\n    if(method === \"options\"){\n      this.setCorsHeader();\n      this.end();\n      return;\n    }\n    this.setCorsHeader();\n    let get = this.get('category') || 0;\n    let id=0;\n    let query = get.split(\"-\");\n    if(get != 0){id = query[0];}\n    let cate = await this.category(id);\n    cate = think.extend({}, cate);\n    let roleid=8;//游客\n    //访问控制\n    if(this.is_login){\n      roleid = await this.model(\"member\").where({id:this.is_login}).getField('groupid', true);\n    }\n    let priv = await this.model(\"category_priv\").priv(cate.id,roleid,'visit');\n    if(!priv){\n      this.http.error = new Error('您所在的用户组,禁止访问本栏目！');\n      return think.statusAction(702, this.http);\n    }\n    // 获取当前栏目的模型\n    let model = await this.model(\"model\").get_model(cate.model);\n    //console.log(model);\n    this.assign('model', model);\n    //console.log(cate);\n    //获取当前分类的所有子栏目\n    let subcate = await this.model('category').get_sub_category(cate.id);\n    // console.log(subcate);\n    subcate.push(cate.id);\n    //获取模型列表数据个数\n    // console.log(cate);\n    let num;\n    if(cate.list_row>0){\n      num = cate.list_row;\n    } else if(cate.model.split(\",\").length == 1){\n      let pagenum=await this.model('model').get_model(cate.model,\"list_row\");\n      if(pagenum !=0){\n        num = pagenum;\n      }\n    }else {\n      num =this.config(\"db.nums_per_page\");\n    }\n    if(checkMobile(this.userAgent())){\n      num=10;\n    }\n    //seo\n    this.meta_title = cate.meta_title ? cate.meta_title : cate.title; //标题\n    this.keywords = cate.keywords ? cate.keywords : ''; //seo关键词\n    this.description = cate.description ? cate.description : \"\"; //seo描述\n\n    //获取面包屑信息\n    let breadcrumb = await this.model('category').get_parent_category(cate.id,true);\n    this.assign('breadcrumb', breadcrumb);\n    //console.log(breadcrumb)\n    let map = {\n      'category_id': ['IN', subcate]\n    };\n    //排序\n    let o = {};\n    let order = query[1]||0;\n    order = Number(order);\n    switch (order){\n      case 1:\n        o.popular_value = 'DESC';\n        break;\n      case 2:\n        map.is_recommend = 1;\n        break;\n      case 3:\n        map.answer_count = 0;\n        break;\n      default:\n        o.create_time = 'DESC';\n    }\n    this.assign('order',order);\n    //分组\n    let group_id = 0;\n    if(!think.isEmpty(query[2]) && query[2] !=0){\n      map.group_id=query[2];\n      group_id = map.group_id;\n    }\n    console.log(map);\n    this.assign(\"group_id\",group_id);\n    let data = await this.model(model.name).where(map).page(this.param('page'),num).order(o);\n\n    /* 模板赋值并渲染模板 */\n    this.assign('category', cate);\n    this.assign('list', data.data);\n    this.assign('count',data.count);\n    //console.log(cate)\n    let temp = cate.template_lists ? `${cate.template_lists}` : \"\";\n    //console.log(cate);\n    //console.log(111)\n    if(checkMobile(this.userAgent())){\n      if(this.isAjax(\"get\")){\n        return this.json(data);\n      }\n      //手机端模版\n      temp = cate.template_m_lists ? `${cate.template_m_lists}` : `${this.http.action}`;\n      //think.log(temp);\n      return this.display(`mobile/${this.http.controller}/${temp}`)\n    }else{\n      //console.log(temp);\n      return this.display(temp);\n    }\n  }\n\n}"
    ]
}