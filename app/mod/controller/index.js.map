{
    "version": 3,
    "sources": [
        "../../../src/mod/controller/index.js"
    ],
    "names": [
        "init",
        "http",
        "__before",
        "get",
        "split",
        "category",
        "m_cate",
        "model",
        "get_model",
        "mod",
        "meta_title",
        "title",
        "keywords",
        "description",
        "indexAction",
        "action",
        "name",
        "think",
        "log",
        "message",
        "assign",
        "listAction",
        "detailAction",
        "end",
        "display",
        "moderrorAction",
        "config",
        "sep",
        "module",
        "controller",
        "modtemp",
        "moblie",
        "ctr",
        "ROOT_PATH",
        "modget",
        "n",
        "query",
        "c_verify",
        "ac",
        "cid",
        "id",
        "info",
        "roleid",
        "is_login",
        "where",
        "getField",
        "priv",
        "error",
        "Error",
        "statusAction",
        "page_num",
        "num",
        "list_row",
        "length",
        "pagenum",
        "checkMobile",
        "userAgent"
    ],
    "mappings": "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",
    "file": "../../../src/mod/controller/index.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n\n'use strict';\n\nimport Base from '../../topic/controller/base.js';\n\nexport default class extends Base {\n  init(http) {\n    super.init(http);\n  }\n\n    /**\n     * 模型公共参数\n     * @private\n     */\n    async __before() {\n        await super.__before();//继承父类before\n       if(this.get('category').split(\"-\")[0]||this.get(\"cid\")){\n           //获取当前模型栏目id\n           this.m_cate= await this.category(this.get('category').split(\"-\")[0]||this.get(\"cid\"));\n\n           //当前模型信息\n           this.mod = await this.model(\"model\").get_model(this.m_cate.model);\n\n           //seo\n           this.meta_title = this.m_cate.meta_title ? this.m_cate.meta_title : this.m_cate.title; //标题\n           this.keywords = this.m_cate.keywords ? this.m_cate.keywords : ''; //seo关键词\n           this.description = this.m_cate.description ? this.m_cate.description : \"\"; //seo描述\n       }\n\n    }\n  /**\n   * index action\n   * @return {Promise} []\n   * 封面入口\n   */\n async indexAction(){\n    try\n    {\n      // let cxt  = think.require(\"mod/controller/\"+this.mod.name+\"/index\");\n      // let cc =new cxt(this.http)\n      // await this.action(cc,\"index\")\n        await this.action(this.mod.name+'/index',\"index\")\n    }\n    catch (err)\n    {\n      //console.log(err);\n        think.log(err.message,'ERROR');\n      this.assign(\"err\",err);\n      return this.action(\"index\",\"moderror\");\n    }\n  }\n\n  /**\n   * 列表入口\n   * @returns {*}\n   */\n  async listAction(){\n    try\n    {\n      // let cxt  = think.require(\"mod/controller/\"+this.mod.name+\"/index\");\n      // let cc =new cxt(this.http)\n      // await this.action(cc,\"list\");\n        // console.log(2222);\n        await this.action(this.mod.name+'/index',\"list\")\n    }\n    catch (err)\n    {\n        think.log(err.message,'ERROR');\n      //console.log(err);\n      this.assign(\"err\",err);\n     return this.action(\"index\",\"moderror\");\n    }\n    //\n  }\n\n  /**\n   * 详情入口\n   * @returns {*}\n   */\n  detailAction(){\n    this.end(11)\n    return this.display();\n  }\n//创建独立模型时错误提示\n  moderrorAction(){\n\n    return this.display(this.config(\"view.root_path\")+think.sep+this.http.module+think.sep+this.http.controller+\"_\"+this.http.action+this.config(\"view.file_ext\"))\n  }\n  //独立模型display方法封装\n  modtemp(mod,moblie=false){\n      let ctr = (this.http.controller).split(\"/\");\n      if(!moblie){\n          if(ctr[1]){\n              return this.display();\n          }else {\n              return this.display(think.ROOT_PATH+think.sep+\"view\"+think.sep+\"mod\"+think.sep+mod+think.sep+this.http.controller+\"_\"+this.http.action+this.config(\"view.file_ext\"));\n          }\n\n    }else {\n        if(ctr[1]){\n            return this.display(think.ROOT_PATH+think.sep+\"view\"+think.sep+\"mod\"+think.sep+ctr[0]+think.sep+moblie+think.sep+ctr[1]+\"_\"+this.http.action+this.config(\"view.file_ext\"));\n        }else {\n            return this.display(think.ROOT_PATH+think.sep+\"view\"+think.sep+\"mod\"+think.sep+mod+think.sep+moblie+think.sep+this.http.controller+\"_\"+this.http.action+this.config(\"view.file_ext\"));\n        }\n    }\n  }\n  //独立模型get方法封装,只针对index入口action,其他的请用 this.get()方法。\n  modget(n){\n    let get = this.get('category') || 0;\n    let query = get.split(\"-\");\n    return query[n]\n  }\n\n    /**\n     * 前台用户组栏目权限验证方法\n     * await this.c_verify(\"visit\") 访问验证\n     * await this.c_verify(\"add\") 投稿验证\n     * await this.c_verify(\"edit\") 前台编辑控制\n     * @returns {PreventPromise}\n     */\n   async c_verify(ac,cid=this.m_cate.id,info='您所在的用户组,禁止访问本栏目！'){\n        let roleid=8;//游客\n        //访问控制\n        if(this.is_login){\n            roleid = await this.model(\"member\").where({id:this.is_login}).getField('groupid', true);\n        }\n        let priv = await this.model(\"category_priv\").priv(cid,roleid,ac);\n        if(!priv){\n            this.http.error = new Error(info);\n            return think.statusAction(702, this.http);\n        }\n    }\n\n    /**\n     * 当前栏目列表每页行数\n     * @returns {*}\n     */\n     page_num(){\n        let num;\n        if(this.m_cate.list_row>0){\n            num = this.m_cate.list_row;\n        } else if(this.m_cate.model.split(\",\").length == 1){\n            let pagenum=this.mod.list_row;\n            if(pagenum !=0){\n                num = pagenum;\n            }\n        }else {\n            num =this.config(\"db.nums_per_page\");\n        }\n        if(checkMobile(this.userAgent())){\n            num=10;\n        }\n        return num;\n    }\n}"
    ]
}