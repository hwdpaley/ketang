{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/user_safe_save_194649.js"
    ],
    "names": [
        "init",
        "http",
        "db",
        "model",
        "tactive",
        "indexAction",
        "map",
        "think",
        "isEmpty",
        "get",
        "username",
        "where",
        "page",
        "order",
        "countSelect",
        "data",
        "Pages",
        "adapter",
        "pages",
        "assign",
        "meta_title",
        "role",
        "status",
        "select",
        "display",
        "userlistAction",
        "gets",
        "start",
        "parseInt",
        "length",
        "draw",
        "key",
        "join",
        "table",
        "as",
        "on",
        "field",
        "limit",
        "userList",
        "forEach",
        "v",
        "last_login_time",
        "times",
        "last_login_ip",
        "_int2iP",
        "count",
        "json",
        "rechargeAction",
        "isAjax",
        "post",
        "id",
        "increment",
        "balance",
        "res",
        "console",
        "log",
        "getField",
        "amount_log",
        "user",
        "uid",
        "Date",
        "valueOf",
        "get_nickname",
        "admin_id",
        "user_id",
        "type",
        "time",
        "amount",
        "note",
        "add",
        "success",
        "name",
        "fail",
        "adduserAction",
        "isPost",
        "password",
        "repassword",
        "encryptPassword",
        "reg_time",
        "getTime",
        "vip",
        "overduedate",
        "is_admin",
        "role_id",
        "usergroup",
        "sendmessageAction",
        "message",
        "find",
        "openid",
        "cache",
        "action",
        "result",
        "in_array",
        "config",
        "error",
        "Error",
        "statusAction",
        "roleid",
        "edituserAction",
        "delavatar",
        "uploadPath",
        "RESOURCE_PATH",
        "path",
        "isFile",
        "rmdir",
        "thenAdd",
        "addrole",
        "update",
        "showuserAction",
        "userdelAction",
        "param",
        "isadmin",
        "chstaAction",
        "parsleyAction",
        "avatarAction",
        "pic",
        "readFileSync",
        "end"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/user_safe_save_194649.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\nimport fs from 'fs';\nexport default class extends Base {\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    init(http) {\n            super.init(http);\n            this.db = this.model(\"member\");\n            this.tactive = \"user\";\n\n        }\n        /**\n         * 用户首页\n         * @returns {*}\n         */\n\n\n    async indexAction() {\n        let map = { 'status': ['>', -1] }\n        if (!think.isEmpty(this.get(\"username\"))) {\n            map.username = [\"like\", \"%\" + this.get(\"username\") + \"%\"]\n        }\n        \n        let data = await this.db.where(map).page(this.get('page'), 20).order('id DESC').countSelect();\n        let Pages = think.adapter(\"pages\", \"page\"); //加载名为 dot 的 Template Adapter\n        let pages = new Pages(this.http); //实例化 Adapter\n        let page = pages.pages(data);\n        // for(let v of data.data){\n        //     console.log(await this.model(\"member_group\").getgroup({groupid:v.groupid}));\n        // }\n        this.assign('pagerData', page); //分页展示使用\n        this.assign('list', data.data);\n        this.meta_title = \"用户列表\";\n        //获取管理组\n        let role = this.model(\"auth_role\").where({ status: 1 }).select();\n        this.assign(\"role\", role);\n        return this.display();\n    }\n\n    async userlistAction() {\n        //用户列表\n        let gets = this.get()\n        let start = parseInt(gets.start);\n        let length = parseInt(gets.length);\n        let draw = gets.draw;\n        let key = gets['search[value]'];\n        let userList = await this.db.join({\n            table: \"customer\",\n            join: \"left\",\n            as: \"u\",\n            on: ['id', 'user_id']\n        }).field(\"id,username,score,login,last_login_ip,last_login_time,status,u.real_name,u.group_id,u.balance\").limit(start, length).where({ username: [\"like\", \"%\" + key + \"%\"], status: [\">\", -1] }).order(\"id DESC\").countSelect()\n        userList.data.forEach(v => {\n                v.last_login_time = times(v.last_login_time)\n                v.last_login_ip = _int2iP(v.last_login_ip)\n            })\n            //console.log(userList)\n        let data = {\n            \"draw\": draw,\n            \"recordsTotal\": userList.count,\n            \"recordsFiltered\": userList.count,\n            \"data\": userList.data\n        }\n        return this.json(data);\n    }\n\n    /**\n     * 会员充值\n     */\n    async rechargeAction() {\n            if (this.isAjax(\"POST\")) {\n                let data = this.post();\n                let res = await this.model(\"member\").where({ id: data.id }).increment(\"amount\", data.balance);\n                console.log(res);\n                if (res) {\n                    let amount_log = await this.model(\"member\").where({ id: data.id }).getField(\"amount\", true);\n                    console.log(amount_log);\n                    //充值成功后插入日志\n                    let log = {\n                        admin_id: this.user.uid,\n                        user_id: data.id,\n                        type: 2,\n                        time: new Date().valueOf(),\n                        amount: data.balance,\n                        amount_log: amount_log,\n                        note: `管理员（${await get_nickname(this.user.uid)}）为您充值，充值的金额为：${data.balance} 元`\n                    }\n                    await this.model('balance_log').add(log);\n                    return this.success({ name: \"充值成功！\" });\n                } else {\n                    return this.fail(\"充值失败！\");\n                }\n            } else {\n                let id = this.get(\"ids\");\n                let name = get_nickname(id);\n                this.assign(\"name\", name);\n                this.assign(\"id\", id);\n                this.meta_title = \"会员充值\";\n                return this.display();\n            }\n\n        }\n        /**\n         * adduser\n         * 添加用户\n         * @returns {Promise|*}\n         */\n    async adduserAction() {\n        if (this.isPost()) {\n            let data = this.post();\n            if (data.password != data.repassword) {\n                return this.fail(\"两次填入的密码不一致\");\n            }\n            data.password = encryptPassword(data.password);\n            data.reg_time = new Date().getTime();\n            if (data.vip == 1) {\n                data.overduedate = new Date(data.overduedate).getTime();\n            } else {\n                data.overduedate = think.isEmpty(data.overduedate) ? 0 : data.overduedate;\n            }\n            //  console.log(data);\n            // return this.fail(\"ddd\")\n            data.status = 1;\n            let res = await this.db.add(data);\n            if (res) {\n                //添加角色\n                if (data.is_admin == 1) {\n                    await this.model(\"auth_user_role\").add({ user_id: res, role_id: data.role_id });\n                }\n                return this.success({ name: \"添加成功！\" });\n            } else {\n                return this.fail(\"添加失败!\")\n            }\n        } else {\n            //会员组\n            let usergroup = await this.model(\"member_group\").select();\n            this.assign(\"usergroup\", usergroup);\n            //获取管理组\n            let role = this.model(\"auth_role\").where({ status: 1 }).select();\n            this.assign(\"role\", role);\n            this.meta_title = \"添加用户\";\n            return this.display();\n        }\n\n    }\n    async sendmessageAction() {\n            if (this.isPost()) {\n                let data = this.post();\n                let message=data.message; \n                let res=await this.model(\"wx_user\").where({ uid: data.id }).find();\n                console.log(\"res----------\"+JSON.stringify(res));\n                let openid=res.openid;\n                if(think.isEmpty(openid)){\n                    return this.fail(\"用户信息不全！\");\n                }\n                await this.cache('getuserinfo',openid);\n                let result=await this.action(\"uc/wechat\", \"masssendtext\");\n                // let result=await this.action(\"uc/wechat\", \"getuserinfo\");\n                // let controllerInstance = this.controller(\"uc/wechat\");\n                // let result=await controllerInstance.getuserinfoAction(openid);\n                console.log(\"result----------\"+JSON.stringify(result));\n                return this.success({ name: \"消息发送成功！\"+openid });\n                \n            } else \n            {\n                let id = this.get(\"id\");\n                let user = await this.model(\"member\").find(id);\n                //不能修改超级管理员的信息\n                if (!this.is_admin) {\n                    if (in_array(id, this.config(\"user_administrator\"))) {\n                        this.http.error = new Error('您无权操作！');\n                        return think.statusAction(702, this.http);\n                    }\n\n                }\n                this.assign(\"user\", user);\n                console.log(user);\n                //所属管理组\n                if (user.is_admin == 1) {\n                    let roleid = await this.model(\"auth_user_role\").where({ user_id: user.id }).getField(\"role_id\", true);\n                    this.assign(\"roleid\", roleid)\n                }\n                //会员组\n                let usergroup = await this.model(\"member_group\").select();\n                this.assign(\"usergroup\", usergroup);\n                //获取管理组\n                let role = this.model(\"auth_role\").where({ status: 1 }).select();\n                this.assign(\"role\", role);\n                this.meta_title = \"发送消息\";\n                return this.display();\n            }\n        }\n        /**\n         * 编辑头像\n         * @returns {PreventPromise}\n         */\n    async edituserAction() {\n        if (this.isPost()) {\n            let data = this.post();\n            //删除头像\n            if (data.delavatar == 1) {\n                let uploadPath = think.RESOURCE_PATH + '/upload/avatar/' + data.id;\n                let path = think.isFile(uploadPath + \"/avatar.png\");\n                if (path) {\n                    think.rmdir(uploadPath, false)\n                }\n            }\n\n            if (think.isEmpty(data.password) && think.isEmpty(data.repassword)) {\n                delete data.password;\n            } else {\n                if (data.password != data.repassword) {\n                    return this.fail(\"两次填入的密码不一致\");\n                }\n                data.password = encryptPassword(data.password);\n            }\n            if (data.vip == 1) {\n                data.overduedate = new Date(data.overduedate).getTime();\n            } else {\n                data.overduedate = 0;\n            }\n            //添加角色\n            if (data.is_admin == 1) {\n                let addrole = await this.model(\"auth_user_role\").where({ user_id: data.id }).thenAdd({ user_id: data.id, role_id: data.role_id });\n                console.log(addrole);\n                if (addrole.type == \"exist\") {\n                    await this.model(\"auth_user_role\").update({ id: addrole.id, role_id: data.role_id });\n                }\n            }\n            let res = await this.db.update(data);\n\n            if (res) {\n                return this.success({ name: \"编辑成功！\" });\n            } else {\n                return this.fail(\"编辑失败!\")\n            }\n        } else {\n            let id = this.get(\"id\");\n            let user = await this.model(\"member\").find(id);\n            //不能修改超级管理员的信息\n            if (!this.is_admin) {\n                if (in_array(id, this.config(\"user_administrator\"))) {\n                    this.http.error = new Error('您无权操作！');\n                    return think.statusAction(702, this.http);\n                }\n\n            }\n            this.assign(\"user\", user);\n            console.log(user);\n            //所属管理组\n            if (user.is_admin == 1) {\n                let roleid = await this.model(\"auth_user_role\").where({ user_id: user.id }).getField(\"role_id\", true);\n                this.assign(\"roleid\", roleid)\n            }\n            //会员组\n            let usergroup = await this.model(\"member_group\").select();\n            this.assign(\"usergroup\", usergroup);\n            //获取管理组\n            let role = this.model(\"auth_role\").where({ status: 1 }).select();\n            this.assign(\"role\", role);\n            this.meta_title = \"编辑用户\";\n            return this.display();\n        }\n    }\n\n    /**\n     * 显示用户信息\n     * @returns {PreventPromise}\n     */\n    async showuserAction() {\n            let id = this.get(\"id\");\n            let user = await this.model(\"member\").find(id);\n            //非超级管理员只能修改自己的用户信息\n            // if(!this.is_admin){\n            //     if(this.user.uid!=id){\n            //         this.http.error = new Error('您无权操作！');\n            //         return think.statusAction(702, this.http);\n            //     }\n            //\n            // }\n            this.assign(\"user\", user);\n            console.log(user);\n            //所属管理组\n            if (user.is_admin == 1) {\n                let roleid = await this.model(\"auth_user_role\").where({ user_id: user.id }).getField(\"role_id\", true);\n                this.assign(\"roleid\", roleid)\n            }\n            //会员组\n            let usergroup = await this.model(\"member_group\").select();\n            this.assign(\"usergroup\", usergroup);\n            //获取管理组\n            let role = this.model(\"auth_role\").where({ status: 1 }).select();\n            this.assign(\"role\", role);\n            this.meta_title = \"个人信息\";\n            return this.display();\n        }\n        /**\n         * userdel\n         * 用户删除\n         * @returns {Promise|*}\n         */\n    async userdelAction() {\n            let id = this.param(\"ids\");\n            //console.log(id);\n            let res;\n            // 判断是否是管理员，如果是不能删除;\n            if (await this.isadmin(id)) {\n                return this.fail(\"不能删除管理员!\")\n            } else {\n                //res = await this.db.where({id: id}).delete();\n                //逻辑删除\n                res = await this.db.where({ id: [\"IN\", id] }).update({ status: -1 });\n                if (res) {\n                    return this.success({ name: \"删除成功！\" })\n                } else {\n                    return this.fail(\"删除失败！\")\n                }\n            }\n\n\n        }\n        /**\n         * 改变角色状态\n         * @returns {Promise|*}\n         */\n    async chstaAction() {\n        let res = await this.db.update(this.get());\n        if (res) {\n            return this.json(res);\n        }\n    }\n\n    /**\n     * 注册异步验证用户数据\n     * @returns {Promise|*}\n     */\n    async parsleyAction() {\n        //验证\n        let data = this.get();\n        // console.log(data);\n        let res = await this.db.where(data).find();\n        // console.log(res);\n        if (think.isEmpty(res)) {\n            return this.json(1);\n        } else {\n            return this.json(0);\n        }\n    }\n\n    /**\n     * 获取用户头像\n     */\n    async avatarAction() {\n        var uploadPath = think.RESOURCE_PATH + '/upload/avatar/' + this.user.uid;\n        let path = think.isFile(uploadPath + \"/\" + \"/avatar.png\");\n        this.type(\"image/png\");\n        let pic;\n        if (path) {\n            // this.download(uploadPath + \"/\" + \"/avatar.png\");\n            pic = fs.readFileSync(uploadPath + \"/\" + \"/avatar.png\")\n        } else {\n            //this.download(think.RESOURCE_PATH + '/upload/avatar/avatar.jpg')\n            pic = fs.readFileSync(think.RESOURCE_PATH + '/upload/avatar/avatar.jpg')\n        }\n        this.end(pic)\n    }\n\n}\n"
    ]
}