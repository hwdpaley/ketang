{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/keyword.js"
    ],
    "names": [
        "init",
        "http",
        "tactive",
        "indexAction",
        "map",
        "get",
        "keyname",
        "is_parent",
        "model",
        "where",
        "order",
        "page",
        "countSelect",
        "list",
        "data",
        "v",
        "tagid",
        "id",
        "getField",
        "lastuser",
        "Pages",
        "think",
        "adapter",
        "pages",
        "assign",
        "meta_title",
        "display",
        "addAction",
        "isPost",
        "post",
        "pic",
        "pid",
        "add_time",
        "Date",
        "getTime",
        "find",
        "isadd",
        "isEmpty",
        "fail",
        "res",
        "add",
        "success",
        "name",
        "url",
        "active",
        "select",
        "parent",
        "editAction",
        "discuss_count_update",
        "console",
        "log",
        "update",
        "info",
        "delAction",
        "ids",
        "param",
        "delete",
        "key_id",
        "lockAction",
        "lock",
        "up"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/keyword.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n  init(http) {\n    super.init(http);\n    this.tactive = \"article\";\n\n  }\n  /** 话题控制器\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction(){\n    //搜索\n    let map = {};\n    if(this.get(\"keyname\")){\n      map.keyname=[\"like\",\"%\"+this.get(\"keyname\")+\"%\"]\n    }\n     if(this.get(\"type\")=='parent'){\n        map.is_parent=1;\n     }\n      let list = await this.model(\"keyword\").where(map).order('add_time DESC').page(this.get(\"page\"),20).countSelect();\n    for (let v of list.data){\n      v.lastuser = await this.model(\"keyword_data\").where({tagid:v.id}).order(\"add_time DESC\").getField(\"uid\",true);\n    }\n    let Pages = think.adapter(\"pages\", \"page\"); //加载名为 dot 的 Template Adapter\n    let pages = new Pages(this.http); //实例化 Adapter\n    let page = pages.pages(list);\n    this.assign('list', list);\n    this.assign('pagerData', page); //分页展示使用\n    this.meta_title=\"话题管理\";\n    //auto render template file index_index.html\n    return this.display();\n  }\n\n    /**\n     * 添加话题\n     */\n  async addAction(){\n    if(this.isPost()){\n     let data = this.post();\n        data.pic = data.pic||0;\n        data.pid = (data.is_parent==1)?0:data.pid;\n        data.add_time = new Date().getTime();\n        let isadd = await this.model(\"keyword\").where({keyname:data.keyname}).find();\n        //console.log(data);\n        if(!think.isEmpty(isadd)){\n          return this.fail(\"已经存在相同的话题\");\n        }\n        let res = this.model(\"keyword\").add(data);\n        if(res){\n          return this.success({name:\"添加成功！\",url:\"/admin/keyword/index\"})\n        }else {\n          return this.fail(\"添加失败！\")\n        }\n    }else {\n      this.meta_title=\"新增话题\";\n      this.active ='admin/keyword/index';\n      let parent = await this.model(\"keyword\").where({is_parent:1}).select();\n      this.assign(\"parent\",parent);\n     return this.display();\n    }\n  }\n\n    /**\n     * 编辑话题\n     */\n  async editAction(){\n      if(this.isPost()){\n       let data = this.post();\n          data.pic = data.pic||0;\n          data.pid = (data.is_parent==1)?0:data.pid;\n          data.discuss_count_update=new Date().getTime();\n          console.log(data);\n          let res = this.model(\"keyword\").update(data)\n          if(res){\n              return this.success({name:\"修改成功！\",url:\"/admin/keyword/index\"})\n          }else {\n              return this.fail(\"修改失败！\")\n          }\n      }else {\n          let id = this.get(\"id\");\n          this.meta_title=\"编辑话题\";\n          this.active ='admin/keyword/index';\n          let info = await this.model(\"keyword\").find(id);\n          let parent = await this.model(\"keyword\").where({is_parent:1}).select();\n          this.assign(\"parent\",parent);\n          this.assign(\"info\",info);\n          return this.display();\n      }\n\n\n  }\n    /**\n     * 删除话题\n     */\n  async delAction(){\n      let ids = this.param(\"ids\");\n      if(think.isEmpty(ids)){\n          return this.fail(\"参数不能为空!\")\n      }\n      //删除话题\n      await this.model(\"keyword\").where({id:[\"IN\",ids]}).delete();\n      //清除相关数据\n      await this.model(\"keyword_data\").where({tagid:[\"IN\",ids]}).delete();\n      await this.model(\"keyword_focus\").where({key_id:[\"IN\",ids]}).delete();\n      return this.success({name:\"删除成功!\"})\n  }\n  //锁定话题\n  async lockAction(){\n    let ids = this.param(\"ids\");\n    let lock = this.get(\"lock\");\n    let up = await this.model(\"keyword\").where({id:[\"IN\",ids]}).update({lock:lock});\n    if(up){\n      return this.success({name:\"操作成功!\"});\n    }else {\n      return this.fail(\"操作失败!\")\n    }\n  }\n}"
    ]
}