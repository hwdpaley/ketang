{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/auth_safe_save_002230.js"
    ],
    "names": [
        "init",
        "http",
        "tactive",
        "updaterules",
        "returnnodes",
        "nodes",
        "AuthRule",
        "model",
        "map",
        "where",
        "order",
        "select",
        "rules",
        "data",
        "forEach",
        "temp",
        "name",
        "value",
        "url",
        "desc",
        "title",
        "module",
        "pid",
        "type",
        "status",
        "toLocaleLowerCase",
        "update",
        "ids",
        "diff",
        "rule",
        "i",
        "key",
        "think",
        "isEmpty",
        "id",
        "push",
        "condition",
        "isObjectValueEqual",
        "row",
        "addMany",
        "obj_values",
        "indexAction",
        "list",
        "v",
        "groupid",
        "count",
        "assign",
        "meta_title",
        "display",
        "adduserAction",
        "isPost",
        "post",
        "add",
        "cache",
        "success",
        "fail",
        "active",
        "edituserAction",
        "allowpost",
        "allowpostverify",
        "allowupgrade",
        "allowsendmessage",
        "allowattachment",
        "allowsearch",
        "console",
        "log",
        "get",
        "find",
        "info",
        "deluserAction",
        "delete",
        "dels",
        "getField",
        "issystem",
        "del",
        "sortAction",
        "param",
        "adminAction",
        "roleAction",
        "gets",
        "draw",
        "field",
        "res",
        "json",
        "roleeditAction",
        "isAjax",
        "description",
        "roleaddAction",
        "roledelAction",
        "accessAction",
        "auth_role",
        "this_role",
        "role",
        "accessdataAction",
        "node_list",
        "main_rules",
        "m_rules",
        "obj",
        "cateprivAction",
        "priv",
        "priv_roleid",
        "isArray",
        "arr",
        "split",
        "catid",
        "roleid",
        "action",
        "is_admin",
        "gettree",
        "tree",
        "userlistAction",
        "role_id",
        "userid",
        "userdata",
        "user_id",
        "testAction",
        "ss",
        "end",
        "writeroleAction",
        "rule_ids",
        "sort",
        "a",
        "b",
        "join",
        "chstaAction"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/auth_safe_save_002230.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\nexport default class extends Base {\n    init(http) {\n        super.init(http);\n        this.tactive = \"user\";\n\n    }\n    /**\n     * 后台节点配置的url作为规则存入auth_rule\n     * 执行新节点的插入,已有节点的更新,无效规则的删除三项任务\n     * @author\n     */\n    async updaterules() {\n        //需要新增的节点必然位于$nodes\n        let nodes = await this.returnnodes(false);\n        //think.log(nodes);\n        let AuthRule = this.model('auth_rule');\n        let map = {'module': 'admin', 'type': ['in', [1, 2]]};//status全部取出,以进行更新\n        //需要更新和删除的节点必然位于$rules\n        let rules = await AuthRule.where(map).order('name').select();\n        //构建insert数据\n        let data = {};//保存需要插入和更新的新节点\n\n        nodes.forEach(value=> {\n            let temp = {};\n            temp.name = value.url;\n            temp.desc = value.title;\n            temp.module = 'admin';\n            if (value.pid > 0) {\n                temp.type = 1;\n            } else {\n                temp.type = 2;\n            }\n            temp.status = 1;\n            //$data[strtolower($temp['name'].$temp['module'].$temp['type'])] = $temp;//去除重复项\n            let url = temp.name + temp.module + temp.type;\n            url = url.toLocaleLowerCase();\n            data[url] = temp;\n\n        })\n        //console.log(rules);\n        let update = [];//保存需要更新的节点\n        let ids = [];//保存需要删除的节点的id\n        let diff = {};\n        rules.forEach((rule, i) => {\n            let key = rule.name + rule.module + rule.type;\n            key = key.toLocaleLowerCase();\n            if (!think.isEmpty(data[key])) {//如果数据库中的规则与配置的节点匹配,说明是需要更新的节点\n                data[key].id = rule.id;//为需要更新的节点补充id值\n                update.push(data[key]);\n                delete data[key];\n                // console.log(i);\n                // rules.splice(i,1);\n                delete rule.condition;\n                delete rule.pid;\n                //console.log(rule);\n                diff[rule.id] = rule;\n            } else {\n                if (rule.status == 1) {\n                    ids.push(rule.id);\n                }\n            }\n        });\n\n        // console.log(update);\n        //console.log(rules);\n        // console.log(diff);\n        //console.log(data);\n        if (!think.isEmpty(update)) {\n            update.forEach(row=> {\n                //console.log(isObjectValueEqual(row, diff[row.id]))\n               // console.log(row)\n                //console.log(diff[row.id])\n                if (!isObjectValueEqual(row, diff[row.id])) {\n\n                    AuthRule.where({id: row.id}).update(row);\n                    //console.log(row);\n                }\n            })\n        }\n        //console.log(ids);\n        if (!think.isEmpty(ids)) {\n            AuthRule.where({id: ['IN', ids]}).update({'status': -1});\n            //删除规则是否需要从每个用户组的访问授权表中移除该规则?\n        }\n        // console.log(data);\n        if (!think.isEmpty(data)) {\n            AuthRule.addMany(obj_values(data));\n        }\n        //if ( $AuthRule->getDbError() ) {\n        //    trace('['.__METHOD__.']:'.$AuthRule->getDbError());\n        //    return false;\n        //}else{\n        //    return true;\n        //}\n        return true;\n    }\n\n\n    /**\n     * 用户分组管理首页\n     * @returns {*}\n     */\n   async indexAction() {\n        let list = await this.model(\"member_group\").order(\"sort ASC\").select();\n        for(let v of list){\n            v.count=await this.model('member').where({groupid:v.groupid,status:1}).count('id');\n        }\n        this.assign(\"list\",list);\n        this.meta_title = \"会员组管理\";\n        return this.display();\n    }\n\n    /**\n     * 添加会员组\n     */\n    async adduserAction(){\n        if(this.isPost()){\n            let data = this.post();\n            let add = await this.model(\"member_group\").add(data);\n            if (add) {\n                await think.cache(\"all_member_group\",null);\n                return this.success({ name: \"添加成功！\",url:\"/admin/auth/index\"});\n\n            } else {\n                return this.fail(\"添加失败！\");\n            }\n        }else {\n            this.meta_title=\"添加会员组\";\n            this.active=\"admin/auth/index\";\n            return this.display();\n        }\n\n    }\n    /**\n     * 编辑会员组\n     */\n    async edituserAction(){\n        if(this.isPost()){\n            let data = this.post();\n            data.allowpost= data.allowpost||0;\n            data.allowpostverify= data.allowpostverify||0;\n            data.allowupgrade= data.allowupgrade||0;\n            data.allowsendmessage= data.allowsendmessage||0;\n            data.allowattachment= data.allowattachment||0;\n            data.allowsearch= data.allowsearch||0;\n            console.log(data);\n            let update = await this.model(\"member_group\").where({groupid:data.groupid}).update(data);\n\n            if (update) {\n                await think.cache(\"all_member_group\",null);\n                return this.success({ name: \"编辑成功！\",url:\"/admin/auth/index\"});\n            } else {\n                return this.fail(\"编辑失败！\");\n            }\n\n        }else {\n            let info = await this.model(\"member_group\").where({groupid:this.get(\"id\")}).find();\n            this.assign(\"info\",info);\n            this.meta_title=\"编辑会员组\";\n            this.active=\"admin/auth/index\";\n            return this.display();\n        }\n\n    }\n    /**\n     * 删除会员组\n     */\n    async deluserAction(){\n        if(this.isPost()){\n            let ids = this.post(\"ids\");\n            let dels = await this.model('member_group').where({groupid:['IN',ids]}).delete();\n            if(dels){\n                await think.cache(\"all_member_group\",null);\n                return this.success({ name: \"删除成功！\"});\n            }else {\n                return this.fail(\"删除失败！\");\n            }\n        }else {\n            let id = this.get(\"id\");\n            let issystem = await this.model('member_group').where({groupid:id}).getField(\"issystem\",true);\n            if(issystem>0){\n                return this.fail(\"系统组，不能删除！\")\n            }\n            let del = await this.model('member_group').where({groupid:id}).delete();\n            if(del){\n                await think.cache(\"all_member_group\",null);\n                return this.success({ name: \"删除成功！\"});\n            }else {\n                return this.fail(\"删除失败！\");\n            }\n        }\n\n    }\n    /**\n     * 排序\n     */\n    async sortAction() {\n     if(this.param('type')==1){\n         await super.sortAction(this,'member_group','groupid');\n     }else {\n         await super.sortAction(this,'auth_role','id');\n     }\n    }\n    /**\n     * 管理角色管理首页\n     * @returns {*}\n     */\n   async adminAction() {\n        let list = await this.model('auth_role').order(\"id ASC\").select();\n        this.assign({\n            \"datatables\": true,\n            \"tactive\": \"/admin/user\",\n            \"selfjs\": \"auth\",\n            \"list\":list\n        })\n        this.active = \"admin/auth/index\";\n        this.meta_title = \"权限管理\";\n        return this.display();\n    }\n    /**\n     * role\n     * 权限管理首页ajax角色列表\n     * @returns {Promise|*}\n     */\n    async roleAction() {\n        let gets = this.get();\n        let draw = gets.draw;\n        let res = await this.model('auth_role').field(\"id,desc,status,description\").order(\"id ASC\").select();\n        let data = {\n            \"draw\": draw,\n            \"data\": res\n        }\n        //console.log(data);\n        return this.json(data);\n    }\n\n    async roleeditAction() {\n        if (this.isAjax(\"post\")) {\n            let id = this.post(\"id\");\n            let desc = this.post(\"desc\");\n            let description = this.post(\"description\");\n            let data = await this.model('auth_role').where({id: id}).update({desc: desc, description: description});\n            if(data){\n                return this.success({ name: \"修改成功！\"});\n            }else {\n                return this.fail(\"修改失败！\");\n            }\n        } else {\n            let id = this.get(\"id\");\n            let res = await this.model('auth_role').where({id: id}).find();\n            this.assign({\n                data: res\n            })\n            return this.display();\n        }\n    }\n\n    async roleaddAction() {\n        if(this.isPost()){\n            let data = this.post();\n            //console.log(1111111111111111)\n            let res = await this.model('auth_role').add(data);\n\n            if(res){\n                return this.success({ name: \"添加成功！\"});\n            }else {\n                return this.fail(\"添加失败！\");\n            }\n        }else {\n            return this.display();\n        }\n\n    }\n\n    /**\n     * roldel\n     * 角色删除\n     * @returns {Promise|*}\n     */\n    async roledelAction() {\n        let id = this.param(\"ids\");\n        //console.log(id);\n        if(think.isEmpty(id)){\n            return this.fail(\"参数不能为空！\")\n        }\n        let res = await this.model('auth_role').where({id: ['IN',id]}).delete();\n        if(res){\n            return this.success({ name: \"删除成功！\"});\n        }else {\n            return this.fail(\"删除失败！\");\n        }\n    }\n\n    /**\n     * 权限列表\n     * @returns {*}\n     */\n    async accessAction() {\n        await this.updaterules();//更新权限节点\n        let auth_role = await this.model('auth_role').where({status:[\"!=\",0],module :\"admin\",'type':1}).field('id,desc,rule_ids').select();\n        //let node_list = await this.returnnodes();\n        //let map       = {module:\"admin\",type:2,status:1};\n        //let main_rules= await this.model('auth_rule').where(map).field(\"name,id\").select();\n        //let nap       = {module:\"admin\",type:1,status:1};\n        //let child_rules = await this.model('auth_rule').where(nap).field('name,id').select();\n        let this_role = {};\n            auth_role.forEach(role=>{\n                if(role.id==this.get(\"id\")){\n                    this_role = role;\n                }\n            })\n        //console.log(node_list);\n        this.active=\"admin/auth/index\";\n        this.meta_title=\"权限管理\"\n        this.assign({\n            \"tactive\": \"/admin/user\",\n            \"selfjs\": \"auth\",\n            \"thisid\":this.get(\"id\"),\n            \"auth_role\":auth_role,\n            \"this_role\":this_role\n        })\n        return this.display();\n    }\n\n\n    async accessdataAction() {\n        await this.updaterules();//更新权限节点\n        let auth_role = await this.model('auth_role').where({status:[\"!=\",0],module :\"admin\",'type':1}).field('id,desc,rule_ids').select();\n        let node_list = await this.returnnodes();\n        let map       = {module:\"admin\",type:['IN',[1,2]],status:1};\n        let main_rules=await this.model('auth_rule').where(map).field(\"name,id\").select();\n        //let nap       = {module:\"admin\",type:1,status:1};\n        //let child_rules =await this.model('auth_rule').where(nap).field('name,id').select();\n        let this_role = {};\n        auth_role.forEach(role=>{\n            if(role.id==this.post(\"id\")){\n                this_role = role;\n            }\n        })\n        let m_rules = {}\n        main_rules.forEach(v=>{\n            let obj = {}\n             obj[v.name]=v.id;\n            Object.assign(m_rules,obj)\n        })\n        let data = {\n            \"main_rules\":m_rules,\n            \"node_list\":node_list,\n            \"this_role\":this_role\n        }\n        return this.json(data);\n    }\n\n    /**\n     * 栏目权限\n     */\n    async cateprivAction(){\n        if(this.isPost()){\n            let data = this.post();\n            //构造权限\n            let priv =[]\n            if(!think.isEmpty(data.priv_roleid)){\n                if(think.isArray(data.priv_roleid)){\n                    //构造 角色权限\n                    for (let v of data.priv_roleid){\n                        let arr = v.split(\",\")\n                        let obj = {};\n                        obj.catid = arr[1];\n                        obj.roleid= arr[2];\n                        obj.action = arr[0];\n                        obj.is_admin = 1;\n                        priv.push(obj)\n                    }\n                }else {\n                    let arr = (data.priv_roleid).split(\",\")\n                    priv.push({ catid:arr[1],  roleid: arr[2], action: arr[0], is_admin: 1 })\n                }\n\n            }\n            await this.model(\"category_priv\").delete({where:{is_admin:1,roleid:data.roleid}});\n            if(!think.isEmpty(priv)){\n                await this.model(\"category_priv\").addMany(priv)\n            }\n            think.cache(\"all_priv\",null);//栏目权限缓存\n           return this.success({name:\"修改成功！\"})\n        }else {\n            let tree = await this.model('category').gettree(0,\"id,name,title,sort,pid,allow_publish,status,model,mold,isapp\");\n            this.assign({\n                \"tactive\": \"/admin/user\",\n                \"tree\":tree\n            })\n            this.active = \"admin/auth/index\";\n            this.meta_title = \"栏目权限\";\n            return this.display();\n        }\n\n    }\n\n    /**\n     * 成员管理\n     */\n    async userlistAction(){\n        let id = this.get(\"id\");\n        let userid = await this.model(\"auth_user_role\").where({role_id:id}).getField(\"user_id\");\n        let userdata;\n        if(!think.isEmpty(userid)){\n            userdata=await this.model(\"member\").where({id:[\"IN\",userid]}).select();\n            for(let v of userdata){\n                let role_id = await this.model(\"auth_user_role\").where({user_id:v.id}).getField(\"role_id\",true);\n                v.role = await this.model(\"auth_role\").where({id:role_id}).getField(\"desc\",true)\n            }\n        }\n\n        this.assign(\"userlist\",userdata);\n        this.meta_title = \"成员管理\";\n        this.active = \"admin/auth/index\";\n        return this.display();\n    }\n    async testAction() {\n\n        let ss = await this.updaterules();\n        //console.log(ss);\n        this.end();\n    }\n\n    /**\n     * 管理员用户组数据写入/更新\n     *\n     */\n    async writeroleAction(){\n        let map={};\n        map.rule_ids = this.post(\"rules\");\n        if(think.isArray(map.rule_ids)){\n        map.rule_ids = map.rule_ids.sort(function(a,b){return a-b}).join(\",\");\n        }\n        map.module = \"admin\";\n        map.type = 1;\n        let id = this.post(\"id\");\n        let role = this.model(\"auth_role\");\n            await role.where({id:id}).update(map);\n            return this.success({name:\"更新成功\"});\n\n    }\n\n    /**\n     * 改变角色状态\n     * @returns {Promise|*}\n     */\n    async chstaAction(){\n        let role = this.model(\"auth_role\");\n        let res = await role.update(this.get());\n        if(res){\n            return this.json(res);\n        }\n    }\n}"
    ]
}