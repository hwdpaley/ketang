{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/channel.js"
    ],
    "names": [
        "init",
        "http",
        "db",
        "model",
        "tactive",
        "indexAction",
        "get_channel_cache",
        "tree",
        "assign",
        "meta_title",
        "display",
        "getchannelAction",
        "json",
        "addAction",
        "active",
        "editAction",
        "id",
        "get",
        "find",
        "info",
        "think",
        "isEmpty",
        "fail",
        "updatesAction",
        "data",
        "post",
        "updates",
        "res",
        "err",
        "log",
        "user",
        "uid",
        "ip",
        "url",
        "success",
        "name",
        "delAction",
        "split",
        "map",
        "where",
        "delete",
        "cache"
    ],
    "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;;;;;AAGI;;;;mBAIAA,I,iBAAKC,I,EAAK;AACN,oBAAMD,IAAN,YAAWC,IAAX;AACA,SAAKC,EAAL,GAAU,KAAKC,KAAL,CAAW,SAAX,CAAV;AACA,SAAKC,OAAL,GAAe,OAAf;AACH,G;;AAED;;;;;;mBAIKC,W;;;;;;;;qBAEgB,KAAKH,EAAL,CAAQI,iBAAR,E;;;AAAbC,kB;;AACJ;AACA,mBAAKC,MAAL,CAAY,MAAZ,EAAmBD,IAAnB;AACA,mBAAKE,UAAL,GAAkB,MAAlB;+CACO,KAAKC,OAAL,E;;;;;;;;;;;;;;;;;AAGX;;;;;;mBAIMC,gB;;;;;;;;qBACe,KAAKT,EAAL,CAAQI,iBAAR,E;;;AAAbC,kB;gDACG,KAAKK,IAAL,CAAUL,IAAV,C;;;;;;;;;;;;;;;;;mBAGVM,S,wBAAW;AACR;AACE,SAAKJ,UAAL,GAAkB,MAAlB;AACA,SAAKK,MAAL,GAAY,qBAAZ;AACA,WAAO,KAAKJ,OAAL,EAAP;AAEL,G;;mBACKK,U;;;;;;;AACF;AACIC,gB,GAAK,KAAKC,GAAL,CAAS,KAAT,C;;qBACQ,KAAKd,KAAL,CAAW,SAAX,EAAsBe,IAAtB,CAA2BF,EAA3B,C;;;AAAbG,kB;;AACJ,kBAAGC,MAAMC,OAAN,CAAcF,IAAd,CAAH,EAAuB;AACrB,qBAAKG,IAAL,CAAU,UAAV;AACD;AACD,mBAAKd,MAAL,CAAY,MAAZ,EAAmBW,IAAnB;AACA,mBAAKV,UAAL,GAAkB,MAAlB;AACA,mBAAKK,MAAL,GAAY,qBAAZ;gDACO,KAAKJ,OAAL,CAAa,KAAb,C;;;;;;;;;;;;;;;;AAEX;;;mBACKa,a;;;;;;;AACCC,kB,GAAO,KAAKC,IAAL,E;;qBACK,KAAKtB,KAAL,CAAW,SAAX,EAAsBuB,OAAtB,CAA8BF,IAA9B,C;;;AAAZG,iB;6BACIA,IAAIC,G;gDACL,C,wBAIA,C,yBAGA,C;;;;;qBANG,KAAKzB,KAAL,CAAW,QAAX,EAAqB0B,GAArB,CAAyB,gBAAzB,EAA0C,SAA1C,EAAoDF,IAAIX,EAAxD,EAA2D,KAAKc,IAAL,CAAUC,GAArE,EAAyE,KAAKC,EAAL,EAAzE,EAAmF,KAAK/B,IAAL,CAAUgC,GAA7F,C;;;gDACC,KAAKC,OAAL,CAAa,EAACC,MAAK,OAAN,EAAcF,KAAI,sBAAlB,EAAb,C;;;gDAGA,KAAKX,IAAL,CAAU,OAAV,C;;;;qBAGD,KAAKnB,KAAL,CAAW,QAAX,EAAqB0B,GAArB,CAAyB,gBAAzB,EAA0C,SAA1C,EAAoDF,IAAIX,EAAxD,EAA2D,KAAKc,IAAL,CAAUC,GAArE,EAAyE,KAAKC,EAAL,EAAzE,EAAmF,KAAK/B,IAAL,CAAUgC,GAA7F,C;;;gDACC,KAAKC,OAAL,CAAa,EAACC,MAAK,OAAN,EAAcF,KAAI,sBAAlB,EAAb,C;;;gDAGA,KAAKX,IAAL,CAAU,OAAV,C;;;;;;;;;;;;;;;;;AAIb;;;mBACMc,S;;;;;;;AACApB,gB,GAAK,KAAKC,GAAL,CAAS,IAAT,C;;AACTD,mBAAKA,GAAGqB,KAAH,CAAS,GAAT,CAAL;AACA,kBAAGjB,MAAMC,OAAN,CAAcL,EAAd,CAAH,EAAqB;AACnB,qBAAKM,IAAL,CAAU,YAAV;AACD;AACGgB,iB,GAAM,EAACtB,IAAG,CAAC,IAAD,EAAMA,EAAN,CAAJ,E;;qBACM,KAAKb,KAAL,CAAW,SAAX,EAAsBoC,KAAtB,CAA4BD,GAA5B,EAAiCE,MAAjC,E;;;AAAZb,iB;;mBACDA,G;;;;;;qBACK,KAAKxB,KAAL,CAAW,QAAX,EAAqB0B,GAArB,CAAyB,gBAAzB,EAA0C,SAA1C,EAAoDb,EAApD,EAAuD,KAAKc,IAAL,CAAUC,GAAjE,EAAqE,KAAKC,EAAL,EAArE,EAA+E,KAAK/B,IAAL,CAAUgC,GAAzF,C;;;AAA8F;AACpGb,oBAAMqB,KAAN,CAAY,mBAAZ,EAAgC,IAAhC,E,CAAsC;gDAC/B,KAAKP,OAAL,CAAa,EAACC,MAAK,OAAN,EAAb,C;;;gDAEF,KAAKb,IAAL,CAAU,OAAV,C",
    "file": "../../../src/admin/controller/channel.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    init(http){\n        super.init(http);\n        this.db = this.model('channel');\n        this.tactive = \"setup\"\n    }\n\n    /**\n     * 导航管理首页\n     * @returns {*}\n     */\n   async indexAction(){\n        //auto render template file index_index.html\n        let tree = await this.db.get_channel_cache();\n        //console.log(tree)\n        this.assign(\"list\",tree);\n        this.meta_title = \"导航管理\";\n        return this.display();\n    }\n\n    /**\n     * 获取全部导航ajax\n     * @returns {*}\n     */\n    async getchannelAction(){\n        let tree = await this.db.get_channel_cache();\n        return this.json(tree);\n    }\n\n     addAction(){\n        //添加导航\n          this.meta_title = \"添加导航\";\n          this.active=\"admin/channel/index\";\n          return this.display();\n\n    }\n    async editAction(){\n        //编辑导航\n        let id = this.get('cid');\n        let info = await this.model('channel').find(id);\n        if(think.isEmpty(info)){\n          this.fail(\"获取配置信息错误\");\n        }\n        this.assign('info',info);\n        this.meta_title = \"编辑导航\";\n        this.active=\"admin/channel/index\";\n        return this.display('add');\n    }\n    //更新或者新增导航\n   async updatesAction(){\n      let data = this.post();\n      let res = await this.model(\"channel\").updates(data);\n      switch (res.err) {\n        case 1:\n          await this.model(\"action\").log(\"update_channel\",\"channel\",res.id,this.user.uid,this.ip(),this.http.url);//记录行为\n          return this.success({name:\"新增成功！\",url:\"/admin/channel/index\"});\n          break;\n        case 2:\n          return this.fail(\"新增失败！\")\n          break;\n        case 3:\n          await this.model(\"action\").log(\"update_channel\",\"channel\",res.id,this.user.uid,this.ip(),this.http.url);//记录行为\n          return this.success({name:\"更新成功！\",url:\"/admin/channel/index\"})\n          break;\n        default:\n          return this.fail(\"更新失败！\")\n      }\n    }\n\n    //删除导航\n    async delAction(){\n      let id = this.get('id');\n      id = id.split(\",\");\n      if(think.isEmpty(id)){\n        this.fail(\"请选择要操作的数据！\");\n      }\n      let map = {id:['IN',id]};\n      let res = await this.model('channel').where(map).delete();\n      if(res){\n        await this.model(\"action\").log(\"update_channel\",\"channel\",id,this.user.uid,this.ip(),this.http.url);//记录行为\n        think.cache(\"get_channel_cache\",null);//更新频道缓存信息\n        return this.success({name:\"删除成功！\"});\n      }else {\n      return this.fail(\"删除失败！\");\n      }\n    }\n}\n"
    ]
}