{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/attribute.js"
    ],
    "names": [
        "init",
        "http",
        "tactive",
        "db",
        "model",
        "indexAction",
        "model_id",
        "get",
        "field",
        "find",
        "modelname",
        "where",
        "page",
        "countSelect",
        "list",
        "Pages",
        "think",
        "adapter",
        "pages",
        "meta_title",
        "active",
        "assign",
        "data",
        "pagerData",
        "title",
        "display",
        "extAction",
        "table",
        "parseConfig",
        "config",
        "prefix",
        "name",
        "getSchema",
        "result",
        "console",
        "log",
        "addAction",
        "editAction",
        "id",
        "isEmpty",
        "fail",
        "updateAction",
        "post",
        "upattr",
        "res",
        "success",
        "url",
        "delAction",
        "info",
        "delete",
        "deleteField",
        "checknameAction",
        "checkName",
        "json"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/attribute.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\n/**\n * 字段属性控制器\n * @author 阿特 <arterli@qq.com>\n * http://www.cmswing.com\n */\nexport default class extends Base {\n    init(http) {\n        super.init(http);\n        this.tactive = \"setup\";\n        this.db = this.model('attribute');\n    }\n    /**\n     * 字段列表\n     * @return {Promise} []\n     */\n    async indexAction(){\n        let model_id = this.get('model_id');\n        //await this.db.checkTableExist(model_id);\n        //console.log(think.isNumber(85));\n        let modelname = await this.model(\"model\").field('title').find(model_id);\n        let list = await this.db.where({model_id:model_id}).page(this.get('page')).countSelect();\n        let Pages = think.adapter(\"pages\", \"page\"); //加载名为 dot 的 Template Adapter\n        let pages = new Pages(this.http); //实例化 Adapter\n        let page = pages.pages(list);\n       // console.log(modelname);\n        this.meta_title=\"字段列表\";\n        this.active = \"admin/model/index\";\n        this.assign({\n            list:list.data,\n            model_id:model_id,\n            pagerData:page,\n            modelname:modelname.title\n        });\n        return this.display();\n    }\n\n    /**\n     * 独立模型字段列表\n     */\n    async extAction(){\n        let model_id = this.get('model_id');\n        let model = await this.model(\"model\").find(model_id);\n        let table = think.parseConfig(true,think.config(\"db\")).prefix + model.name;\n        let db = think.model('mysql', think.config('db'));\n        let result = await db.getSchema(table);\n        console.log(result);\n        this.meta_title=\"字段列表\";\n        this.active = \"admin/model/index\";\n        this.assign(\"table\",table);\n        this.assign(\"list\",result);\n        return this.display();\n    }\n    /**\n     * 新增字段\n     * @returns {*}\n     */\n    async addAction(){\n        let model_id = this.get('model_id');\n        let modelname = await this.model(\"model\").field('title').find(model_id);\n        this.meta_title=\"新增字段\";\n        this.active = \"admin/model/index\";\n        this.assign({\n            meta_title:\"新增\",\n            model_id:model_id,\n            modelname:modelname.title\n        })\n        return this.display();\n\n    }\n    /**\n     * 编辑页面初始化\n     * @author huajie <banhuajie@163.com>\n     */\n    async editAction(){\n        let id = this.get('id');\n        if(think.isEmpty(id)){\n            this.fail('参数不能为空！');\n        }\n\n        /*获取一条记录的详细数据*/\n        let data = await this.db.find(id);\n        if(!data){\n            this.fail('错误');\n        }\n        let model  =  await this.model('model').field('title,name,field_group').find(data.model_id);\n        let modelname = await this.model(\"model\").field('title').find(data.model_id);\n        this.assign('model',model);\n        this.assign('info', data);\n        this.active = \"admin/model/index\";\n        this.assign({\n            meta_title:\"编辑\",\n            model_id:data.model_id,\n            modelname:modelname.title\n        })\n        this.meta_title = '编辑属性';\n        this.display(\"add\");\n    }\n    /**\n     * 更新一条数据\n     * @author\n     */\n    async updateAction(){\n        let post = this.post();\n        //console.log(post);\n        let res = await this.db.upattr(post,true);\n        //console.log(res);\n        if(res){\n            this.success({name:res.id?'更新成功':'新增成功', url:`/admin/attribute/index/model_id/${res.model_id}`});\n        }else{\n            this.fail(\"更新失败\")\n        }\n    }\n\n    /**\n     * 删除一条数据\n     * @author\n     */\n    async delAction(){\n        let id = this.get('id');\n        think.isEmpty(id) && this.fail('参数错误！');\n\n        let info = await this.db.where({id:id}).find();\n        console.log(info)\n        think.isEmpty(info) && this.fail('该字段不存在！');\n\n        //删除属性数据\n        let res = await this.db.where({id:id}).delete();\n\n        //删除表字段\n        await this.db.deleteField(info);\n        if(!res){\n            this.fail('操作失败！');\n        }else{\n            //记录行为\n            //action_log('update_attribute', 'attribute', $id, UID);\n            this.success({name:'删除成功', url:`/admin/attribute/index/model_id/${info.model_id}`});\n        }\n    }\n\n    /**\n     * 新增字段检查同一张表是否有相同的字段\n     */\n    async checknameAction(){\n       let name = this.get('name');\n        let model_id = this.get('model_id');\n        let id = this.get('id');\n       let res = await this.db.checkName(name,model_id,id);\n        if(res){\n            return this.json(1);\n        }else {\n            return this.json(0);\n        }\n    }\n}\n"
    ]
}