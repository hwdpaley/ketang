{
    "version": 3,
    "sources": [
        "../../../src/admin/controller/setup.js"
    ],
    "names": [
        "init",
        "http",
        "db",
        "model",
        "tactive",
        "loadsetup",
        "fs",
        "require",
        "lists",
        "setup",
        "path1",
        "think",
        "getPath",
        "isDir",
        "ROOT_PATH",
        "data",
        "writeFileSync",
        "data1",
        "indexAction",
        "id",
        "get",
        "type",
        "CONFIG_GROUP_LIST",
        "where",
        "field",
        "order",
        "select",
        "list",
        "assign",
        "meta_title",
        "display",
        "groupAction",
        "groupdataAction",
        "isGet",
        "map",
        "status",
        "gets",
        "start",
        "parseInt",
        "length",
        "draw",
        "key",
        "group",
        "limit",
        "countSelect",
        "forEach",
        "v",
        "CONFIG_TYPE_LIST",
        "count",
        "json",
        "addAction",
        "isPost",
        "post",
        "update_time",
        "Date",
        "valueOf",
        "add",
        "addres",
        "cache",
        "active",
        "editAction",
        "create_time",
        "update",
        "upres",
        "find",
        "info",
        "saveAction",
        "name",
        "value",
        "delAction",
        "delete",
        "res",
        "parsleyAction",
        "isEmpty",
        "aabbAction",
        "getallmenu",
        "end"
    ],
    "mappings": "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",
    "file": "../../../src/admin/controller/setup.js",
    "sourcesContent": [
        "// +----------------------------------------------------------------------\n// | Bieber [ 美媒网站内容管理框架 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2017 http://www.gzxinbibo.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Author: Tony <912697590@qq.com>\n// +----------------------------------------------------------------------\n'use strict';\n\nimport Base from './base.js';\nexport default class extends Base {\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    init(http){\n        super.init(http);\n        this.db = this.model('setup');\n        this.tactive = \"setup\"\n    }\n    //加载配置\n    async loadsetup(){\n        const fs = require('fs');\n        let setup = await this.model(\"setup\").lists();\n        let path1 = think.getPath(\"common\", \"config\");\n        if(think.isDir(think.ROOT_PATH+'/src')){\n            let data = \"export default\"+JSON.stringify(setup);\n            fs.writeFileSync(think.ROOT_PATH+'/src/common/config/setup.js', data);\n        }\n        let data1 = \"exports.__esModule = true;exports.default =\"+JSON.stringify(setup);\n        fs.writeFileSync(path1+'/setup.js', data1);\n    }\n    async indexAction(){\n        //加载配置\n        await this.loadsetup();\n        //auto render template file index_index.html\n        let id = this.get('id')||1;\n        let type = this.setup.CONFIG_GROUP_LIST;\n        let list = await this.model(\"setup\").where({'status':1,'group':id}).field('id,name,title,extra,value,remark,type').order('sort').select();\n       if(list){\n           this.assign('list',list);\n       }\n        this.assign({\n            \"meta_title\":type[id]+\"设置\",\n            \"id\":id\n        })\n        this.meta_title='网站配置';\n        return this.display();\n    }\n\n    groupAction(){\n        this.meta_title = \"配置管理\"\n        return this.display();\n    }\n    async groupdataAction(){\n        if(this.isGet()){\n            let map = {};\n            map.status = 1;\n            let gets = this.get();\n            let start = parseInt(gets.start);\n            let length = parseInt(gets.length);\n            let draw = gets.draw;\n            let key = gets['search[value]'];\n            map[\"name|title\"] = [\"like\", \"%\"+key+\"%\"];\n            if(gets.group){\n                map.group   =   gets.group||0;\n            }\n            //如果缓存 userList 不存在，则查询数据库，并将值设置到缓存中\n            let lists = await this.db.limit(start, length).where(map).order(\"sort ASC\").countSelect()\n            lists.data.forEach(v =>{\n                if(v.group){\n                v.group=this.setup.CONFIG_GROUP_LIST[v.group];\n                }else{\n                    v.group=\"未分组\";\n                }\n                v.type =this.setup.CONFIG_TYPE_LIST[v.type];\n            })\n\n            let data={\n                \"draw\": draw,\n                \"recordsTotal\": lists.count,\n                \"recordsFiltered\": lists.count,\n                \"data\": lists.data\n            }\n            return this.json(data);\n        }\n    }\n\n    /**\n     * 新增配置\n     *\n     */\n    async addAction(){\n        if(this.isPost()){\n            let data = this.post();\n            data.status = 1;\n            data.update_time = new Date().valueOf();\n            let addres =await this.db.add(data);\n            if(addres){\n                think.cache(\"setup\", null);\n                await this.loadsetup();\n                return this.json(1)\n            }else {\n                return this.json(0)\n            }\n        }else {\n            this.assign({\n                \"action\":\"/admin/setup/add\"\n            })\n            this.active = \"admin/model/index\"\n            this.meta_title=\"新增配置\";\n            this.display();\n        }\n    }\n    //编辑配置\n    async editAction(){\n        if(this.isPost()){\n            let data = this.post();\n            data.status = 1;\n            data.create_time = new Date().valueOf();\n            let upres =await this.db.update(data);\n            if(upres){\n                think.cache(\"setup\", null);\n                await this.loadsetup();\n                return this.json(1)\n            }else {\n                return this.json(0)\n            }\n        }else {\n            let map = {};\n            map.id = this.get(\"id\");\n            let info = await this.db.where(map).find();\n            this.assign(\"info\",info);\n            this.assign({\n                \"action\":\"/admin/setup/edit\"\n            })\n            this.active = \"admin/model/index\"\n            this.meta_title=\"编辑新增\";\n            this.display();\n        }\n\n    }\n    async saveAction(){\n        let post = this.post();\n        //console.log(post);\n        for(let v in post){\n            this.db.where({name: v}).update({value: post[v]});\n        }\n        think.cache(\"setup\", null);\n        await this.loadsetup();\n        this.json(1)\n    }\n\n//删除配置\n    async delAction(){\n        let id = this.get(\"id\");\n        let res = await this.db.where({id:id}).delete();\n        if(res){\n            think.cache(\"setup\", null);\n            await this.loadsetup();\n            return this.json(1)\n        }else {\n            return this.json(0)\n        }\n    }\n    /**\n     * 添加配置异步验证数据\n     * @returns {Promise|*}\n     */\n    async parsleyAction(){\n        //验证\n        let data=this.get();\n        // console.log(data);\n        let res = await this.db.where(data).find();\n        // console.log(res);\n        if(think.isEmpty(res)){\n            return this.json(1);\n        }else{\n            return this.json(0);\n        }\n    }\n\n\n    async aabbAction(){\n\n        //obj = \"export default \"+JSON.stringify(obj)\n        //let filename = think.getPath(\"common\", \"model\");\n        //this.config(\"setup\",{\"aa\":\"bbb\"})\n\n        let value = await this.model(\"menu\").getallmenu();\n        this.end(value);\n        //fs.writeFileSync(filename, obj, [options])\n    }\n}"
    ]
}