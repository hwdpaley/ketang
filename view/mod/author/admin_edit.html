{% extends "../../admin/inc/base.html" %} {% block style %}
<!--<link rel="stylesheet" href="/static/admin/js/zTree/metroStyle/metroStyle.css" type="text/css">-->
<link rel="stylesheet" href="/static/admin/js/zTree/zTreeStyle/zTreeStyle.css" type="text/css">
<link rel="stylesheet" href="/static/admin/js/webuploader/webuploader.css" type="text/css">
<script src="/static/admin/js/jquery.min.js"></script>
<script src="/static/admin/js/webuploader/webuploader.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8" src="/static/admin/js/udeitor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="/static/admin/js/udeitor/ueditor.all.min.js"> </script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="/static/admin/js/udeitor/lang/zh-cn/zh-cn.js"></script>
{% endblock%} {% block content %}
<section class="vbox">
    <section id="bjax-target">
        <section class="hbox stretch">
            <!-- side content -->
            {% include "../../admin/inc/article_side.html" %}
            <!-- / side content -->
            <section>
                <section class="vbox">
                    <section class="scrollable wrapper">
                        <!-- .breadcrumb -->
                        <ul class="breadcrumb">
                            <li><a href="/admin/article/index"><i class="fa fa-home"></i> 网站内容</a></li>
                            {% for nav in breadcrumb%} {% if controller.m_cate.id == nav.id %}
                            <li class="active">{{nav.title}}  : {{controller.meta_title}} </li>
                            {%else%}
                            <li><a href="/mod/admin/index/cate_id/{{nav.id}}"><i class="fa fa-list-ul"></i> {{nav.title}}</a></li>
                            {% endif %} {% endfor %} {%if article.id >0 %}
                            <li> <i class="fa fa-list-ul"></i> {{article.title}} </li>{% endif %}
                        </ul>
                        <!-- / .breadcrumb -->
                        <div class="row">
                            <div class="col-lg-12">
                                <section class="panel panel-default">
                                    <div class="panel-body">
                                        <form id="ajaxForm" method="post" class="form-horizontal" action="/mod/author/admin/update" data-validate="parsley">
                                            <input type="hidden" value="{{csrf}}" name="__CSRF__">
                                            {%if sort%}
                                            <input type="hidden" name="sort_id" value="{{data.sort_id}}">
                                            <div class="form-group">
                                                <label  class="col-sm-2 control-label">
                                                    分类
                                                </label>
                                                <div class="col-sm-10">
                                                    <div class="row">
                                                        <div class="col-md-10">
                                                            <div class="btn-group" >
                                                                {%for val in sort.types%}
                                                                <a href="/mod/author/admin/edit/id/{{data.id}}/model/{{data.model_id}}/cate_id/{{data.category_id}}/sortid/{{val.enable}}" class="btn btn-sm btn-default {%if data.sort_id == val.enable%}active{%endif%}">
                                                                    {{val.name}}
                                                                </a>
                                                                {%endfor%}

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {%for val in typevar%}
                                            {%if val.available==1%}
                                            <div class="form-group">
                                                <label  class="col-sm-2 control-label">
                                                    {{val.option.title}}
                                                </label>
                                                <div class="col-sm-10">
                                                    <div class="row">

                                                        {%if val.option.type == 'select'%}
                                                        <div class="col-md-10">
                                                            <input type="hidden" name="sortid_{{val.option.identifier}}" value="{{val.option.value}}" {% if val.required == 1 %}data-required="true"{%endif%}>
                                                            <label id="info_{{val.option.identifier}}"  class="checkbox-inline i-checks" >{{val.option.rules.choices[val.option.value]|default("请选择",true)}}</label>
                                                            <span id="sortid_{{val.option.identifier}}" class="tabelselet"></span>
                                                            <a href="#" id="edit_{{val.option.identifier}}" class="checkbox-inline i-checks text-info">修改</a>

                                                            <script>



                                                                $(function () {
                                                                    function getShowTimes(string,indexChar){
                                                                        //返回一个字符在字符串中出现的次数
                                                                        return (string.split(indexChar).length-1);
                                                                    }

                                                                    var jsonObj ={{val.option.rules.choices|jsonToStr|safe}};
                                                                    /*递归实现获取无级树数据并生成DOM结构*/
                                                                    var jValue;
                                                                    //alert(getShowTimes("4.2.1","4.3"));
                                                                    var forTree = function(o){
                                                                        jValue ='<select class="form-control">';
                                                                        jValue +='<option value=""  >请选择</option>';
                                                                        for(var item in jsonObj){
                                                                            if(item.indexOf(".")<0){
                                                                                jValue +='<option value='+ item +'>'+ jsonObj[item] +'</option>';
                                                                            }
                                                                        }
                                                                        jValue += "</select>";
                                                                        return jValue;
                                                                    }
                                                                    var subTree = function(jsonObj,item){
                                                                        var arr =[];
                                                                        for(var item2 in jsonObj){
                                                                            let vvv = item+".";
                                                                            let count = getShowTimes(vvv,".")
                                                                            if(item2.indexOf(vvv)==0 && getShowTimes(item2,".")==count ){
                                                                                var htm = '<option value='+ item2 +'>'+ jsonObj[item2] +'</option>';
                                                                                arr.push(htm);
                                                                                //subTree(jsonObj,item2);
                                                                            }
                                                                        }
                                                                        if(arr.length>0){
                                                                            var str = "";
                                                                            str +='<select class="form-control">';
                                                                            str +='<option value="">请选择</option>';
                                                                            str += arr.join("")
                                                                            str += "</select>";
                                                                            return str;
                                                                        }

                                                                    }
                                                                    $(document).on("change","#sortid_{{val.option.identifier}} select",function () {
                                                                        var val = $(this).find("option:selected").val();
                                                                        var text = $(this).find("option:selected").text();
                                                                        var info;
                                                                        if(val){
                                                                            info = "你的选择: <b class='text-info'>" + text+"</b>";
                                                                        }else {
                                                                            info =text;
                                                                        }
                                                                        $(this).nextAll().remove();
                                                                        $(this).after(subTree(jsonObj, val));
                                                                        $('input[name="sortid_{{val.option.identifier}}"]').val(val);
                                                                        $("#info_{{val.option.identifier}}").html(info)
                                                                    })
                                                                    $(document).on("click","#edit_{{val.option.identifier}}",function (e) {
                                                                        e.preventDefault();

                                                                        $("#sortid_{{val.option.identifier}}").html(forTree(jsonObj));
                                                                    })
                                                                    //

                                                                })
                                                            </script>

                                                        </div>
                                                        {#
                                                        <div class="col-md-3">
                                                            <select class="form-control " name="sortid_{{val.option.identifier}}" {% if val.required == 1 %}data-required="true"{%endif%}>
                                                                <option value=" "  >请选择</option>
                                                                {% for k ,v in val.option.rules.choices %}
                                                                <option value="{{k}}" {% if val.option.value == k %}selected{%endif%}>[{{k}}] {{v}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        #}
                                                        {% elif val.option.type == 'number' or val.option.type == 'range'%}
                                                        <div class="col-md-2">
                                                            <input type="number" class="form-control " name="sortid_{{val.option.identifier}}" value="{{val.option.value}}"  {% if val.required == 1 %}data-required="true"{%endif%}>
                                                        </div>
                                                        {% elif val.option.type == 'textarea' %}
                                                        <div class="col-md-8">
                                                            <textarea class="form-control" name="sortid_{{val.option.identifier}}"  {% if val.required == 1 %}data-required="true"{%endif%}  {% if val.option.rules.rowsize %} rows="{{val.option.rules.rowsize}}" {% endif %}>{{val.option.value}}</textarea>
                                                        </div>
                                                        {% elif val.option.type == 'radio' %}
                                                        <div class="col-md-8">
                                                            {% for k ,v in val.option.rules.choices %}
                                                            <label class="radio-inline i-checks">
                                                                <input type="radio" value="{{k}}" name="sortid_{{val.option.identifier}}" {% if val.option.value == k %}checked{%endif%} ><i></i> {{v}}
                                                            </label>
                                                            {% endfor %}
                                                        </div>
                                                        {% elif val.option.type == 'checkbox' %}
                                                        <div class="col-md-8">
                                                            <input class="hide" type="checkbox" value="0" name="sortid_{{val.option.identifier}}" checked>
                                                            {% for k ,v in val.option.rules.choices %}
                                                            <label class="checkbox-inline i-checks">
                                                                <input type="checkbox" value="{{k}}" name="sortid_{{val.option.identifier}}" {% if k|in_Array(val.option.value|strToJson)  %}checked{%endif%}><i></i> {{v}}
                                                            </label>
                                                            {% endfor %}
                                                        </div>
                                                        {% elif val.option.type == 'calendar' %}
                                                        <div class="col-md-3">
                                                            <input type="text" name="sortid_{{val.option.identifier}}" class="form-control date" value="{{val.option.value}}" data-type="dateIso" placeholder="YYYY-MM-DD" {% if val.required == 1 %}data-required="true"{%endif%}/>
                                                        </div>
                                                        {%elif val.option.type == 'email'%}
                                                        <div class="col-md-3">
                                                            <input type="text" name="sortid_{{val.option.identifier}}" class="form-control" value="{{val.option.value}}" data-type="email" {% if val.required == 1 %}data-required="true"{%endif%}>
                                                        </div>
                                                        {%elif val.option.type == "image"%}
                                                        <div class="col-sm-10">
                                                            <input type="hidden" name="sortid_{{val.option.identifier}}" id="sortid_{{val.option.identifier}}" value="{{val.option.value}}"/>
                                                            <div id="fileList_sortid_{{val.option.identifier}}" class="uploader-list"></div>
                                                            <div id="filePicker_sortid_{{val.option.identifier}}">选择图片</div>
                                                            <script type="text/javascript">
                                                                $list_sortid_{{val.option.identifier}} = $('#fileList_sortid_{{val.option.identifier}}'),
                                                                    // 优化retina, 在retina下这个值是2
                                                                    ratio_sortid_{{val.option.identifier}} = window.devicePixelRatio || 1,

                                                                    // 缩略图大小
                                                                    thumbnailWidth_sortid_{{val.option.identifier}} = 100 * ratio_sortid_{{val.option.identifier}},
                                                                thumbnailHeight_sortid_{{val.option.identifier}} = 100 * ratio_sortid_{{val.option.identifier}},

                                                                // Web Uploader实例
                                                                uploader_sortid_{{val.option.identifier}};

                                                                // 初始化Web Uploader
                                                                // 初始化Web Uploader
                                                                var uploader_sortid_{{val.option.identifier}} = WebUploader.create({
                                                                    // 选完文件后，是否自动上传。
                                                                    auto: true,
                                                                    formData:{"__CSRF__":"{{csrf}}"},
                                                                    // swf文件路径
                                                                    swf: '/static/admin/js/webuploader/Uploader.swf',
                                                                    // 文件接收服务端。
                                                                    server: '/admin/file/uploadpic',
                                                                    // 选择文件的按钮。可选。
                                                                    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                                                                    pick: {
                                                                        id:'#filePicker_sortid_{{val.option.identifier}}',
                                                                        multiple: false
                                                                    },
                                                                    // 只允许选择图片文件。
                                                                    accept: {
                                                                        title: 'Images',
                                                                        extensions: 'gif,jpg,jpeg,bmp,png',
                                                                        mimeTypes: 'image/jpg,image/jpeg,image/png,image/gif,image/bmp'
                                                                    }
                                                                });
                                                                //当有图片时加载图片
                                                                var cover_id="{{val.option.value}}";
                                                                console.log(cover_id);
                                                                if(cover_id != 0){
                                                                    var picurl = "{{val.option.value|get_pic('m=0,h=110')}}"
                                                                    var $li = $(
                                                                            '<div id="' + cover_id + '" class="file-item thumbnail ">' +
                                                                            '<img src="'+picurl+'">' +
                                                                            '</div>'
                                                                        ),
                                                                        $img = $li.find('img');

                                                                    $list_{{field.name}}.html( $li );
                                                                }
                                                                // 当有文件添加进来的时候
                                                                uploader_sortid_{{val.option.identifier}}.on( 'fileQueued', function( file ) {
                                                                    var $li = $(
                                                                            '<div id="' + file.id + '" class="file-item thumbnail">' +
                                                                            '<img>' +
                                                                            '<div class="info">' + file.name + '</div>' +
                                                                            '</div>'
                                                                        ),
                                                                        $img = $li.find('img');

                                                                    $list_sortid_{{val.option.identifier}}.html( $li );

                                                                    // 创建缩略图
                                                                    uploader_sortid_{{val.option.identifier}}.makeThumb( file, function( error, src ) {
                                                                        if ( error ) {
                                                                            $img.replaceWith('<span>不能预览</span>');
                                                                            return;
                                                                        }

                                                                        $img.attr( 'src', src );
                                                                    }, thumbnailWidth_sortid_{{val.option.identifier}}, thumbnailHeight_sortid_{{val.option.identifier}} );
                                                                });

                                                                // 文件上传过程中创建进度条实时显示。
                                                                uploader_sortid_{{val.option.identifier}}.on( 'uploadProgress', function( file, percentage ) {

                                                                    var $li = $( '#'+file.id ),
                                                                        $percent = $li.find('.progress span');

                                                                    // 避免重复创建
                                                                    if ( !$percent.length ) {
                                                                        $percent = $('<p class="progress"><span></span></p>')
                                                                            .appendTo( $li )
                                                                            .find('span');
                                                                    }

                                                                    $percent.css( 'width', percentage * 100 + '%' );
                                                                });

                                                                // 文件上传成功，给item添加成功class, 用样式标记上传成功。
                                                                uploader_sortid_{{val.option.identifier}}.on( 'uploadSuccess', function( file,res ) {
                                                                    $( '#'+file.id ).addClass('upload-state-done');
                                                                    $("#sortid_{{val.option.identifier}}").val(res);
                                                                });

                                                                // 文件上传失败，现实上传出错。
                                                                uploader_sortid_{{val.option.identifier}}.on( 'uploadError', function( file ) {
                                                                    var $li = $( '#'+file.id ),
                                                                        $error = $li.find('div.error');

                                                                    // 避免重复创建
                                                                    if ( !$error.length ) {
                                                                        $error = $('<div class="error"></div>').appendTo( $li );
                                                                    }

                                                                    $error.text('上传失败');
                                                                });

                                                                // 完成上传完了，成功或者失败，先删除进度条。
                                                                uploader_sortid_{{val.option.identifier}}.on( 'uploadComplete', function( file ) {
                                                                    $( '#'+file.id ).find('.progress').remove();
                                                                });
                                                            </script>
                                                        </div>
                                                        {%elif val.option.type == "url"%}
                                                        <div class="col-md-6">
                                                            <input type="text" name="sortid_{{val.option.identifier}}" data-type="url" value="{{val.option.value}}"  {% if val.required == 1 %}data-required="true"{%endif%} class="form-control" placeholder="">
                                                        </div>
                                                        {%else%}
                                                        <div class="col-md-8">
                                                            <input type="text" class="form-control " name="sortid_{{val.option.identifier}}" value="{{val.option.value}}"  {% if val.required == 1 %}data-required="true"{%endif%}>
                                                        </div>
                                                        {%endif%}
                                                    </div>
                                                </div>
                                            </div>
                                            {%endif%}
                                            {%endfor%}
                                            <div class="line line-dashed b-b line-lg pull-in"></div>
                                            {%endif%}

                                            {% if groups %}
                                            <div class="form-group">
                                                <label  class="col-sm-2 control-label">
                                                    分组
                                                </label>
                                                <div class="row">
                                                    <div class="col-md-2">
                                                        <select class="form-control " name="group_id">
                                                            <option value="0" {% if data.group_id == k%} selected {%endif%}>不分组</option>
                                                            {% for k ,v in groups %}
                                                            <option value="{{k}}" {% if data.group_id == k%} selected {%endif%}>{{v}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endif%}
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">姓名</label>

                                                <div class="col-sm-10">

                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <input type="text" class="form-control  " name="title" value="{{data.title}}" data-required="true" >
                                                        </div>
                                                        {#
                                                        <div class="col-md-12">
                                                            <span class="help-block m-b-none">请输入文档模型标识</span>
                                                        </div>
                                                        #}
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="line line-dashed b-b line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">姓名拼音</label>

                                                <div class="col-sm-10">

                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <input type="text" class="form-control  " name="pinyin" value="{{data.pinyin}}" data-required="true" >
                                                        </div>
                                                        {#
                                                        <div class="col-md-12">
                                                            <span class="help-block m-b-none">请输入文档模型标识</span>
                                                        </div>
                                                        #}
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="line line-dashed b-b line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">头像</label>
                                                <div class="col-sm-10">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <input type="hidden" name="pin" id="cover_id_{{field.name}}" value="{{data.pin}}"/>
                                                            <div id="fileList_{{field.name}}" class="uploader-list"></div>
                                                            <div id="filePicker_{{field.name}}">选择图片</div>

                                                            <script type="text/javascript">
                                                                $list_{{field.name}} = $('#fileList_{{field.name}}'),
                                                                    // 优化retina, 在retina下这个值是2
                                                                    ratio_{{field.name}} = window.devicePixelRatio || 1,

                                                                    // 缩略图大小
                                                                    thumbnailWidth_{{field.name}} = 100 * ratio_{{field.name}},
                                                                thumbnailHeight_{{field.name}} = 100 * ratio_{{field.name}},

                                                                // Web Uploader实例
                                                                uploader_{{field.name}};

                                                                // 初始化Web Uploader
                                                                // 初始化Web Uploader
                                                                var uploader_{{field.name}} = WebUploader.create({
                                                                    // 选完文件后，是否自动上传。
                                                                    auto: true,
                                                                    formData:{"__CSRF__":"{{csrf}}"},
                                                                    // swf文件路径
                                                                    swf: '/static/admin/js/webuploader/Uploader.swf',
                                                                    // 文件接收服务端。
                                                                    server: '/admin/file/uploadpic',
                                                                    // 选择文件的按钮。可选。
                                                                    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                                                                    pick: {
                                                                        id:'#filePicker_{{field.name}}',
                                                                        multiple: false
                                                                    },
                                                                    // 只允许选择图片文件。
                                                                    accept: {
                                                                        title: 'Images',
                                                                        extensions: 'gif,jpg,jpeg,bmp,png',
                                                                        mimeTypes: 'image/*'
                                                                    }
                                                                });
                                                                //当有图片时加载图片
                                                                var cover_id="{{data.pin}}";
                                                                console.log(cover_id);
                                                                if(cover_id != 0){
                                                                    var picurl = "{{data.pin|get_pic('m=0,h=110')}}"
                                                                    var $li = $(
                                                                            '<div id="' + cover_id + '" class="file-item thumbnail ">' +
                                                                            '<img src="'+picurl+'">' +
                                                                            '</div>'
                                                                        ),
                                                                        $img = $li.find('img');

                                                                    $list_{{field.name}}.html( $li );
                                                                }
                                                                // 当有文件添加进来的时候
                                                                uploader_{{field.name}}.on( 'fileQueued', function( file ) {
                                                                    var $li = $(
                                                                            '<div id="' + file.id + '" class="file-item thumbnail">' +
                                                                            '<img>' +
                                                                            '<div class="info">' + file.name + '</div>' +
                                                                            '</div>'
                                                                        ),
                                                                        $img = $li.find('img');

                                                                    $list_{{field.name}}.html( $li );

                                                                    // 创建缩略图
                                                                    uploader_{{field.name}}.makeThumb( file, function( error, src ) {
                                                                        if ( error ) {
                                                                            $img.replaceWith('<span>不能预览</span>');
                                                                            return;
                                                                        }

                                                                        $img.attr( 'src', src );
                                                                    }, thumbnailWidth_{{field.name}}, thumbnailHeight_{{field.name}} );
                                                                });

                                                                // 文件上传过程中创建进度条实时显示。
                                                                uploader_{{field.name}}.on( 'uploadProgress', function( file, percentage ) {

                                                                    var $li = $( '#'+file.id ),
                                                                        $percent = $li.find('.progress span');

                                                                    // 避免重复创建
                                                                    if ( !$percent.length ) {
                                                                        $percent = $('<p class="progress"><span></span></p>')
                                                                            .appendTo( $li )
                                                                            .find('span');
                                                                    }

                                                                    $percent.css( 'width', percentage * 100 + '%' );
                                                                });

                                                                // 文件上传成功，给item添加成功class, 用样式标记上传成功。
                                                                uploader_{{field.name}}.on( 'uploadSuccess', function( file,res ) {
                                                                    $( '#'+file.id ).addClass('upload-state-done');
                                                                    $("#cover_id_{{field.name}}").val(res);
                                                                });

                                                                // 文件上传失败，现实上传出错。
                                                                uploader_{{field.name}}.on( 'uploadError', function( file ) {
                                                                    var $li = $( '#'+file.id ),
                                                                        $error = $li.find('div.error');

                                                                    // 避免重复创建
                                                                    if ( !$error.length ) {
                                                                        $error = $('<div class="error"></div>').appendTo( $li );
                                                                    }

                                                                    $error.text('上传失败');
                                                                });

                                                                // 完成上传完了，成功或者失败，先删除进度条。
                                                                uploader_{{field.name}}.on( 'uploadComplete', function( file ) {
                                                                    $( '#'+file.id ).find('.progress').remove();
                                                                });
                                                            </script>
                                                        </div>
                                                        <div class="col-md-12 hide">
                                                            <span class="help-block m-b-none text-muted"><i class="fa fa-info-circle text-info"></i> 图片上传</span>
                                                        </div>
                                                    </div>


                                                </div>
                                            </div>
                                            <div class="line line-dashed b-b line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">润格</label>

                                                <div class="col-sm-10">

                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <div class="input-group m-b">
                                                                <span class="input-group-addon">￥</span>
                                                                <input type="text" name="runge" value="{{data.runge}}" class="form-control">
                                                                <span class="input-group-addon">元/平尺</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="line line-dashed b-b line-lg pull-in"></div>
                                            <div class="form-group">

                                                <label class="col-sm-2 control-label">简介</label>

                                                <div class="col-sm-10">

                                                    <div class="row">

                                                        <div class="col-md-10">
                                                            <textarea name="description" class="form-control">{{data.description}}</textarea>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <span class="help-block m-b-none text-muted"><i class="fa fa-info-circle text-info"></i> 简介，最多不超过200个字</span>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="line line-dashed b-b line-lg pull-in"></div>
                                            <div class="form-group">

                                                <label class="col-sm-2 control-label">详细介绍</label>

                                                <div class="col-sm-10">

                                                    <div class="row">

                                                        <div class="col-md-12">
                                                            <!-- 加载编辑器的容器 -->
                                                            <script id="Editor_sp_html_pc" name="content" style="width: 100%; height: 500px" type="text/plain">{{data.content|safe}}</script>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="line line-dashed b-b line-lg pull-in"></div>
                                            <div class="form-group form-submit">
                                                <div class="col-sm-4 col-sm-offset-2">
                                                    <input type="hidden" name="id" value="{{data.id}}"/>
                                                    <input type="hidden" name="model_id" value="{{data.model_id}}"/>
                                                    <input type="hidden" name="category_id" value="{{data.category_id}}">
                                                    <button class="btn btn-primary btn-s-md ajax-post" type="submit" target-form="form-horizontal">确定</button>
                                                    <button class="btn btn-default" onclick="javascript:history.back(-1);return false;"
                                                            type="submit">返回
                                                    </button>

                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </section>
            </section>
        </section>
    </section>

</section>


{% endblock %} {% block script %}
<script src="/static/admin/js/zTree/jquery.ztree.core-3.5.min.js" type="text/javascript"></script>
<script src="/static/admin/js/parsley/parsley.min.js"></script>
<script src="/static/admin/js/parsley/parsley.extend.js"></script>
<script type="text/javascript">
    <!--
    var zTree;
    var demoIframe;

    var setting = {
        async: {
            enable: true,
            url: "/admin/article/getmenu",
            otherParam: ["__CSRF__","{{csrf}}"]
        },
        view: {
            showLine: true,
            selectedMulti: false,
        },
        callback: {
            onAsyncSuccess: zTreeOnAsyncSuccess

        }
    };

    function zTreeOnAsyncSuccess(event, treeId, treeNode, msg) {
        // console.log(treeNode)
        var treeObj = $.fn.zTree.getZTreeObj(treeId);
        treeObj.expandAll(true);
        var id= $("#"+treeId).attr("data-cate");
        console.log(id);
        curMenu = treeObj.getNodeByParam("id", id, null);
        console.log(treeId)
        treeObj.selectNode(curMenu);
    };
    function expandNode(e) {
        var zTree = $.fn.zTree.getZTreeObj("tree"),
                type = e.data.type,
                nodes = zTree.getSelectedNodes();
        if (type == "expandAll") {
            zTree.expandAll(true);
        } else if (type == "collapseAll") {
            zTree.expandAll(false);
        }
    }
    var ue =  UE.getEditor('Editor_sp_html_pc', {
        theme:"default", //皮肤
        lang:'zh-cn', //语言
        //serverUrl: '/admin/ueditor/index',
        //iframeCssUrl:'/static/assets/plugins/bootstrap/css/bootstrap.min.css'
    });

    //-->
    $(function(){
        //左边菜单
        var t = $("#tree");
        t = $.fn.zTree.init(t, setting).expandAll(true);
        $("#expandAllBtn").bind("click", {type:"expandAll"}, expandNode);
        $("#collapseAllBtn").bind("click", {type:"collapseAll"}, expandNode);
        //搜索功能
        $("#search").click(function(){
            var url = $(this).attr('url');
            var query  = $('.search-form').find('input').serialize();
            query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
            query = query.replace(/^&/g,'');
            if( url.indexOf('?')>0 ){
                url += '&' + query;
            }else{
                url += '?' + query;
            }
            window.location.href = url;
        });

        <!-- 实例化编辑器 -->
        $(".ispct").click(function () {
            var t =  $(this).find("input").val();
            switch (parseInt(t)){
                case 0:
                    $(".sp_html_pc").show();
                    $(".sp_temp_pc").hide();
                    $(".pc_url").hide();
                    break;
                case 1:
                    $(".sp_html_pc").hide();
                    $(".sp_temp_pc").show();
                    $(".pc_url").hide();
                    break;
                case 2:
                    $(".sp_html_pc").hide();
                    $(".sp_temp_pc").hide();
                    $(".pc_url").show();
                    break;
            }

        })
    })
</script>



{% endblock %}}